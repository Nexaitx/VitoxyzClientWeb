<div class="d-block d-md-none">
<app-banner-slider 
  [images]="[
    'assets/.png',
    'assets/.png',
    'assets/.png'
  ]"
  [autoSlide]="true"
  [slideInterval]="4000">
</app-banner-slider>
</div>

<app-text-banner
  image="assets/banners/.jpg"
  title="Welcome to Vitoxyz"
  subtitle="Your trusted health partner"
  buttonText="Shop Now"
  buttonLink="/medicines">
</app-text-banner>

<div class="category-page" [class.blur-content]="isLoading">
  <!-- Full Screen Loader -->
  <div *ngIf="isLoading" class="full-screen-loader">
    <div class="loader-content">
      <mat-spinner diameter="50" color="primary"></mat-spinner>
      <p>Products loadings...</p>
      <small>Category: {{ categoryName }}</small>
      <div class="loading-details">
        <small>Filter/Pagination update in progress...</small>
      </div>
    </div>
  </div>

  <div class="category-layout">
    <!-- Left Sidebar -->
    <div class="sidebar-section" [class.sidebar-loading]="isLoading">
      <app-sidebar-filter
        [categories]="categoryList"
        [brands]="brandList"
        [disabled]="isLoading"
        (categorySelected)="filterByCategory($event)"  
        (brandSelected)="filterByBrands($event)">
      </app-sidebar-filter>
    </div>

    <!-- Right Products Section -->
    <div class="products-section">
      <!-- Section Header with Active Filters -->
      <div class="section-header">
        <h2>{{ categoryName }}</h2>
        
        <!-- Active Filter Display -->
        <div class="filter-info" *ngIf="(selectedCategory$ | async) || ((selectedBrands$ | async) && (selectedBrands$ | async)!.length > 0)">
          <div class="active-filters-container">
            <!-- Category Filter -->
            <span *ngIf="selectedCategory$ | async as selectedCategory" class="active-filter">
              Category: <strong>{{ getCategoryLabel(selectedCategory) }}</strong>
              <button class="clear-filter-btn" (click)="clearFilters()" [disabled]="isLoading">
                ×
                <span *ngIf="isLoading" class="button-loading"></span>
              </button>
            </span>
            
            <!-- Brand Filters -->
            <span *ngFor="let brand of (selectedBrands$ | async) || []" class="active-filter">
              Brand: <strong>{{ getBrandLabel(brand) }}</strong>
              <button class="clear-filter-btn" (click)="clearFilters()" [disabled]="isLoading">
                ×
                <span *ngIf="isLoading" class="button-loading"></span>
              </button>
            </span>
          </div>
        </div>

        <!-- <p class="product-count">{{ totalProducts }} products found</p> -->
        
        <!-- Loading Indicator in Header -->
        <div *ngIf="isLoading" class="header-loading">
          <mat-spinner diameter="20" color="primary"></mat-spinner>
          <span>Updating products...</span>
        </div>
      </div>

      <div class="product-grid-container">
        <!-- Products Grid -->
        <div *ngIf="products$ | async as products; else loadingOrNoProducts" class="product-grid">
          
          <ng-container *ngIf="products.length > 0; else noProducts">
            <mat-card
              *ngFor="let product of products"
              class="product-card mat-elevation-z2"
              style="cursor:pointer;"
              (click)="goToProduct(product)"
              [class.card-loading]="isLoading"
            >
              <div class="card-loading-overlay" *ngIf="isLoading">
                <mat-spinner diameter="30"></mat-spinner>
              </div>

              <img
                mat-card-image
                [src]="getFirstImageUrl(product.imageUrl)"
                [alt]="product.name"
                class="product-image"
                [class.image-loading]="isLoading"
              />

              <mat-card-content class="product-info-content">
                <h3 class="product-name">{{ product.name }}</h3>
                <p class="product-dosage-info">{{product.packaging}}</p>

                <div *ngIf="product.rating || product.discount" class="secondary-info-row">
                  <div *ngIf="product.rating" class="rating-badge">
                    <span class="rating-value">4.4</span>
                    <span class="ratings-count">({{ product.rating.count }})</span>
                  </div>
                  <span *ngIf="product.discount" class="discount-badge">{{ product.discount }} OFF</span>
                </div>

                <div class="price-action-row">
                  <div class="price-info">
                    <p *ngIf="product.mrpOld" class="mrp">MRP ₹{{ product.mrpOld }}</p>
                    <p class="current-price">MRP ₹{{ product.mrp }}</p>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </ng-container>

          <ng-template #noProducts>
            <div class="no-products-container">
              <p class="no-products-message">
                Sorry, {{ categoryName }} Product not found.
              </p>
              <button class="clear-filter-btn-large" (click)="clearFilters()" [disabled]="isLoading">
                <span *ngIf="isLoading" class="button-spinner"></span>
                Clear Filter
              </button>
            </div>
          </ng-template>
        </div>

        <!-- Initial Loading Template -->
        <ng-template #loadingOrNoProducts>
          <div class="loading-container" *ngIf="!isLoading">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Products loading...</p>
          </div>
        </ng-template>
      </div>

      <!-- Paginator -->
      <mat-paginator
        [length]="totalProducts"
        [pageSize]="pageSize"
        [pageSizeOptions]="[10, 30, 50, 100]"
        (page)="handlePageEvent($event)"
        aria-label="Select page"
        class="product-paginator product-paginator-bottom"
        [disabled]="isLoading"
      ></mat-paginator>
    </div>
  </div>
</div>

<app-footer></app-footer>
<app-mobile-footer-nav></app-mobile-footer-nav>

<!-- add to cart button -->
