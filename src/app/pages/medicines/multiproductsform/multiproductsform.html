<div class="multiproducts-page">
  <!-- Debug Info (remove in production) -->
  <div style="background: #f0f0f0; padding: 10px; margin-bottom: 10px; border-radius: 4px;">
    <small>Debug: {{ products.length }} products loaded | Forms: {{ productForms.join(', ') }} | Page: {{ currentPage }} | Total: {{ totalProducts }}</small>
  </div>

  <!-- Page Header -->
  <header class="page-header">
    <button class="back-btn" (click)="goBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      Back
    </button>
    <h1 class="page-title">{{ categoryName }}</h1>
    <div class="product-forms">
      <span class="forms-label">Filters: </span>
      <span class="form-tags">
        {{ productForms.join(', ') }}
      </span>
    </div>
    <div class="total-products" *ngIf="products.length > 0">
      {{ totalProducts }} products found
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="state-container loading-state">
      <div class="spinner"></div>
      <p>Loading products...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="state-container error-state">
      <div class="error-icon">‚ö†Ô∏è</div>
      <h3>Something went wrong</h3>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="fetchProducts(productForms, 0, true)">
        Try Again
      </button>
    </div>

    <!-- Products Grid -->
    <div *ngIf="!isLoading && !error && products.length > 0" class="products-section">
      <div class="products-meta">
        <p class="products-count">Showing {{ products.length }} of {{ totalProducts }} products</p>
      </div>
      
      <div class="products-grid">
        <div 
          *ngFor="let product of products; trackBy: trackByProductId" 
          class="product-card"
          (click)="viewProductDetails(product)"
        >
          <div class="product-image-container">
            <img 
              [src]="getFirstImage(product.imageUrl)" 
              [alt]="product.name"
              class="product-image"
              (error)="product.imageUrl = 'assets/medicines/placeholder.png'"
            />
            <!-- Discount Badge -->
            <div *ngIf="hasDiscount(product)" class="discount-badge">
              {{ product.discountPercentage }}% OFF
            </div>
            <!-- Out of Stock Badge -->
            <div *ngIf="!product.isAvailable" class="out-of-stock-badge">
              Out of Stock
            </div>
          </div>

          <div class="product-info">
            <h3 class="product-name">{{ product.name }}</h3>
            <p class="product-brand">{{ product.manufacturers }}</p>
            <p class="product-packaging">{{ getPackagingInfo(product) }}</p>
            
            <div class="product-form">
              {{ product.productForm }}
            </div>

            <div class="product-pricing">
              <div class="price-container">
                <span class="current-price">
                  ‚Çπ{{ getDisplayPrice(product) }}
                </span>
                <span *ngIf="hasDiscount(product)" class="original-price">
                  ‚Çπ{{ product.mrp }}
                </span>
              </div>
            </div>

            <button 
              class="add-to-cart-btn" 
              (click)="addToCart(product, $event)"
              [disabled]="!product.isAvailable"
            >
              {{ product.isAvailable ? 'Add to Cart' : 'Out of Stock' }}
            </button>
          </div>
        </div>
      </div>

      <!-- Load More Section -->
      <div class="load-more-section" *ngIf="hasMoreProducts">
        <button 
          class="load-more-btn" 
          (click)="loadMore()"
          [disabled]="isLoadMoreLoading"
        >
          <span *ngIf="!isLoadMoreLoading">
            Load More Products ({{ getRemainingProductsCount() }} more available)
          </span>
          <span *ngIf="isLoadMoreLoading" class="loading-text">
            <div class="small-spinner"></div>
            Loading...
          </span>
        </button>
        <p class="load-more-info">
          Showing {{ products.length }} of {{ totalProducts }} products
        </p>
      </div>

      <!-- No More Products Message -->
      <div *ngIf="!hasMoreProducts && products.length > 0" class="no-more-products">
        <p>üéâ You've seen all {{ totalProducts }} products!</p>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !error && products.length === 0" class="state-container empty-state">
      <div class="empty-icon">üì¶</div>
      <h3>No Products Found</h3>
      <p>We couldn't find any products matching "{{ productForms.join(', ') }}".</p>
      <button class="back-home-btn" (click)="goBack()">
        Browse Other Categories
      </button>
    </div>
  </main>
</div>