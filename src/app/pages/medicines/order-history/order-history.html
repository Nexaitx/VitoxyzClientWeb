

<div class="container my-4 min-vh-100">
  <!-- Page Header -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="fw-bold">My Orders</h2>
      <p class="text-muted">View and manage your order history</p>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading your orders...</p>
  </div>

  <!-- No Orders Message -->
  <div *ngIf="!isLoading && orders.length === 0" class="text-center my-5">
    <div class="empty-state">
      <i class="bi bi-box-seam display-1 text-muted"></i>
      <h4 class="mt-3">No Orders Yet</h4>
      <p class="text-muted">You haven't placed any orders yet.</p>
      <button class="btn btn-primary text-light rounded-pill mt-3" (click)="router.navigate(['/medicines'])">
        Start Shopping
      </button>
    </div>
  </div>

  <!-- Orders Content -->
  <div *ngIf="!isLoading && orders.length > 0" class="row">
    <div class="col-12">
      
      <!-- Order Filters Tabs -->
      <mat-tab-group (selectedIndexChange)="onTabChange($event)" [selectedIndex]="selectedTab">
        <mat-tab *ngFor="let filter of orderFilters; let i = index" 
                 [label]="filter.label + ' (' + filter.count + ')'">
        </mat-tab>
      </mat-tab-group>

      <!-- Orders List -->
      <div class="orders-list mt-4">
        <div *ngFor="let order of filteredOrders" class="order-card border rounded mb-4">
          
          <!-- Order Header -->
          <div class="order-header p-3 border-bottom bg-light">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="d-flex flex-column">
                  <span class="fw-bold">Order #{{ order.orderNumber }}</span>
                  <small class="text-muted">Placed on {{ formatDate(order.orderDate) }}</small>
                </div>
              </div>
              <div class="col-md-6 text-md-end">
                <div class="d-flex flex-column flex-md-row justify-content-md-end gap-2">
                  <span [class]="getStatusClass(order.status)" class="me-2 rounded-pill">
                    {{ getStatusText(order.status) }}
                  </span>
                  <span [class]="getPaymentStatusClass(order.paymentStatus)" class="rounded-pill">
                    {{ getPaymentStatusText(order.paymentStatus) }}
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Items -->
          <div class="order-items p-3">
            <div *ngFor="let item of order.orderItems" class="order-item row align-items-center mb-3 pb-3 border-bottom">
              <div class="col-2 col-md-1">
                <img [src]="item.imageUrl || 'assets/default.avif'" 
                     [alt]="item.productName"
                     class="img-fluid rounded"
                     style="max-height: 60px; object-fit: cover;">
              </div>
              <div class="col-7 col-md-8">
                <h6 class="mb-1">{{ item.productName }}</h6>
                <small class="text-muted">
                  {{ item.packaging }} • Qty: {{ item.quantity }}
                </small>
                <div *ngIf="item.productForm" class="mt-1">
                  <small class="text-muted">Form: {{ item.productForm }}</small>
                </div>
              </div>
              <div class="col-3 col-md-3 text-end">
                <div class="fw-bold">₹{{ item.totalPrice }}</div>
                <small class="text-muted">₹{{ item.unitPrice }} each</small>
              </div>
            </div>
          </div>

          <!-- Order Footer -->
          <div class="order-footer p-3 border-top bg-light">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="d-flex flex-wrap gap-2 align-items-center">
                  <span class="fw-bold">Total: ₹{{ order.finalAmount }}</span>
                  <small class="text-muted">
                    • {{ getTotalItems(order) }} item{{ getTotalItems(order) > 1 ? 's' : '' }}
                  </small>
                </div>
                <small class="text-muted d-block mt-1">
                  Payment: {{ order.paymentMethod }}
                </small>
              </div>
              <div class="col-md-6 text-md-end">
                <div class="d-flex flex-wrap gap-2 justify-content-md-end">
                  
                  <!-- View Details Button -->
                  <button class="btn btn-outline-primary btn-sm text-light rounded-pill" 
                          (click)="viewOrderDetails(order)">
                    <i class="bi bi-eye me-1"></i>View Details
                  </button>

                  <!-- Track Order Button -->
                  <button *ngIf="canTrackOrder(order)" 
                          class="btn btn-outline-info btn-sm rounded-pill"
                          (click)="trackOrder(order)">
                    <i class="fi fi-rr-navigation me-1"></i>Track Order
                  </button>

                  <!-- Reorder Button -->
                  <button class="btn btn-outline-success btn-sm rounded-pill" 
                          (click)="reorderItems(order)">
                    <i class="bi bi-arrow-repeat me-1"></i>Reorder
                  </button>

                  <!-- Cancel Order Button -->
                  <button *ngIf="canCancelOrder(order)" 
                          class="btn btn-outline-danger btn-sm rounded-pill"
                          (click)="cancelOrder(order)">
                    <i class="bi bi-x-circle me-1"></i>Cancel
                  </button>

                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- No Orders for Filter Message -->
      <div *ngIf="filteredOrders.length === 0 && orders.length > 0" class="text-center my-5">
        <div class="empty-state">
          <i class="bi bi-search display-1 text-muted"></i>
          <h4 class="mt-3">No Orders Found</h4>
          <p class="text-muted">No orders match the selected filter.</p>
          <button class="btn btn-outline-primary mt-3 rounded-pill" (click)="selectedTab = 0; filterOrders('all')">
            View All Orders
          </button>
        </div>
      </div>

    </div>
  </div>
</div>

<app-footer></app-footer>
<app-mobile-footer-nav></app-mobile-footer-nav>
