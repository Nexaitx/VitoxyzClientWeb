<div class="page-wrapper">
  <div class="page-content">
<div class="container-fluid">
  <!-- Loading template -->
  <div class="d-flex justify-content-end mb-2">
    <button class="btn btn-outline-primary btn-sm rounded-pill text-light" (click)="reloadPage()" [disabled]="loading">
      <i class="bi bi-arrow-clockwise me-1"></i>
      Reload
    </button>
  </div>

  <ng-template #loadingTpl>
    <div class="d-flex justify-content-center align-items-center" style="min-height:200px;">
      <div class="text-center">
        <div class="spinner-border" role="status" aria-hidden="true"></div>
        <div class="mt-2">wait for accepted staff</div>
      </div>
    </div>
  </ng-template>

  <!-- Main display: show spinner while loading, otherwise show staff or noStaff -->
  <ng-container *ngIf="!loading; else loadingTpl">
    <ng-container *ngIf="staffDetails.length > 0; else noStaff">
      <!-- ‚è≥ Payment Timer UI -->
      <div class="payment-timer-wrapper mb-4" *ngIf="showPaymentTimer && !paymentExpired">
        <div class="payment-timer-box">
          <div class="timer-time">
            {{ countdown }}
          </div>
          <div class="timer-message">
            Please process the payment within the given time,<br />
            otherwise it will expire.
          </div>
        </div>
      </div>

      <!-- ‚ùå Expired Message -->
      <div class="payment-expired-wrapper mb-4" *ngIf="paymentExpired">
        <div class="payment-expired-box">
          ‚è∞ Payment time expired.<br />
          Please reselect staff to continue.
        </div>
      </div>

      <div *ngFor="let categoryGroup of staffDetails" class="row">
        <div class="col-12 mb-2">
          {{ categoryGroup.category | titlecase }}
          ({{ categoryGroup.availableStaff?.length || 0 }})
        </div>

        <div class="col-md-3 mb-4" *ngFor="let staff of categoryGroup.availableStaff; let i = index">
          <div class="card h-100">
            <div class="row g-0">
              <div class="col-4">
                <div class="staff-img">
                  <img
                    [src]="staff.imageUrl || (staff.gender?.toLowerCase() === 'female' ? '/assets/profile.avif' : '/assets/profile.avif')"
                    class="img-fluid rounded" alt="Staff Image" />
                </div>
              </div>

              <div class="col-7">
                <div class="card-body p-2">
                  <h6 class="card-title mb-1"><span>{{ staff.name }}</span></h6>

                  <p class="mb-1 text-muted">
                    {{ staff.experience }} Years Experience | {{ staff.duties }} Duties
                  </p>

                  <p class="mb-1">
                    <ng-container *ngFor="let star of getStars(staff.rating)">
                      <i class="bi" [ngClass]="{
                        'bi-star-fill text-warning': star === 'full',
                        'bi-star-half text-warning': star === 'half',
                        'bi-star text-warning': star === 'empty'
                      }"></i>
                    </ng-container>
                    <span class="ms-1 text-warning">{{ staff.rating }}/5</span>
                  </p>

                  <p class="mb-1 text-muted">‚Çπ{{ staff.price }}</p>
                  <!-- ‚úÖ ADDED: Phone -->
                  <p class="mb-1">
                    üìû <strong>{{ staff.staffPhone }}</strong>
                  </p>

                  <!-- ‚úÖ ADDED: Start & End Dates -->
                  <p class="mb-1 text-muted">
                    Start: <strong>{{ staff.startDate }}</strong>
                  </p>
                  <p class="mb-1 text-muted">
                    End: <strong>{{ staff.endDate }}</strong>
                  </p>
                  <div class="d-flex justify-content-start gap-2 mt-2">
                    <button class="btn btn-outline-primary actionSwap" data-bs-toggle="modal"
                      data-bs-target="#swapStaff" (click)="selectedStaff = staff" [disabled]="staff.isBooked">
                      <i class="bi bi-arrow-left-right"></i>
                    </button>

                    <button class="btn btn-sm btn-outline-danger actionDelete" data-bs-toggle="modal"
                      data-bs-target="#deleteStaff" (click)="selectedStaff = staff">
                      <i class="bi bi-x-lg"></i>
                    </button>
                  </div>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- row -->
      <footer class="bg-white px-0">
        <div class="p-3 d-flex justify-content-between">
          <p class="text-muted">Total Staff: {{ getTotalStaff() }}</p>
          <!-- <p class="text-muted mb-1">Base Amount: ‚Çπ{{ calculateTotalAmount() }}</p> -->
<p class="text-muted mb-1">GST (18%): ‚Çπ{{ getGstAmount() }}</p>
<p><strong>Total: ‚Çπ{{ getTotalAmount() }}</strong></p>
          <button class="submission btn btn-primary text-light rounded-pill btn-sm" data-bs-toggle="modal"
            data-bs-target="#exampleModal" [disabled]="getTotalStaff() === 0 || paymentExpired">
            Proceed to Payment (‚Çπ{{ getTotalAmount() }})
          </button>
        </div>
      </footer>
    </ng-container>
  </ng-container>

  <ng-template #noStaff>
    <div class="status-container">
      <h2>No staff found.</h2>
    </div>
  </ng-template>
</div>


<!-- modals unchanged (keep your existing modal HTML) -->
<!-- ... keep #exampleModal, #swapStaff, #deleteStaff modals as is ... -->



<!-- <footer class="bg-white px-0">
    <div class="p-3 d-flex justify-content-between">
       <p class="text-muted">Total Staff: 01</p>
        <button class="submission btn btn-primary text-light rounded-pill btn-sm" data-bs-toggle="modal"
            data-bs-target="#exampleModal">Proceed to Booking (1212)</button>
    </div>

</footer> -->
  </div>
<app-footer></app-footer>

</div>


<app-mobile-footer-nav></app-mobile-footer-nav>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Please Enter Billing Information</h1>
        <button type="button" class="colseCls" data-bs-dismiss="modal" aria-label="Close">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="modal-body">
        <form [formGroup]="billingForm">
          <div class="form-group">
            <label>Your Name *</label>
            <input formControlName="billingName" type="text" class="form-control" placeholder="Enter your name">
            <div *ngIf="formControls['billingName']?.touched && formControls['billingName']?.invalid"
              class="text-danger small">
              Valid Name is required (alphabets only).
            </div>
          </div>

          <div class="form-group my-3">
            <label>Phone Number *</label>
            <input formControlName="phoneNumber" type="tel" class="form-control" placeholder="Enter your phone number">
            <div *ngIf="formControls['phoneNumber']?.touched && formControls['phoneNumber']?.invalid"
              class="text-danger small">
              Valid Indian phone number is required.
            </div>
          </div>

          <div class="form-group">
            <label>Billing Address *</label>
            <textarea formControlName="billingAddress" class="form-control" placeholder="Enter complete billing address"
              rows="3"></textarea>
            <div *ngIf="formControls['billingAddress']?.touched && formControls['billingAddress']?.invalid"
              class="text-danger small">
              Billing Address is required (min 5 chars).
            </div>
          </div>

          <div class="form-group my-3">
            <label>GST Number (Optional)</label>
            <input formControlName="gstNumber" type="text" class="form-control" placeholder="Enter GST number">
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary submission text-light btn-sm w-100 rounded-pill"
          [disabled]="billingForm.invalid || isPaymentProcessing" (click)="onProceedToPayment(
                  billingForm.value.billingName,
                  billingForm.value.billingAddress,
                  billingForm.value.gstNumber,
                  billingForm.value.phoneNumber
                )">
          <span *ngIf="isPaymentProcessing" class="spinner-border spinner-border-sm me-2"></span>
          {{ isPaymentProcessing ? 'Processing...' : 'Pay ‚Çπ' + getTotalAmount() }}
        </button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="swapStaff" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Please Enter Billing Information</h1>
        <button type="button" class="colseCls" data-bs-dismiss="modal" aria-label="Close"><i
            class="bi bi-x-lg  "></i></button>
      </div>
      <div class="modal-body">
        <h5>Are you Sure, you want to swap the Staff?</h5>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn submission text-light btn-sm w-100 rounded-pill"
          data-bs-dismiss="modal">No</button>
        <button type="submit" class="btn btn-primary submission text-light btn-sm rounded-pill"
          (click)="addSpecificStaff(selectedStaff)">Yes</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="deleteStaff" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Confirm</h1>
        <button type="button" class="colseCls" data-bs-dismiss="modal" aria-label="Close"><i
            class="bi bi-x-lg  "></i></button>
      </div>
      <div class="modal-body">
        <h5>Are you sure you want to remove this staff ?</h5>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn submission text-light btn-sm w-100 rounded-pill"
          data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary submission text-light btn-sm rounded-pill"
          (click)="removeStaff(selectedStaff)">Remove</button>
      </div>
    </div>
  </div>
</div>

<!-- <app-medicine-slider 
  title="Experience the Joy of Easy Shopping"
  [showSeeAll]="true"
  [maxItems]="8"
  [autoSlide]="true"
  [slideInterval]="5000">
</app-medicine-slider> -->

