<!-- <app-text-banner image="assets/staff/book-staff-banner.avif" title="Hire Trusted Staff Easily"
  subtitle="Find verified professionals for your home, office, or business needs" buttonText="Book Now"
  (buttonClick)="centerContent()">
</app-text-banner> -->

<!-- <app-booking-text-banner image="assets/staff/book-staff-banner.avif" title="Hire Trusted Staff Easily"
  subtitle="Find verified professionals for your home, office, or business needs" buttonText="Book Now"
  (buttonClick)="centerContent()"></app-booking-text-banner>

<app-text-image imageUrl="assets/images/sample.jpg" imageAlt="Sample Image" title="Find, Book & Shop â€” All in One Place"
  subtitle="Discover Amazing Features"
  description="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua."
  buttonText="" buttonLink="/">
</app-text-image>  -->
<div class="page-wrapper">
  <div class="page-content">

<div class="container-fluid" #bookingSection >

  <div class="row">
    <div class="col-md-4 h-100 map-styles">
      <app-map (locationSelected)="getAddressFromCoords($event.lat, $event.lng)"></app-map>
    </div>

    <div class="col-md-8 search-staff-form">
      <h2 class="form-title">Please fill the form</h2>
      <div class="form-scroll-container">
        <div class="form-content">
          <form [formGroup]="staffBookingForm" (ngSubmit)="onSubmit()">
            <div class="form">
              <div class="row my-3">
                <div class="col-md-12">
                  <div class="form-group">
                    <label class="form-label">Select your area</label>
                    <i class="bi bi-geo-alt address" style="line-height: 2;"></i>
                    <input type="text" class="form-control ps-4" formControlName="userAddress" [class.is-invalid]="
                  staffBookingForm.get('userAddress')?.invalid &&
                  staffBookingForm.get('userAddress')?.touched
                " />
                    @if(staffBookingForm.get('userAddress')?.invalid &&
                    staffBookingForm.get('userAddress')?.touched) {
                    <div class="invalid-feedback">Area is required.</div>
                    }
                  </div>
                </div>
              </div>
              <div class="row my-3">
                <div class="col-md-12">
                  <div class="form-group">
                    <label class="form-label">Address</label>
                    <i class="bi bi-geo-alt address" style="line-height: 2;"></i>
                    <input type="text" class="form-control ps-4" placeholder="Enter address"
                      formControlName="address" />
                  </div>
                </div>
              </div>
              <div formArrayName="staffForms" class="staff-list">
                <div class="pe-2" *ngFor="let staffGroup of staffListFormArray.controls; let i = index"
                  [formGroupName]="i">
                  @if(i > 0){
                  <div class="indexed-divider-container">
                    <div class="line"></div>
                    <span class="index-number">{{ i }}</span>
                    <div class="line"></div>
                  </div>
                  }
                  <div class="col-md-12 d-flex justify-content-end">
                    @if(i !== 0) {
                    <button type="button"
                      class="btn btn-outline-danger btn-lg rounded-circle d-flex align-items-center justify-content-center"
                      style="width: 20px; height: 30px" (click)="removeStaff(i)" title="Remove Staff">
                      <i class="bi bi-trash fs-5"></i>
                    </button>
                    }
                  </div>
                  <div formArrayName="staffDetails">
                    <div *ngFor="let staffDetails of getNestedStaffDetailsControls(i); let s = index"
                      [formGroupName]="s">
                      <div class="row">
                        <div class="col-md-12 mb-2">
                          <div class="form-group">
                            <label for="typeOfStaff-{{ i }}" class="form-label">Select Staff Type</label>
                            <i class="bi bi-person address"></i>
                            <select class="form-select ps-4" id="typeOfStaff-{{ i }}" formControlName="typeOfStaff" 
                              [class.is-invalid]="
                          staffDetails.get('typeOfStaff')?.invalid &&
                          staffDetails.get('typeOfStaff')?.touched
                        ">
                              <option value="" disabled>Select Type</option>
                              <option *ngFor="let staff of staffCategories" [value]="staff.name">
                                {{ staff.name }}
                              </option>
                            </select>

                            @if(staffDetails.get('typeOfStaff')?.invalid &&
                            staffDetails.get('typeOfStaff')?.touched) {
                            <div class="invalid-feedback">
                              Type of Staff is required.
                            </div>
                            }
                          </div>
                        </div>
                        @if(staffDetails.get('typeOfStaff')?.value &&
                        staffDetails.get('typeOfStaff')?.value !== '') {
                        <ng-container>
                          <div class="col-md-12 my-3">
                            <div class="form-group">
                              <label for="typeOfSubStaff-{{ i }}" class="form-label">Select {{
                                staffDetails.get('typeOfStaff')?.value |
                                titlecase }} Type</label>
                              <i class="bi bi-people address"></i>
                              <select class="form-select ps-4" id="typeOfSubStaff-{{ i }}"
                                formControlName="typeOfSubStaff" [disabled]="!staffDetails.get('typeOfStaff')?.value"
                                (change)="onSubStaffChange(i)" [class.is-invalid]="
                            staffDetails.get('typeOfSubStaff')?.invalid &&
                            staffDetails.get('typeOfSubStaff')?.touched
                          ">
                                <option value="" disabled>
                                  Select {{
                                  staffDetails.get('typeOfStaff')?.value |
                                  titlecase }}
                                </option>
                                <option *ngFor="let nurse of staffSubCategories[i]" [value]="nurse.value">
                                  {{ nurse.label }}
                                </option>
                              </select>

                              @if(staffDetails.get('typeOfSubStaff')?.invalid &&
                              staffDetails.get('typeOfSubStaff')?.touched) {
                              <div class="invalid-feedback">
                                Type of {{
                                staffDetails.get('typeOfStaff')?.value |
                                titlecase }} is required.
                              </div>
                              }
                            </div>
                          </div>
                        </ng-container>
                        }
                      </div>
                    </div>
                  </div>
                  @if(getNestedStaffDetailsControls(i)[0].get('typeOfStaff')?.value)
                  {
                  <ng-container>
                    <div formArrayName="shiftDetails">
                      <div *ngFor="let shiftDetail of getNestedShiftDetailsControls(i); let sh = index"
                        [formGroupName]="sh" class="shift-detail">
                        <div class="row d-flex">
                          <div class="sub-row">

                            <div class="d-flex align-items-center">
                              <div class="d-flex flex-column">
                                <!-- <small class="text-muted">Start Time</small>
                                <div class="d-flex align-items-center"
                                  [class.is-invalid]="shiftDetail.get('timeSlot')?.errors?.['pastTime'] && shiftDetail.get('timeSlot')?.touched">
                                  <div class="d-flex align-items-center counter-box">
                                    <button class="btn-counterLeft btn-minus" type="button"
                                      (click)="decrementTimes('hours', i, sh, 'start')">
                                      <i class="bi bi-dash"></i>
                                    </button>

                                    <input type="number" class="value-font counter-input"
                                      formControlName="startTimeHour"
                                      [value]="pad(shiftDetail.get('startTimeHour')?.value)" min="1" max="12"
                                      (input)="onManualTimeChange('startTimeHour', i, sh, $event)" />

                                    <button class="btn-counterRight btn-plus" type="button"
                                      (click)="incrementTimes('hours', i, sh, 'start')">
                                      <i class="bi bi-plus"></i>
                                    </button>
                                  </div>

                                  <div class="d-flex align-items-center counter-box mx-2">
                                    <button class="btn-counterLeft btn-minus" type="button"
                                      (click)="decrementTimes('minutes', i, sh, 'start')">
                                      <i class="bi bi-dash"></i>
                                    </button>

                                    <input type="number" class="value-font counter-input hrsMin"
                                      formControlName="startTimeMinute"
                                      [value]="pad(shiftDetail.get('startTimeMinute')?.value)" min="0" max="59"
                                      (input)="onManualTimeChange('startTimeMinute', i, sh, $event)" />

                                    <button class="btn-counterRight btn-plus" type="button"
                                      (click)="incrementTimes('minutes', i, sh, 'start')">
                                      <i class="bi bi-plus"></i>
                                    </button>
                                  </div>

                                  <select class="d-flex align-items-center counter-box mx-2"
                                    formControlName="startTimeAmPm"
                                    (change)="updateTimeSlot(getNestedShiftDetailsControls(i)[sh])">
                                    <option value="AM">AM</option>
                                    <option value="PM">PM</option>
                                  </select>
                                </div> -->
                                <small class="text-muted">Start Time</small>

                                <input class="timeInputcls" type="time" formControlName="startTime" />
                              </div>
                            </div>

                            <!-- END TIME -->
                            <div class="d-flex align-items-center ">
                              <div class="d-flex flex-column">
                                <!-- <small class="text-muted">End Time</small>
                                <div class="d-flex align-items-center">
                                  <div class="d-flex align-items-center counter-box">
                                    <button class="btn-counterLeft btn-minus" type="button"
                                      (click)="decrementTimes('hours', i, sh, 'end')">
                                      <i class="bi bi-dash"></i>
                                    </button>

                                    <input type="number" class="value-font counter-input" formControlName="endTimeHour"
                                      [value]="pad(shiftDetail.get('endTimeHour')?.value)" min="1" max="12"
                                      (input)="onManualTimeChange('endTimeHour', i, sh, $event)" />

                                    <button class="btn-counterRight btn-plus" type="button"
                                      (click)="incrementTimes('hours', i, sh, 'end')">
                                      <i class="bi bi-plus"></i>
                                    </button>
                                  </div>

                                  <div class="d-flex align-items-center counter-box mx-2">
                                    <button class="btn-counterLeft btn-minus" type="button"
                                      (click)="decrementTimes('minutes', i, sh, 'end')">
                                      <i class="bi bi-dash"></i>
                                    </button>

                                    <input type="number" class="value-font counter-input hrsMin"
                                      formControlName="endTimeMinute"
                                      [value]="pad(shiftDetail.get('endTimeMinute')?.value)" min="0" max="59"
                                      (input)="onManualTimeChange('endTimeMinute', i, sh, $event)" />

                                    <button class="btn-counterRight btn-plus" type="button"
                                      (click)="incrementTimes('minutes', i, sh, 'end')">
                                      <i class="bi bi-plus"></i>
                                    </button>
                                  </div>

                                  <select class="d-flex align-items-center counter-box mx-2"
                                    formControlName="endTimeAmPm">
                                    <option value="AM">AM</option>
                                    <option value="PM">PM</option>
                                  </select>
                                </div> -->
                                <small class="text-muted">End Time</small>

                                <input type="time" class="timeInputcls" formControlName="endTime" />
                              </div>
                            </div>


                            <div class="gender-quantity-row">
                              <!-- Preferred Gender -->
                              <div class="gender-box">
                                <label class="form-label d-block">Preferred Gender</label>

                                <div class="d-flex align-items-center counter-box mx-2">
                                  <i class="bi bi-person text-primary me-2"></i>
                                  <span class="counter-label">Male</span>
                                </div>

                                <div class="d-flex align-items-center counter-box mx-2">
                                  <i class="bi bi-person text-primary me-2"></i>
                                  <span class="counter-label">Female</span>
                                </div>

                                @if(shiftDetail.errors?.['zeroQuantity'] &&
                                (shiftDetail.touched || shiftDetail.dirty)) {
                                <div class="text-danger">
                                  Quantity is required.
                                </div>
                                }
                              </div>

                              <!-- Quantity -->
                              <div class="quantity-box">
                                <label class="form-label">Quantity</label>

                                <div class="d-flex align-items-center counter-box">
                                  <button class="btn-counterLeft btn-minus" type="button"
                                    (click)="decrease('maleQuantity', i, sh)">
                                    <i class="bi bi-dash"></i>
                                  </button>
                                  <input type="number" class="value-font counter-input"
                                    [formControlName]="'maleQuantity'" min="0" max="10"
                                    (input)="onManualChange('maleQuantity', i, sh, $event)" />
                                  <button class="btn-counterRight btn-plus" type="button"
                                    (click)="increase('maleQuantity', i, sh)">
                                    <i class="bi bi-plus"></i>
                                  </button>
                                </div>

                                <div class="d-flex align-items-center counter-box">
                                  <button class="btn-counterLeft btn-minus" type="button"
                                    (click)="decrease('femaleQuantity', i, sh)">
                                    <i class="bi bi-dash"></i>
                                  </button>
                                  <input type="number" class="value-font counter-input"
                                    [formControlName]="'femaleQuantity'" min="0" max="10"
                                    (input)="onManualChange('femaleQuantity', i, sh, $event)" />
                                  <button class="btn-counterRight btn-plus" type="button"
                                    (click)="increase('femaleQuantity', i, sh)">
                                    <i class="bi bi-plus"></i>
                                  </button>
                                </div>
                              </div>
                            </div>

                            <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                              <div class="form-group">
                                <label class="form-label">Tenure</label>

                                <div class="d-flex align-items-center counter-box ">
                                  <i class="bi bi-calendar4 text-primary" style="margin-left: 10px;"></i>
                                  <select class="value-font border-0 counter-select  " formControlName="tenure"
                                    [class.is-invalid]="shiftDetail.get('tenure')?.invalid && shiftDetail.get('tenure')?.touched">
                                    <option *ngFor="let ten of getTenureOptions(i)" [value]="ten.value">
                                      {{ ten.label }}
                                    </option>
                                  </select>
                                </div>

                                @if(shiftDetail.get('tenure')?.invalid &&
                                shiftDetail.get('tenure')?.touched) {
                                <div class="invalid-feedback">
                                  Tenure is required.
                                </div>
                                }
                              </div>
                            </div>
                            <div class="col-12 col-sm-6 col-md-4 col-lg-2">
                              <label class="form-label">Shift Duration</label>
                              <select class="d-flex align-items-center counter-box "
                                formControlName="preferredTimeSlot" [class.is-invalid]="
                            shiftDetail.get('preferredTimeSlot')?.invalid &&
                            shiftDetail.get('preferredTimeSlot')?.touched
                          ">
                                <option *ngFor="let type of getSlotsByStaffIndex(i)" [value]="type">
                                  {{ type }}
                                </option>
                              </select>
                              @if(shiftDetail.get('preferredTimeSlot')?.invalid
                              && shiftDetail.get('preferredTimeSlot')?.touched)
                              {
                              <div class="invalid-feedback">
                                Shift Type is required.
                              </div>
                              }
                            </div>
                          </div>

                          <div class="row date-row">
                            <div class="col-md-6">
                              <label class="form-label">Duty Start Date</label>
                              <input type="date" class="form-control " [min]="today" formControlName="dutyStartDate" />
                            </div>

                            <div class="col-md-6" *ngIf="shiftDetail.get('tenure')?.value !== '1'">
                              <label class="form-label">Duty End Date</label>
                              <input type="date" class="form-control"
                                [min]="shiftDetail.get('dutyStartDate')?.value || today" formControlName="dutyEndDate"
                                readonly />


                              <div class="invalid-feedback"
                                *ngIf="shiftDetail.get('dutyEndDate')?.invalid && shiftDetail.get('dutyEndDate')?.touched">
                                Duty End Date is required.
                              </div>
                            </div>
                          </div>



                          <div class="d-flex align-items-start justify-content-end gap-2 mt-3">
                            @if(sh === 0 || sh ===
                            getNestedShiftDetailsControls(i).length - 1) {
                            <i class="bi bi-plus-lg add" (click)="addShift(i)" title="Add Time Slot"></i>
                            } @if(sh > 0) {
                            <i class="bi bi-trash text-danger remove" (click)="removeShiftDetail(i, sh)"
                              title="Remove Time Slot"></i>
                            }
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>
                  }
                </div>
              </div>
            </div>

            @if(staffListFormArray.controls[0].get('staffDetails')?.get('0')?.get('typeOfStaff')?.value)
            {
            <ng-container>
              <div class="d-flex justify-content-center addNewBtn my-2">
                <button type="button" class="btn text-light" (click)="addNewStaff()">
                  <i class="bi bi-plus"></i>Add Another Staff
                </button>
              </div>
              <div class="submission-fixed d-flex justify-content-end">
                <app-submission [buttonType]="button" [disableButton]="isSubmitting"></app-submission>
              </div>
            </ng-container>
            }
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<div *ngIf="message" class="mt-2 p-2 rounded" [ngClass]="{
       'bg-success text-white': messageType === 'success',
       'bg-danger text-white': messageType === 'error'
     }">
  {{ message }}
</div>
<!-- <app-medicine-slider 
  title="Experience the Joy of Easy Shopping"
  [showSeeAll]="true"
  [maxItems]="8"
  [autoSlide]="true"
  [slideInterval]="5000">
</app-medicine-slider> -->

</div>
  <app-footer></app-footer>
</div>
<app-mobile-footer-nav></app-mobile-footer-nav>
<!-- @if(!showAadharPopup) {
<app-aadhar-verification (verified)="onAadharVerified()"></app-aadhar-verification>
} -->
<!-- Remove this -->

@if (showAuthPopup) {
<app-authorization [showAuthModal]="showAuthPopup" [authMode]="'login'" (loginSuccess)="onAuthSuccess()"
  (close)="onAuthClose()"></app-authorization>
}

<!-- @if(showAuthPopup) {
<app-authorization
  [showAuthModal]="showAuthPopup"
  [authMode]="'login'"
  (loginSuccess)="onAuthSuccess()"
  (close)="onAuthClose()"
></app-authorization>
} -->