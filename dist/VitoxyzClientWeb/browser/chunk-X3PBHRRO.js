import{a as Y,b as H,c as J,d as Q}from"./chunk-4QNPEP4H.js";import{a as O}from"./chunk-4PUTMEEB.js";import{a as U}from"./chunk-SNYBKFZW.js";import{d as W}from"./chunk-DSE2JB5M.js";import"./chunk-NRD3KBLP.js";import"./chunk-HVSDNTLZ.js";import{f as j}from"./chunk-3YV4HSNM.js";import"./chunk-FUULWHGX.js";import"./chunk-PECEEJYX.js";import{b as F}from"./chunk-2ZEBAJEA.js";import{g as q}from"./chunk-T5AB4NFH.js";import{c as w,d as k}from"./chunk-A6XAC4QI.js";import"./chunk-RXPDFXEY.js";import{a as V}from"./chunk-5TBLFU7I.js";import{f as E}from"./chunk-GA6KQOR5.js";import{F as z,G as d,J as I,K as N,O as D,R,U as T,V as A,W as L,X as B,ba as G,ca as K,da as $}from"./chunk-OHQSNZA5.js";import{c as S,g as _}from"./chunk-UF26DDQM.js";import{h as P,q as C}from"./chunk-HSQUREWB.js";import{Ab as v,Pb as c,Qb as t,Rb as e,Sb as m,cc as M,e as y,eb as a,ha as h,pb as b,sc as i,tc as s,uc as u,vb as x}from"./chunk-36LOJXOE.js";function ee(p,n){if(p&1&&(t(0,"option",29),i(1),e()),p&2){let o=n.$implicit;c("value",o),a(),s(o)}}var X=class p{constructor(n){this.fb=n;this.form=this.fb.group({name:["",[d.required,d.minLength(3)]],email:["",[d.required,d.email]],country:["",d.required]})}router=h(S);razorpayKeyId="rzp_test_RARA6BGk8D2Y2o";isPaymentLoading=!1;form;countries=["India","United States","United Kingdom","Canada","Australia"];plan="";price=0;duration="";tax=0;description="";ngOnInit(){let n=localStorage.getItem("paymentData");if(n){let o=JSON.parse(n);console.log(o,"parsed"),this.plan=o.apiResponse.planType||"Selected Plan",this.price=o.price||0,this.duration=o.duration||"1 Month",this.description=o.description||"",this.tax=this.price*.05}else alert("No plan selected! Redirecting to plans page."),this.router.navigate(["/plans"])}get total(){return this.price+this.tax}goToDietDashboard(){this.router.navigate(["/diet-charts"])}pay(){return y(this,null,function*(){if(this.form.markAllAsTouched(),!this.form.invalid){if(!this.razorpayKeyId){alert("Razorpay Key ID is missing. Please set it in the component.");return}try{this.isPaymentLoading=!0,yield this.loadRazorpaySdk();let n=this.getPayableAmount(),{name:o,email:r,country:l}=this.form.value,Z={key:this.razorpayKeyId,amount:Math.round(n*100),currency:"INR",name:"Your Company Name",description:`${this.plan} - ${this.duration}`,prefill:{name:o||"",email:r||"",contact:""},notes:{plan:this.plan,duration:this.duration,price:String(this.price),tax:String(this.tax),country:l||""},theme:{color:"#0d6efd"},modal:{ondismiss:()=>console.log("Razorpay Checkout closed.")},handler:f=>this.onPaymentSuccess(f)},g=new Razorpay(Z);g.on("payment.failed",f=>this.onPaymentFailed(f)),g.open()}catch(n){console.error("Payment init error:",n),alert("Unable to start payment. Please try again.")}finally{this.isPaymentLoading=!1}}})}onPaymentSuccess(n){console.log("Payment success:",n),alert(`\u2705 Payment successful! Payment ID: ${n?.razorpay_payment_id||"N/A"}`),this.goToDietDashboard()}onPaymentFailed(n){console.error("Payment failed:",n);let o=n?.error?.description||"Payment failed. Please try again.";alert(o)}loadRazorpaySdk(){return new Promise((n,o)=>{if(typeof Razorpay<"u")return n();let r=document.getElementById("razorpay-checkout-js");if(r){r.addEventListener("load",()=>n()),r.addEventListener("error",()=>o(new Error("Failed to load Razorpay SDK.")));return}let l=document.createElement("script");l.id="razorpay-checkout-js",l.src="https://checkout.razorpay.com/v1/checkout.js",l.async=!0,l.onload=()=>n(),l.onerror=()=>o(new Error("Failed to load Razorpay SDK.")),document.body.appendChild(l)})}getPayableAmount(){return this.total}static \u0275fac=function(o){return new(o||p)(b(G))};static \u0275cmp=x({type:p,selectors:[["app-payment-screen"]],decls:64,vars:8,consts:[[1,"page-wrap",2,"margin-top","-30px"],[1,"container","py-5"],["novalidate","",3,"formGroup"],[1,"row","g-4","justify-content-between",2,"margin-top","-86px"],[1,"col-12"],[1,"title","mb-4"],[1,"col-lg-7"],[1,"section-heading","mb-3"],[1,"form-group","mb-3","position-relative"],[1,"form-label"],[1,"bi","bi-person","input-icon"],["type","text","placeholder","Enter your Name","formControlName","name",1,"form-control","input-with-icon"],[1,"form-group","flex-fill","mb-3","position-relative"],[1,"bi","bi-envelope","input-icon"],["type","email","placeholder","Enter your Email","formControlName","email",1,"form-control","input-with-icon"],[1,"custom-select-wrapper"],[1,"fi","fi-rr-navigation","input-icon"],["formControlName","country",1,"form-control","custom-select","input-with-icon"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],[1,"col-lg-5"],[1,"card","p-4","shadow-sm","rounded-4","border-0"],[1,"summary-box","rounded-4","p-3"],[1,"d-flex","justify-content-between","py-1"],[1,"muted"],[1,"fw-semibold"],[1,"my-2"],[1,"fw-bold"],["mat-raised-button","","color","primary",1,"pay-btn","w-90","mt-3","makepaymt","rounded-pill",3,"click","disabled"],[3,"value"]],template:function(o,r){o&1&&(t(0,"div",0)(1,"div",1)(2,"form",2)(3,"div",3)(4,"div",4)(5,"h5",5),i(6,"Enter your payment details."),e()(),t(7,"div",6)(8,"h6",7),i(9,"Payment details"),e(),t(10,"div",8)(11,"label",9),i(12,"Name"),e(),m(13,"i",10)(14,"input",11),e(),t(15,"div",12)(16,"label",9),i(17,"Email"),e(),m(18,"i",13)(19,"input",14),e(),t(20,"div",12)(21,"label",9),i(22,"Country"),e(),t(23,"div",15),m(24,"i",16),t(25,"select",17)(26,"option",18),i(27,"Select Country"),e(),v(28,ee,2,2,"option",19),e()()()(),t(29,"div",20)(30,"div",21)(31,"h6",7),i(32,"Order Summary"),e(),t(33,"div",22)(34,"div",23)(35,"span",24),i(36,"Plan"),e(),t(37,"span",25),i(38),e()(),t(39,"div",23)(40,"span",24),i(41,"Plan Price"),e(),t(42,"span",25),i(43),e()(),t(44,"div",23)(45,"span",24),i(46,"Duration"),e(),t(47,"span",25),i(48),e()(),t(49,"div",23)(50,"span",24),i(51,"Income Tax"),e(),t(52,"span",25),i(53),e()(),m(54,"mat-divider",26),t(55,"div",23)(56,"span",25),i(57,"Total Due"),e(),t(58,"span",27),i(59),e()()(),t(60,"button",28),M("click",function(){return r.pay()}),i(61," Make a Payment "),e()()()()()()(),t(62,"div"),m(63,"app-footer"),e()),o&2&&(a(2),c("formGroup",r.form),a(26),c("ngForOf",r.countries),a(10),s(r.plan),a(5),u("$",r.price,"/month"),a(5),s(r.duration),a(5),u("$",r.tax.toFixed(2)),a(6),u("$",r.total.toFixed(2)),a(),c("disabled",r.form.invalid))},dependencies:[C,P,_,E,O,k,w,Y,F,Q,H,q,j,W,K,D,L,B,z,A,I,N,$,R,T,U,J,V],styles:['@charset "UTF-8";.heading-text[_ngcontent-%COMP%]{color:#21534e;font-size:22px;font-weight:700}.form-control.input-with-icon[_ngcontent-%COMP%]{border-radius:50px!important;height:48px;padding-left:40px;background-color:#fff;border:1px solid rgba(219,146,128,.1019607843);color:#db9280}.form-control.input-without-icon[_ngcontent-%COMP%]{background-color:#fff;border:1px solid rgba(219,146,128,.1019607843);border-radius:12px;min-height:120px;padding:12px}.custom-select-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.custom-select-wrapper[_ngcontent-%COMP%]   .input-icon[_ngcontent-%COMP%]{position:absolute;left:14px;top:10px;font-size:18px;color:#db9280;pointer-events:none}.custom-select[_ngcontent-%COMP%]{appearance:none;width:100%;padding:10px 40px;border:1px solid #e0e6ed;border-radius:25px;background-color:#fafbfd;font-size:16px;font-weight:500;color:#1a1a1a;outline:none;cursor:pointer}.makepaymt[_ngcontent-%COMP%]{color:#fff!important}.custom-select[_ngcontent-%COMP%]   option[value=""][_ngcontent-%COMP%]{color:#9ca3af}.custom-select-wrapper[_ngcontent-%COMP%]:after{content:"\\25bc";position:absolute;right:14px;font-size:12px;color:#333;pointer-events:none}.input-icon[_ngcontent-%COMP%]{position:absolute;top:50%;left:12px;color:#db9280!important;font-size:18px;pointer-events:none}.row-input-icon[_ngcontent-%COMP%]{left:24px;background-color:red}.form-label[_ngcontent-%COMP%]{font-weight:500;margin-bottom:6px;color:#495057}.page-wrap[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(180deg,#fff,#f6fbff)}.title[_ngcontent-%COMP%]{color:#303642;font-weight:600}.section-heading[_ngcontent-%COMP%]{color:#101828;font-weight:500}.card[_ngcontent-%COMP%]{background:#fff;border-radius:20px!important}.summary-box[_ngcontent-%COMP%]{background:#f0fbf9;border:1px solid #E9F6F3}.muted[_ngcontent-%COMP%]{color:var(--muted)}.mat-field.mat-mdc-form-field[_ngcontent-%COMP%]{margin-bottom:16px}.mat-mdc-form-field[_ngcontent-%COMP%]   .mdc-text-field--outlined[_ngcontent-%COMP%], .mat-mdc-form-field[_ngcontent-%COMP%]   .mdc-text-field--no-label[_ngcontent-%COMP%]{border-radius:14px!important;background:#f0fbf9}.mat-mdc-form-field[_ngcontent-%COMP%]   .mdc-text-field__input[_ngcontent-%COMP%]{padding-left:6px!important}.mat-mdc-form-field[_ngcontent-%COMP%]   .mat-mdc-form-field-icon-prefix[_ngcontent-%COMP%]{margin-right:6px;color:#14c1b5}.mat-mdc-select-min-line[_ngcontent-%COMP%]{padding-left:0!important}.pay-btn.mdc-button--raised[_ngcontent-%COMP%]{height:52px;font-weight:500;letter-spacing:.2px;background-color:#db9280!important}.pay-btn[_ngcontent-%COMP%]:hover{background-color:#10a99e!important}@media (max-width: 991.98px){.title[_ngcontent-%COMP%]{margin-bottom:.75rem}}']})};export{X as PaymentScreen};
