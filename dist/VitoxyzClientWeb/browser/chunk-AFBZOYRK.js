import{a as T,b as R}from"./chunk-AU2UZ6SR.js";import{a as F}from"./chunk-R46KFOJS.js";import"./chunk-QPED7LSZ.js";import{c as k}from"./chunk-LYOH3LZA.js";import{h as E,i as z,o as w}from"./chunk-KSK4UUXF.js";import{$a as I,Bc as S,Lb as d,Mb as n,Nb as i,Ob as y,Vb as v,Yb as x,_b as p,cb as c,e as P,ga as C,ma as u,mc as r,na as g,nc as b,ob as M,oc as s,tb as f,tc as O}from"./chunk-6LJ32Q7N.js";function q(m,t){m&1&&(n(0,"div",12)(1,"p"),r(2,"Your cart is empty."),i()())}function B(m,t){if(m&1&&(n(0,"span",23),r(1),i()),m&2){let e=p().$implicit;c(),s("\u20B9",e.mrp)}}function Q(m,t){if(m&1&&(n(0,"span",24),r(1),i()),m&2){let e=p().$implicit,o=p();c(),s(" ",o.getDiscount(e),"% off")}}function V(m,t){if(m&1){let e=v();n(0,"div",13)(1,"div"),y(2,"img",14),i(),n(3,"div",15)(4,"h6"),r(5),i(),n(6,"small"),r(7),i(),n(8,"div",16),x("click",function(){let a=u(e).$implicit,l=p();return g(l.removeItem(a.id))}),r(9,"Remove"),i()(),n(10,"div",8)(11,"div",17),r(12),f(13,B,2,1,"span",18)(14,Q,2,1,"span",19),i(),n(15,"div",20)(16,"button",21),x("click",function(){let a=u(e).$implicit,l=p();return g(l.decreaseQty(a))}),r(17,"\u2212"),i(),y(18,"input",22),n(19,"button",21),x("click",function(){let a=u(e).$implicit,l=p();return g(l.increaseQty(a))}),r(20,"+"),i()()()()}if(m&2){let e=t.$implicit;c(2),d("alt",O(e.name))("src",e.image,I),c(3),b(e.name),c(2),b(e.qty||""),c(5),s(" \u20B9",e.price," "),c(),d("ngIf",e.mrp&&e.mrp>e.price),c(),d("ngIf",e.mrp&&e.mrp>e.price),c(4),d("value",e.count)}}function A(m,t){m&1&&(n(0,"p",25),r(1,"Your cart is empty"),i())}var D=class m{cart=[];shippingFee=70;billingForm;razorpayKeyId="rzp_test_RARA6BGk8D2Y2o";isPaymentLoading=!1;router=C(k);cartService=C(R);ngOnInit(){this.refreshCart(),console.log("cartdata",this.cart)}refreshCart(){this.cartService.fetchCart().subscribe({next:()=>{this.cartService.cart$.subscribe(t=>this.cart=t)},error:t=>console.error("Failed to fetch cart:",t)})}removeItem(t){this.cartService.removeItem(t).subscribe({next:()=>alert("Item removed from cart!"),error:e=>alert("Failed to remove item.")})}increaseQty(t){this.cartService.incrementQty(t.id).subscribe({next:()=>console.log("Quantity increased"),error:()=>alert("Failed to increase quantity")})}decreaseQty(t){t.count>1?this.cartService.decrementQty(t.id).subscribe({next:()=>console.log("Quantity decreased"),error:()=>alert("Failed to decrease quantity")}):this.removeItem(t.id)}updateQuantity(t,e){this.cartService.updateQty(t.id,e,t.productType||"otc").subscribe({next:()=>console.log("Quantity updated"),error:()=>alert("Failed to update quantity")})}goToMedicines(){this.router.navigateByUrl("/medicines")}goToViewMedicines(){this.router.navigateByUrl("/medicines/1")}getDiscount(t){return t.mrp&&t.mrp>t.price?Math.round((t.mrp-t.price)/t.mrp*100):0}getItemTotal(){return this.cart.reduce((t,e)=>t+e.price*e.count,0)}getTotalDiscount(){return this.cart.reduce((t,e)=>t+(e.mrp?e.mrp-e.price:0)*e.count,0)}getFinalAmount(){return this.getItemTotal()+this.shippingFee-this.getTotalDiscount()}onProceedToPayment(t,e,o){return P(this,null,function*(){try{if(!this.razorpayKeyId){alert("Razorpay Key ID is missing.");return}let a=this.getPayableAmount();if(!(a>0)){alert("Invalid amount.");return}this.isPaymentLoading=!0,yield this.loadRazorpaySdk();let l={key:this.razorpayKeyId,amount:Math.round(a*100),currency:"INR",name:"Your Company Name",description:"Cart Payment",prefill:{name:t||"",email:"",contact:""},notes:{billing_address:e||"",gst_number:o||""},theme:{color:"#0d6efd"},modal:{ondismiss:()=>console.log("Razorpay Checkout closed.")},handler:_=>{this.onPaymentSuccess(_,a)}},h=new Razorpay(l);h.on("payment.failed",_=>this.onPaymentFailed(_)),h.open()}catch(a){console.error("Payment init error:",a),alert("Unable to start payment. Please try again.")}finally{this.isPaymentLoading=!1}})}onPaymentSuccess(t,e){console.log("Payment success:",t),alert(`Payment successful! Amount paid: \u20B9${e}
Payment ID: ${t?.razorpay_payment_id||"N/A"}`),this.router.navigate(["/medicines"])}onPaymentFailed(t){console.error("Payment failed:",t);let e=t?.error?.description||"Payment failed. Please try again.";alert(e)}loadRazorpaySdk(){return new Promise((t,e)=>{if(typeof Razorpay<"u"){t();return}let o=document.getElementById("razorpay-checkout-js");if(o){o.addEventListener("load",()=>t()),o.addEventListener("error",()=>e(new Error("Failed to load Razorpay SDK.")));return}let a=document.createElement("script");a.id="razorpay-checkout-js",a.src="https://checkout.razorpay.com/v1/checkout.js",a.async=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Razorpay SDK.")),document.body.appendChild(a)})}getPayableAmount(){return this.getFinalAmount()}static \u0275fac=function(e){return new(e||m)};static \u0275cmp=M({type:m,selectors:[["app-cart-items"]],decls:39,vars:7,consts:[["emptyCart",""],[1,"container","my-4"],[1,"my-4"],["class","text-center my-4",4,"ngIf"],["class","cart-item",4,"ngFor","ngForOf"],[1,"bill-summary","border","rounded","p-3","mt-4"],[1,"fw-bold","mb-3"],[1,"table","table-borderless"],[1,"text-end"],[1,"text-end","text-success"],[1,"border-top","fw-bold"],[1,"btn","btn-primary","w-100","rounded-pill",3,"click"],[1,"text-center","my-4"],[1,"cart-item"],[3,"src","alt"],[1,"details"],[1,"remove",3,"click"],[1,"price"],["class","strike",4,"ngIf"],["class","text-success",4,"ngIf"],[1,"qty-box"],[3,"click"],["type","text","readonly","",3,"value"],[1,"strike"],[1,"text-success"],[1,"text-center","text-muted","my-4"]],template:function(e,o){if(e&1){let a=v();y(0,"app-header"),n(1,"div",1)(2,"div",2)(3,"h5"),r(4),i(),n(5,"small"),r(6,"Items not requiring prescription"),i()(),f(7,q,3,0,"div",3)(8,V,21,9,"div",4),n(9,"div",5)(10,"h6",6),r(11,"Bill Summary"),i(),n(12,"table",7)(13,"tbody")(14,"tr")(15,"td"),r(16,"Item Total"),i(),n(17,"td",8),r(18),i()(),n(19,"tr")(20,"td"),r(21,"Total Discount"),i(),n(22,"td",9),r(23),i()(),n(24,"tr")(25,"td"),r(26,"Shipping Fee"),i(),n(27,"td",8),r(28),i()(),n(29,"tr",10)(30,"td"),r(31,"To be Paid"),i(),n(32,"td",8),r(33),i()()()(),n(34,"button",11),x("click",function(){return u(a),g(o.onProceedToPayment())}),r(35,"Continue"),i()()(),f(36,A,2,0,"ng-template",null,0,S),y(38,"app-footer")}e&2&&(c(4),s("",o.cart.length," Item(s) added"),c(3),d("ngIf",o.cart.length===0),c(),d("ngForOf",o.cart),c(10),s("\u20B9",o.getItemTotal()),c(5),s("\u2212 \u20B9",o.getTotalDiscount()),c(5),s("\u20B9",o.shippingFee),c(5),s("\u20B9",o.getFinalAmount()))},dependencies:[F,w,E,z,T],styles:[".action-add[_ngcontent-%COMP%]{position:absolute;right:0}.action-add[_ngcontent-%COMP%]:hover{border-radius:20px!important;color:#fff!important}.action[_ngcontent-%COMP%]{position:absolute;left:0}.action[_ngcontent-%COMP%]:hover{border-radius:20px!important;color:#fff!important}input[_ngcontent-%COMP%]{border-radius:20px!important}td[_ngcontent-%COMP%]{font-size:12px}.border-top[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:16px!important}@media (max-width: 576px){.quantity[_ngcontent-%COMP%]{display:flex!important;justify-content:space-between}.quantity[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-left:10px;min-width:100px!important}}.cart-item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:15px 0;border-bottom:1px solid #eee}.cart-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:70px;height:auto;border-radius:8px}.cart-item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex:1;margin-left:15px}.cart-item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:14px;font-weight:600;margin:0 0 5px}.cart-item[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#6c757d;font-size:12px}.cart-item[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]{font-size:13px;color:#dc3545;cursor:pointer;margin-top:4px}.cart-item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:14px;font-weight:600;margin-bottom:8px}.cart-item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]   .strike[_ngcontent-%COMP%]{text-decoration:line-through;margin-left:6px;font-size:13px}.cart-item[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]   .text-success[_ngcontent-%COMP%]{margin-left:6px;font-size:13px;font-weight:500}.qty-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}.qty-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:1px solid #dc3545;background:transparent;color:#dc3545;padding:2px 8px;font-size:16px;border-radius:4px;cursor:pointer}.qty-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#dc3545;color:#fff}.qty-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:40px;height:32px;text-align:center;margin:0 5px;border:1px solid #ddd;border-radius:4px}.bill-summary[_ngcontent-%COMP%]{background:#fafafa}.bill-summary[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{font-size:.9rem}"]})};export{D as CartItems};
