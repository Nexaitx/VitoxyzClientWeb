import{a as m,b as d}from"./chunk-4GGGPJXP.js";import{b as z}from"./chunk-YXY7IAER.js";import{g as V,h as A,i as L,k as j,l as M,m as H,q as S,r as U}from"./chunk-57WIWK2G.js";import{Db as l,Eb as a,Fb as s,Gb as g,Kb as C,Lb as $,Nb as B,Rb as h,Tb as u,Va as T,Xa as r,_ as O,ab as y,ca as E,fc as f,gc as D,hb as F,hc as x,ia as b,ic as k,ja as _,mb as p,n as w,rc as R,sc as I,tc as N,uc as P}from"./chunk-IHMD6L5C.js";var v=class n{constructor(t){this.http=t}getBookingResponse(){let t=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),e=new S({Authorization:`Bearer ${t}`});return this.http.get(`${m}${d.BOOKING_RESPONSE}`,{headers:e})}removeStaffFromBooking(t){let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),i=new S({Authorization:`Bearer ${e}`});return this.http.delete(`${m}${d.REMOVE_STAFF.replace("{bookingId}",t)}`,{headers:i})}addIndividualStaff(t){let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(!e)return w(()=>new Error("No auth token found"));let i=new S({"Content-Type":"application/json",Authorization:`Bearer ${e}`});return this.http.post(`${m}${d.BOOK_SINGLE_STAFF}`,t,{headers:i})}static \u0275fac=function(e){return new(e||n)(E(U))};static \u0275prov=O({token:n,factory:n.\u0275fac,providedIn:"root"})};var J=(n,t,e)=>({"bi-star-fill text-warning":n,"bi-star-half text-warning":t,"bi-star text-muted":e});function Y(n,t){if(n&1&&(C(0),g(1,"i",24),$()),n&2){let e=t.$implicit;r(),l("ngClass",R(1,J,e==="full",e==="half",e==="empty"))}}function q(n,t){if(n&1){let e=B();a(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10),g(4,"img",11),s(),a(5,"div",12)(6,"div",13)(7,"h6",14)(8,"strong"),f(9),s()(),a(10,"p",15),f(11),s(),a(12,"p",16),p(13,Y,2,5,"ng-container",17),a(14,"span",18),f(15),s()(),a(16,"p",15),f(17),s(),a(18,"div",19)(19,"button",20),h("click",function(){let o=b(e).$implicit,c=u(3);return _(c.addSpecificStaff(o))}),g(20,"i",21),s(),a(21,"button",22),h("click",function(){let o=b(e).$implicit,c=u(3);return _(c.removeStaff(o))}),g(22,"i",23),s()()()()()()()}if(n&2){let e=t.$implicit,i=u(3);r(4),l("src",e.imageUrl||((e.gender==null?null:e.gender.toLowerCase())==="female"?"/assets/female-icon.png":"/assets/male-icon.png"),T),r(5),D(e.name),r(2),k(" ",e.experience," Years Experience | ",e.duties," Duties "),r(2),l("ngForOf",i.getStars(e.rating)),r(2),x("",e.rating,"/5"),r(2),x("\u20B9",e.price),r(2),l("disabled",e.isBooked)}}function W(n,t){if(n&1&&(a(0,"div",4)(1,"div",5),f(2),I(3,"titlecase"),I(4,"number"),s(),p(5,q,23,8,"div",6),s()),n&2){let e=t.$implicit;r(2),k(" ",N(3,3,e.category)," (",P(4,5,(e.availableStaff==null?null:e.availableStaff.length)||0,"2.0"),") "),r(3),l("ngForOf",e.availableStaff)}}function X(n,t){n&1&&(a(0,"div",25)(1,"h2"),f(2,"No staff found."),s()())}function Z(n,t){if(n&1&&(a(0,"div",1),p(1,W,6,8,"div",2)(2,X,3,0,"div",3),s()),n&2){let e=u();r(),l("ngForOf",e.staffDetails),r(),l("ngIf",e.staffDetails.length===0)}}var Q=class n{constructor(t,e){this.router=t;this.bookingResponseService=e}staffDetails=[];ngOnInit(){this.fetchBookingResponses()}fetchBookingResponses(){this.bookingResponseService.getBookingResponse().subscribe({next:t=>{console.log("Raw booking response:",t);let e=t?.staff??[],i=[];e.forEach(o=>{(o.staffDetails??[]).forEach(c=>{i.push({category:c.typeOfStaff,availableStaff:c.availableStaff??[]})})}),console.log("Formatted staff details:",i),this.staffDetails=i},error:t=>{console.error("Error fetching booking responses",t)}})}getStars(t){let e=[];for(let i=0;i<5;i++){let o=i+1;t>=o?e.push("full"):t>o-1&&t<o?e.push("half"):e.push("empty")}return e}removeStaff(t){if(!t.id){console.error("No ID found for staff:",t);return}confirm(`Are you sure you want to remove ${t.name}?`)&&this.bookingResponseService.removeStaffFromBooking(t.id).subscribe({next:e=>{console.log("Staff removed successfully:",e),this.staffDetails.forEach(i=>{i.availableStaff=i.availableStaff.filter(o=>o.id!==t.id)})},error:e=>{console.error("Error removing staff:",e)}})}addSpecificStaff(t){if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){alert("Please login or signup first to access book staff page"),this.router.navigate(["/login"]);return}let i={staffForms:[{typeOfStaff:t.typeOfStaff||t.category,typeOfSubStaff:t.typeOfSubStaff,shifts:[{timeSlot:t.timeSlot,shiftType:t.shiftType||"Day",maleQuantity:t.gender?.toLowerCase()==="male"?1:0,femaleQuantity:t.gender?.toLowerCase()==="female"?1:0,tenure:t.tenure,dutyStartDate:String(t.dutyStartDate||new Date().toISOString().split("T")[0])}]}]};console.log("Full API URL:",`${m}${d.BOOK_SINGLE_STAFF}`),console.log("Payload to API:",JSON.stringify(i,null,2)),confirm(`Add ${t.name} (${t.typeOfSubStaff} ${t.typeOfStaff||t.category}) to your booking?`)&&this.bookingResponseService.addIndividualStaff(i).subscribe({next:o=>{console.log("Staff added successfully:",o),alert(`${t.name} has been added to your booking!`),t.isBooked=!0},error:o=>{console.error("Error adding staff:",o),alert("Failed to add staff. Please try again.")}})}static \u0275fac=function(e){return new(e||n)(y(z),y(v))};static \u0275cmp=F({type:n,selectors:[["app-view-staff"]],decls:1,vars:1,consts:[["class","container-fluid mt-4",4,"ngIf"],[1,"container-fluid","mt-4"],["class","row",4,"ngFor","ngForOf"],["class","text-center mt-4",4,"ngIf"],[1,"row"],[1,"col-12","mb-2"],["class","col-md-3 mb-4",4,"ngFor","ngForOf"],[1,"col-md-3","mb-4"],[1,"card","h-100","shadow-sm"],[1,"row","g-0"],[1,"col-5","d-flex","align-items-center","justify-content-center","p-2"],["alt","Staff Image",1,"img-fluid","rounded",3,"src"],[1,"col-7"],[1,"card-body","p-2"],[1,"card-title","mb-1"],[1,"mb-1","text-muted"],[1,"mb-1"],[4,"ngFor","ngForOf"],[1,"ms-1","text-muted"],[1,"d-flex","justify-content-start","gap-2","mt-2"],[1,"btn","btn-sm","btn-outline-success",3,"click","disabled"],[1,"bi","bi-arrow-left-right"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-x-lg"],[1,"bi",3,"ngClass"],[1,"text-center","mt-4"]],template:function(e,i){e&1&&p(0,Z,3,2,"div",0),e&2&&l("ngIf",i.staffDetails.length>0)},dependencies:[H,V,A,L,M,j],styles:[".text-center[_ngcontent-%COMP%]{position:fixed;top:50%;left:45%}.bi-star-half.text-warning[_ngcontent-%COMP%], .bi-star-full.text-warning[_ngcontent-%COMP%]{color:#000!important}"]})};export{Q as ViewStaff};
