import{a as H}from"./chunk-H7JJ2GVT.js";import{a as L,b as V}from"./chunk-K4DNWDKO.js";import{b as M}from"./chunk-RAX3NO2F.js";import"./chunk-NRD3KBLP.js";import"./chunk-TCBDXEG3.js";import"./chunk-TIMTJE23.js";import{b as F}from"./chunk-WOJRJ4NL.js";import{a as k}from"./chunk-QG4OT5A4.js";import{a as w,b as N,c as R}from"./chunk-3N32ICGW.js";import"./chunk-OTHMNLYJ.js";import"./chunk-SP7GYIMR.js";import{a as T}from"./chunk-CLG2LXF4.js";import"./chunk-TMNAOABQ.js";import"./chunk-MFYBXPGH.js";import{c as P}from"./chunk-DHDG4QUY.js";import{h as I,i as S,p as D}from"./chunk-QI76QBAE.js";import{$a as h,Lb as l,Mb as i,Nb as r,Ob as m,Vb as v,_b as f,ac as c,cb as o,ga as E,ma as b,na as _,nc as O,ob as C,oc as a,pc as y,qc as p,rc as x,tb as g}from"./chunk-VVX2ZSCF.js";function A(n,t){n&1&&(i(0,"div",7)(1,"div",8)(2,"span",9),a(3,"Loading..."),r()(),i(4,"p",10),a(5,"Loading your orders..."),r()())}function G(n,t){if(n&1){let e=v();i(0,"div",7)(1,"div",11),m(2,"i",12),i(3,"h4",13),a(4,"No Orders Yet"),r(),i(5,"p",4),a(6,"You haven't placed any orders yet."),r(),i(7,"button",14),f("click",function(){b(e);let d=c();return _(d.router.navigate(["/medicines"]))}),a(8," Start Shopping "),r()()()}}function B(n,t){if(n&1&&m(0,"mat-tab",20),n&2){let e=t.$implicit;l("label",e.label+" ("+e.count+")")}}function $(n,t){if(n&1&&(i(0,"div",48)(1,"small",4),a(2),r()()),n&2){let e=c().$implicit;o(2),p("Form: ",e.productForm)}}function Y(n,t){if(n&1&&(i(0,"div",41)(1,"div",42),m(2,"img",43),r(),i(3,"div",44)(4,"h6",45),a(5),r(),i(6,"small",4),a(7),r(),g(8,$,3,1,"div",46),r(),i(9,"div",47)(10,"div",3),a(11),r(),i(12,"small",4),a(13),r()()()),n&2){let e=t.$implicit;o(2),l("src",e.imageUrl||"assets/no-image.png",h)("alt",e.productName),o(3),y(e.productName),o(2),x(" ",e.packaging," \u2022 Qty: ",e.quantity," "),o(),l("ngIf",e.productForm),o(3),p("\u20B9",e.totalPrice),o(2),p("\u20B9",e.unitPrice," each")}}function q(n,t){if(n&1){let e=v();i(0,"button",49),f("click",function(){b(e);let d=c().$implicit,u=c(2);return _(u.trackOrder(d))}),m(1,"i",50),a(2,"Track Order "),r()}}function j(n,t){if(n&1){let e=v();i(0,"button",51),f("click",function(){b(e);let d=c().$implicit,u=c(2);return _(u.cancelOrder(d))}),m(1,"i",52),a(2,"Cancel "),r()}}function z(n,t){if(n&1){let e=v();i(0,"div",21)(1,"div",22)(2,"div",23)(3,"div",24)(4,"div",25)(5,"span",3),a(6),r(),i(7,"small",4),a(8),r()()(),i(9,"div",26)(10,"div",27)(11,"span",28),a(12),r(),i(13,"span"),a(14),r()()()()(),i(15,"div",29),g(16,Y,14,8,"div",30),r(),i(17,"div",31)(18,"div",23)(19,"div",24)(20,"div",32)(21,"span",3),a(22),r(),i(23,"small",4),a(24),r()(),i(25,"small",33),a(26),r()(),i(27,"div",26)(28,"div",34)(29,"button",35),f("click",function(){let d=b(e).$implicit,u=c(2);return _(u.viewOrderDetails(d))}),m(30,"i",36),a(31,"View Details "),r(),g(32,q,3,0,"button",37),i(33,"button",38),f("click",function(){let d=b(e).$implicit,u=c(2);return _(u.reorderItems(d))}),m(34,"i",39),a(35,"Reorder "),r(),g(36,j,3,0,"button",40),r()()()()()}if(n&2){let e=t.$implicit,s=c(2);o(6),p("Order #",e.orderNumber),o(2),p("Placed on ",s.formatDate(e.orderDate)),o(3),O(s.getStatusClass(e.status)),o(),p(" ",s.getStatusText(e.status)," "),o(),O(s.getPaymentStatusClass(e.paymentStatus)),o(),p(" ",s.getPaymentStatusText(e.paymentStatus)," "),o(2),l("ngForOf",e.orderItems),o(6),p("Total: \u20B9",e.finalAmount),o(2),x(" \u2022 ",s.getTotalItems(e)," item",s.getTotalItems(e)>1?"s":""," "),o(2),p(" Payment: ",e.paymentMethod," "),o(6),l("ngIf",s.canTrackOrder(e)),o(4),l("ngIf",s.canCancelOrder(e))}}function Q(n,t){if(n&1){let e=v();i(0,"div",7)(1,"div",11),m(2,"i",53),i(3,"h4",13),a(4,"No Orders Found"),r(),i(5,"p",4),a(6,"No orders match the selected filter."),r(),i(7,"button",54),f("click",function(){b(e);let d=c(2);return d.selectedTab=0,_(d.filterOrders("all"))}),a(8," View All Orders "),r()()()}}function J(n,t){if(n&1){let e=v();i(0,"div",15)(1,"div",2)(2,"mat-tab-group",16),f("selectedIndexChange",function(d){b(e);let u=c();return _(u.onTabChange(d))}),g(3,B,1,1,"mat-tab",17),r(),i(4,"div",18),g(5,z,37,15,"div",19),r(),g(6,Q,9,0,"div",5),r()()}if(n&2){let e=c();o(2),l("selectedIndex",e.selectedTab),o(),l("ngForOf",e.orderFilters),o(2),l("ngForOf",e.filteredOrders),o(),l("ngIf",e.filteredOrders.length===0&&e.orders.length>0)}}var U=class n{orderService=E(H);router=E(P);cartService=E(F);snackBar=E(L);orders=[];filteredOrders=[];isLoading=!1;selectedTab=0;orderFilters=[{value:"all",label:"All Orders",count:0},{value:"pending",label:"Pending",count:0},{value:"delivered",label:"Delivered",count:0},{value:"cancelled",label:"Cancelled",count:0}];ordersSubscription;ngOnInit(){this.loadOrders()}ngOnDestroy(){this.ordersSubscription&&this.ordersSubscription.unsubscribe()}loadOrders(){this.isLoading=!0,this.ordersSubscription=this.orderService.getUserOrders().subscribe({next:t=>{this.isLoading=!1,t.status&&t.data?(this.orders=t.data,this.filteredOrders=this.orders,this.updateOrderCounts(),console.log("\u2705 Orders loaded:",this.orders.length)):this.showError("Failed to load orders")},error:t=>{this.isLoading=!1,console.error("\u274C Error loading orders:",t),this.showError("Failed to load orders. Please try again.")}})}updateOrderCounts(){this.orderFilters[0].count=this.orders.length,this.orderFilters[1].count=this.orders.filter(t=>["PENDING","CONFIRMED","PROCESSING","SHIPPED","OUT_FOR_DELIVERY"].includes(t.status)).length,this.orderFilters[2].count=this.orders.filter(t=>t.status==="DELIVERED").length,this.orderFilters[3].count=this.orders.filter(t=>["CANCELLED","RETURNED","REFUNDED"].includes(t.status)).length}filterOrders(t){switch(t){case"all":this.filteredOrders=this.orders;break;case"pending":this.filteredOrders=this.orders.filter(e=>["PENDING","CONFIRMED","PROCESSING","SHIPPED","OUT_FOR_DELIVERY"].includes(e.status));break;case"delivered":this.filteredOrders=this.orders.filter(e=>e.status==="DELIVERED");break;case"cancelled":this.filteredOrders=this.orders.filter(e=>["CANCELLED","RETURNED","REFUNDED"].includes(e.status));break;default:this.filteredOrders=this.orders}}onTabChange(t){this.selectedTab=t;let e=this.orderFilters[t].value;this.filterOrders(e)}getStatusClass(t){switch(t){case"DELIVERED":return"badge bg-success";case"CANCELLED":case"RETURNED":case"REFUNDED":return"badge bg-danger";case"PENDING":return"badge bg-warning";case"CONFIRMED":case"PROCESSING":return"badge bg-info";case"SHIPPED":case"OUT_FOR_DELIVERY":return"badge bg-primary";default:return"badge bg-secondary"}}getStatusText(t){return{PENDING:"Pending",CONFIRMED:"Confirmed",PROCESSING:"Processing",SHIPPED:"Shipped",OUT_FOR_DELIVERY:"Out for Delivery",DELIVERED:"Delivered",CANCELLED:"Cancelled",RETURNED:"Returned",REFUNDED:"Refunded"}[t]||t}getPaymentStatusClass(t){switch(t){case"PAID":return"badge bg-success";case"PENDING":return"badge bg-warning";case"FAILED":case"CANCELLED":return"badge bg-danger";case"REFUNDED":return"badge bg-info";default:return"badge bg-secondary"}}getPaymentStatusText(t){return{PENDING:"Payment Pending",PAID:"Paid",FAILED:"Payment Failed",REFUNDED:"Refunded",CANCELLED:"Cancelled"}[t]||t}viewOrderDetails(t){this.router.navigate(["/order",t.orderId])}reorderItems(t){t.orderItems.forEach(e=>{let s={id:e.productId,name:e.productName,price:e.unitPrice,mrp:e.unitPrice,image:e.imageUrl,qty:e.packaging,count:e.quantity,productType:e.productType};this.cartService.addItem(s,e.quantity).subscribe({next:()=>{console.log(" Item added to cart:",e.productName)},error:d=>{console.error("\u274C Failed to add item to cart:",d)}})}),this.showSuccess("Items added to cart!"),setTimeout(()=>{this.router.navigate(["/cart"])},1e3)}cancelOrder(t){if(confirm("Are you sure you want to cancel this order?")){if(t.status==="DELIVERED"||t.status==="SHIPPED"){this.showError("This order cannot be cancelled as it is already shipped or delivered.");return}this.orderService.cancelOrder(t.orderId).subscribe({next:e=>{e.status?(this.showSuccess("Order cancelled successfully!"),this.loadOrders()):this.showError("Failed to cancel order.")},error:e=>{console.error(" Error cancelling order:",e),this.showError("Failed to cancel order. Please try again.")}})}}trackOrder(t){this.router.navigate(["/order-tracking",t.orderNumber])}showSuccess(t){this.snackBar.open(t,"Close",{duration:3e3,panelClass:["success-snackbar"]})}showError(t){this.snackBar.open(t,"Close",{duration:5e3,panelClass:["error-snackbar"]})}canCancelOrder(t){return["PENDING","CONFIRMED","PROCESSING"].includes(t.status)}canTrackOrder(t){return["CONFIRMED","PROCESSING","SHIPPED","OUT_FOR_DELIVERY"].includes(t.status)}formatDate(t){return new Date(t).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}getTotalItems(t){return t.orderItems.reduce((e,s)=>e+s.quantity,0)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=C({type:n,selectors:[["app-order-history"]],decls:12,vars:3,consts:[[1,"container","my-4","min-vh-100"],[1,"row","mb-4"],[1,"col-12"],[1,"fw-bold"],[1,"text-muted"],["class","text-center my-5",4,"ngIf"],["class","row",4,"ngIf"],[1,"text-center","my-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"empty-state"],[1,"bi","bi-box-seam","display-1","text-muted"],[1,"mt-3"],[1,"btn","btn-primary","mt-3",3,"click"],[1,"row"],[3,"selectedIndexChange","selectedIndex"],[3,"label",4,"ngFor","ngForOf"],[1,"orders-list","mt-4"],["class","order-card border rounded mb-4",4,"ngFor","ngForOf"],[3,"label"],[1,"order-card","border","rounded","mb-4"],[1,"order-header","p-3","border-bottom","bg-light"],[1,"row","align-items-center"],[1,"col-md-6"],[1,"d-flex","flex-column"],[1,"col-md-6","text-md-end"],[1,"d-flex","flex-column","flex-md-row","justify-content-md-end","gap-2"],[1,"me-2"],[1,"order-items","p-3"],["class","order-item row align-items-center mb-3 pb-3 border-bottom",4,"ngFor","ngForOf"],[1,"order-footer","p-3","border-top","bg-light"],[1,"d-flex","flex-wrap","gap-2","align-items-center"],[1,"text-muted","d-block","mt-1"],[1,"d-flex","flex-wrap","gap-2","justify-content-md-end"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"bi","bi-eye","me-1"],["class","btn btn-outline-info btn-sm",3,"click",4,"ngIf"],[1,"btn","btn-outline-success","btn-sm",3,"click"],[1,"bi","bi-arrow-repeat","me-1"],["class","btn btn-outline-danger btn-sm",3,"click",4,"ngIf"],[1,"order-item","row","align-items-center","mb-3","pb-3","border-bottom"],[1,"col-2","col-md-1"],[1,"img-fluid","rounded",2,"max-height","60px","object-fit","cover",3,"src","alt"],[1,"col-7","col-md-8"],[1,"mb-1"],["class","mt-1",4,"ngIf"],[1,"col-3","col-md-3","text-end"],[1,"mt-1"],[1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"bi","bi-geo-alt","me-1"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-x-circle","me-1"],[1,"bi","bi-search","display-1","text-muted"],[1,"btn","btn-outline-primary","mt-3",3,"click"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),a(4,"My Orders"),r(),i(5,"p",4),a(6,"View and manage your order history"),r()()(),g(7,A,6,0,"div",5)(8,G,9,0,"div",5)(9,J,7,4,"div",6),r(),m(10,"app-footer")(11,"app-mobile-footer-nav")),e&2&&(o(7),l("ngIf",s.isLoading),o(),l("ngIf",!s.isLoading&&s.orders.length===0),o(),l("ngIf",!s.isLoading&&s.orders.length>0))},dependencies:[D,I,S,T,M,V,R,w,N,k],styles:[".order-card[_ngcontent-%COMP%]{background:#fff;transition:box-shadow .3s ease}.order-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #0000001a}.order-item[_ngcontent-%COMP%]:last-child{border-bottom:none!important;margin-bottom:0!important;padding-bottom:0!important}.empty-state[_ngcontent-%COMP%]{padding:3rem 1rem}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:.5}.badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.375rem .75rem}  .mat-tab-group{font-family:inherit}  .mat-tab-label{font-weight:500;opacity:1!important}  .mat-tab-label.mat-tab-label-active{color:#0d6efd;font-weight:600}  .mat-ink-bar{background-color:#0d6efd!important}@media (max-width: 768px){.order-header[_ngcontent-%COMP%], .order-footer[_ngcontent-%COMP%]{text-align:center}.order-footer[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:.5rem;width:100%}.order-item[_ngcontent-%COMP%]{text-align:center}.order-item[_ngcontent-%COMP%]   .col-2[_ngcontent-%COMP%], .order-item[_ngcontent-%COMP%]   .col-7[_ngcontent-%COMP%], .order-item[_ngcontent-%COMP%]   .col-3[_ngcontent-%COMP%]{margin-bottom:.5rem}}  .success-snackbar{background:#198754;color:#fff}  .error-snackbar{background:#dc3545;color:#fff}"]})};export{U as OrderHistoryComponent};
