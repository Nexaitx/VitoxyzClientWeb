import{d as Le,f as Pe}from"./chunk-3N32ICGW.js";import{a as j,b as F}from"./chunk-OTHMNLYJ.js";import"./chunk-SP7GYIMR.js";import{a as Ae}from"./chunk-CLG2LXF4.js";import"./chunk-TMNAOABQ.js";import{F as me,G as b,J as he,K as _e,L as fe,O as ye,P as ve,R as Me,S as be,T as Ce,U as ze,V as xe,W as ke,X as we,Y as Se,Z as Ie,aa as Oe,ba as De,da as Ee}from"./chunk-MFYBXPGH.js";import{c as pe}from"./chunk-DHDG4QUY.js";import{h as se,i as le,n as de,p as ce,v as ge,w as ue}from"./chunk-QI76QBAE.js";import{$b as re,Dc as N,Ec as Q,Gb as C,Hb as z,Lb as p,Mb as l,Nb as s,Ob as _,Pb as ie,Qb as ne,Sb as V,Tb as Z,Vb as I,_b as v,a as L,ac as d,b as R,ba as q,ca as Y,cb as g,ec as ae,fc as U,ga as G,gc as $,hb as X,l as J,ma as f,mc as D,na as y,ob as P,oc as u,pb as ee,pc as oe,qc as O,tb as x,wb as te,xc as A}from"./chunk-VVX2ZSCF.js";var Fe=(()=>{class o{static \u0275fac=function(r){return new(r||o)};static \u0275mod=ee({type:o});static \u0275inj=Y({})}return o})();var Qe=["mapElement"],H=class o{mapElement;locationSelected=new te;userLat=28.6139;userLng=77.209;map;ngOnInit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.userLat=t.coords.latitude,this.userLng=t.coords.longitude,this.initMap()},t=>{console.error("Geolocation error:",t),this.initMap()}):(console.warn("Geolocation not supported"),this.initMap())}ngAfterViewInit(){navigator.geolocation||this.initMap()}initMap(){if(typeof google>"u"||!google.maps){console.error("Google Maps API not loaded");return}this.map=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:this.userLat,lng:this.userLng},zoom:12}),new google.maps.Marker({map:this.map,position:{lat:this.userLat,lng:this.userLng},title:"You are here"}),this.map.addListener("click",t=>{let e=t.latLng.lat(),r=t.latLng.lng();this.locationSelected.emit({lat:e,lng:r})})}onMapClick(t){let e=t.latLng.lat(),r=t.latLng.lng();this.locationSelected.emit({lat:e,lng:r})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=P({type:o,selectors:[["app-map"]],viewQuery:function(e,r){if(e&1&&ae(Qe,5),e&2){let i;U(i=$())&&(r.mapElement=i.first)}},outputs:{locationSelected:"locationSelected"},decls:2,vars:0,consts:[["mapElement",""],[1,"map-container",3,"mapClick"]],template:function(e,r){if(e&1){let i=I();ie(0,"div",1,0),re("mapClick",function(a){return f(i),y(r.onMapClick(a))}),ne()}},dependencies:[Fe],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:auto;min-height:400px;margin-top:10px;position:relative!important;overflow:hidden!important}[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     #mapElement{width:100%;height:90%}"]})};var W=class o{_loading=new J(!1);loading$=this._loading.asObservable();show(){this._loading.next(!0)}hide(){this._loading.next(!1)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=q({token:o,factory:o.\u0275fac,providedIn:"root"})};function He(o,t){o&1&&(l(0,"div",16),u(1,"Area is required."),s())}function We(o,t){if(o&1&&(l(0,"div",22),_(1,"div",27),l(2,"span",28),u(3),s(),_(4,"div",27),s()),o&2){let e=d().index;g(3),oe(e)}}function qe(o,t){if(o&1){let e=I();l(0,"button",29),v("click",function(){f(e);let i=d().index,n=d();return y(n.removeStaff(i))}),_(1,"i",30),s()}}function Ue(o,t){if(o&1&&(l(0,"option",38),u(1),s()),o&2){let e=t.$implicit;p("value",e.name),g(),O(" ",e.name," ")}}function $e(o,t){o&1&&(l(0,"div",16),u(1," Type of Staff is required. "),s())}function Ke(o,t){if(o&1&&(l(0,"option",38),u(1),s()),o&2){let e=t.$implicit;p("value",e.value),g(),O(" ",e.label," ")}}function Je(o,t){if(o&1&&(l(0,"div",16),u(1),N(2,"titlecase"),s()),o&2){let e,r=d(2).$implicit;g(),O(" Type of ",Q(2,1,(e=r.get("typeOfStaff"))==null?null:e.value)," is required. ")}}function Ye(o,t){if(o&1&&(V(0),l(1,"div",39)(2,"div",12)(3,"label",33),u(4),N(5,"titlecase"),s(),_(6,"i",40),l(7,"select",41)(8,"option",36),u(9),N(10,"titlecase"),s(),x(11,Ke,2,2,"option",37),s(),C(12,Je,3,3,"div",16),s()(),Z()),o&2){let e,r,i,n,a,c=d().$implicit,m=d().index,M=d();g(3),p("for",A("typeOfSubStaff-",m)),g(),O("Select ",Q(5,11,(e=c.get("typeOfStaff"))==null?null:e.value)," Type"),g(3),D("is-invalid",((r=c.get("typeOfSubStaff"))==null?null:r.invalid)&&((r=c.get("typeOfSubStaff"))==null?null:r.touched)),p("id",A("typeOfSubStaff-",m))("disabled",!((i=c.get("typeOfStaff"))!=null&&i.value)),g(2),O(" Select ",Q(10,13,(n=c.get("typeOfStaff"))==null?null:n.value)," "),g(2),p("ngForOf",M.staffSubCategories[m]),g(),z((a=c.get("typeOfSubStaff"))!=null&&a.invalid&&((a=c.get("typeOfSubStaff"))!=null&&a.touched)?12:-1)}}function Xe(o,t){if(o&1&&(l(0,"div",31)(1,"div",1)(2,"div",32)(3,"div",12)(4,"label",33),u(5,"Select Staff Type"),s(),_(6,"i",34),l(7,"select",35)(8,"option",36),u(9,"Select Type"),s(),x(10,Ue,2,2,"option",37),s(),C(11,$e,2,0,"div",16),s()(),C(12,Ye,13,15,"ng-container"),s()()),o&2){let e,r,i,n=t.$implicit,a=t.index,c=d().index,m=d();p("formGroupName",a),g(4),p("for",A("typeOfStaff-",c)),g(3),D("is-invalid",((e=n.get("typeOfStaff"))==null?null:e.invalid)&&((e=n.get("typeOfStaff"))==null?null:e.touched)),p("id",A("typeOfStaff-",c)),g(3),p("ngForOf",m.staffCategories),g(),z((r=n.get("typeOfStaff"))!=null&&r.invalid&&((r=n.get("typeOfStaff"))!=null&&r.touched)?11:-1),g(),z((i=n.get("typeOfStaff"))!=null&&i.value&&((i=n.get("typeOfStaff"))==null?null:i.value)!==""?12:-1)}}function et(o,t){if(o&1&&(l(0,"option",38),u(1),s()),o&2){let e=t.$implicit;p("value",e),g(),O(" ",e," ")}}function tt(o,t){o&1&&(l(0,"div",16),u(1," Shift Type is required. "),s())}function it(o,t){o&1&&(l(0,"div",67),u(1," Quantity is required. "),s())}function nt(o,t){if(o&1&&(l(0,"option",38),u(1),s()),o&2){let e=t.$implicit;p("value",e.value),g(),O(" ",e.label," ")}}function rt(o,t){o&1&&(l(0,"div",16),u(1," Tenure is required. "),s())}function at(o,t){o&1&&(l(0,"div",16),u(1," Duty End Date is required. "),s())}function ot(o,t){if(o&1&&(l(0,"div",72)(1,"label",13),u(2,"Duty End Date"),s(),_(3,"input",78),x(4,at,2,0,"div",79),s()),o&2){let e,r,i=d().$implicit,n=d(3);g(3),p("min",((e=i.get("dutyStartDate"))==null?null:e.value)||n.today),g(),p("ngIf",((r=i.get("dutyEndDate"))==null?null:r.invalid)&&((r=i.get("dutyEndDate"))==null?null:r.touched))}}function st(o,t){if(o&1){let e=I();l(0,"i",80),v("click",function(){f(e);let i=d(3).index,n=d();return y(n.addShift(i))}),s()}}function lt(o,t){if(o&1){let e=I();l(0,"i",81),v("click",function(){f(e);let i=d().index,n=d(2).index,a=d();return y(a.removeShiftDetail(n,i))}),s()}}function dt(o,t){if(o&1){let e=I();l(0,"div",44)(1,"div",45)(2,"div",46)(3,"div",47)(4,"label",13),u(5,"Preferred Time Slot"),s(),l(6,"div",48)(7,"div",49)(8,"button",50),v("click",function(){let i=f(e).index,n=d(2).index,a=d();return y(a.decrementTime("hours",n,i))}),_(9,"i",51),s(),l(10,"input",52),v("input",function(i){let n=f(e).index,a=d(2).index,c=d();return y(c.onManualTimeChange("hours",a,n,i))}),s(),l(11,"button",53),v("click",function(){let i=f(e).index,n=d(2).index,a=d();return y(a.incrementTime("hours",n,i))}),_(12,"i",54),s()(),l(13,"div",55)(14,"button",50),v("click",function(){let i=f(e).index,n=d(2).index,a=d();return y(a.decrementTime("minutes",n,i))}),_(15,"i",51),s(),l(16,"input",56),v("input",function(i){let n=f(e).index,a=d(2).index,c=d();return y(c.onManualTimeChange("minutes",a,n,i))}),s(),l(17,"button",53),v("click",function(){let i=f(e).index,n=d(2).index,a=d();return y(a.incrementTime("minutes",n,i))}),_(18,"i",54),s()(),l(19,"select",57)(20,"option",58),u(21,"AM"),s(),l(22,"option",59),u(23,"PM"),s()()()(),l(24,"div",60)(25,"label",13),u(26,"Shift Duration"),s(),l(27,"select",61),x(28,et,2,2,"option",37),s(),C(29,tt,2,0,"div",16),s(),l(30,"div",62)(31,"div",63)(32,"label",64),u(33,"Preferred Gender"),s(),l(34,"div",55),_(35,"i",65),l(36,"span",66),u(37,"Male"),s()(),l(38,"div",55),_(39,"i",65),l(40,"span",66),u(41,"Female"),s()(),C(42,it,2,0,"div",67),s(),l(43,"div",68)(44,"label",13),u(45,"Quantity"),s(),l(46,"div",49)(47,"button",50),v("click",function(){let i=f(e).index,n=d(2).index,a=d();return y(a.decrease("maleQuantity",n,i))}),_(48,"i",51),s(),l(49,"input",69),v("input",function(i){let n=f(e).index,a=d(2).index,c=d();return y(c.onManualChange("maleQuantity",a,n,i))}),s(),l(50,"button",53),v("click",function(){let i=f(e).index,n=d(2).index,a=d();return y(a.increase("maleQuantity",n,i))}),_(51,"i",54),s()(),l(52,"div",49)(53,"button",50),v("click",function(){let i=f(e).index,n=d(2).index,a=d();return y(a.decrease("femaleQuantity",n,i))}),_(54,"i",51),s(),l(55,"input",69),v("input",function(i){let n=f(e).index,a=d(2).index,c=d();return y(c.onManualChange("femaleQuantity",a,n,i))}),s(),l(56,"button",53),v("click",function(){let i=f(e).index,n=d(2).index,a=d();return y(a.increase("femaleQuantity",n,i))}),_(57,"i",54),s()()()(),l(58,"div",60)(59,"div",12)(60,"label",13),u(61,"Tenure"),s(),l(62,"div",55),_(63,"i",70),l(64,"select",71),x(65,nt,2,2,"option",37),s()(),C(66,rt,2,0,"div",16),s()()(),l(67,"div",1)(68,"div",72)(69,"label",13),u(70,"Duty Start Date"),s(),_(71,"input",73),s(),x(72,ot,5,2,"div",74),s(),l(73,"div",75),C(74,st,1,0,"i",76),C(75,lt,1,0,"i",77),s()()()}if(o&2){let e,r,i,n,a,c,m,M,h=t.$implicit,k=t.index,E=d(2).index,w=d();p("formGroupName",k),g(6),D("is-invalid",((e=h.get("timeSlot"))==null||e.errors==null?null:e.errors.pastTime)&&((e=h.get("timeSlot"))==null?null:e.touched)),g(4),p("value",w.pad((r=h.get("hours"))==null?null:r.value)),g(6),p("value",w.pad((i=h.get("minutes"))==null?null:i.value)),g(11),D("is-invalid",((n=h.get("preferredTimeSlot"))==null?null:n.invalid)&&((n=h.get("preferredTimeSlot"))==null?null:n.touched)),g(),p("ngForOf",w.preferredTimeSlots),g(),z((a=h.get("preferredTimeSlot"))!=null&&a.invalid&&((a=h.get("preferredTimeSlot"))!=null&&a.touched)?29:-1),g(13),z(h.errors!=null&&h.errors.zeroQuantity&&(h.touched||h.dirty)?42:-1),g(7),p("formControlName","maleQuantity"),g(6),p("formControlName","femaleQuantity"),g(9),D("is-invalid",((c=h.get("tenure"))==null?null:c.invalid)&&((c=h.get("tenure"))==null?null:c.touched)),g(),p("ngForOf",w.tenure),g(),z((m=h.get("tenure"))!=null&&m.invalid&&((m=h.get("tenure"))!=null&&m.touched)?66:-1),g(5),p("min",w.today),g(),p("ngIf",((M=h.get("tenure"))==null?null:M.value)!=="1"),g(2),z(k===0||k===w.getNestedShiftDetailsControls(E).length-1?74:-1),g(),z(k>0?75:-1)}}function ct(o,t){if(o&1&&(V(0),l(1,"div",42),x(2,dt,76,20,"div",43),s(),Z()),o&2){let e=d().index,r=d();g(2),p("ngForOf",r.getNestedShiftDetailsControls(e))}}function gt(o,t){if(o&1&&(l(0,"div",21),C(1,We,5,1,"div",22),l(2,"div",23),C(3,qe,2,0,"button",24),s(),l(4,"div",25),x(5,Xe,13,10,"div",26),s(),C(6,ct,3,1,"ng-container"),s()),o&2){let e,r=t.index,i=d();p("formGroupName",r),g(),z(r>0?1:-1),g(2),z(r!==0?3:-1),g(2),p("ngForOf",i.getNestedStaffDetailsControls(r)),g(),z((e=i.getNestedStaffDetailsControls(r)[0].get("typeOfStaff"))!=null&&e.value?6:-1)}}function ut(o,t){if(o&1){let e=I();V(0),l(1,"div",82)(2,"button",83),v("click",function(){f(e);let i=d();return y(i.addNewStaff())}),_(3,"i",54),u(4,"Add Another Staff "),s()(),l(5,"div",84),_(6,"app-submission",85),s(),Z()}if(o&2){let e=d();g(6),p("buttonType",e.button)("disableButton",e.isSubmitting)}}function pt(o,t){if(o&1){let e=I();l(0,"app-authorization",86),v("loginSuccess",function(){f(e);let i=d();return y(i.onAuthSuccess())})("close",function(){f(e);let i=d();return y(i.onAuthClose())}),s()}if(o&2){let e=d();p("showAuthModal",e.showAuthPopup)("authMode","login")}}var Te=class o{constructor(t){this.spinnerService=t}fb=G(De);http=G(ue);router=G(pe);staffBookingForm;hours=Array.from({length:24},(t,e)=>e);minutes=[0,15,30,45];nurseTenure=["1 Day","15 Days","Monthly","Quarterly","Half Yearly","Yearly"];button="Search for staff";staffCategories=[];staffSubCategories={};preferredTimeSlots=["2 Hours","8 Hours","12 Hours","24 Hours"];tenure=[{label:"1 Day",value:"1"},{label:"3 Days",value:"2"},{label:"1 Week",value:"3"},{label:"2 Weeks",value:"4"},{label:"1 Month",value:"5"}];today=new Date().toISOString().split("T")[0];showAadharPopup=!1;showAuthPopup=!1;time={hour:13,minute:30};meridian=!0;isSubmitting=!1;ngOnInit(){this.getUserLocation(),this.getStaffCategories(),this.staffBookingForm=this.fb.group({userAddress:["",b.required],address:["",b.required],latitude:[],longitude:[],staffForms:this.fb.array([this.createStaffFormGroup()])}),this.subscribeToCategoryChange(0)}getStaffCategories(){let t=j+F.CATEGORIES;this.http.get(t).subscribe({next:e=>{this.staffCategories=e||[]},error:e=>{console.error("Error fetching categories:",e)}})}subscribeToCategoryChange(t){let i=this.staffListFormArray.at(t).get("staffDetails").at(0);i.get("typeOfStaff")?.valueChanges.subscribe(n=>{let a=this.staffCategories.find(c=>c.name===n);if(a){let c=a.id;this.fetchSubCategories(c,t),i.get("typeOfSubStaff")?.setValue("")}})}incrementTime(t,e,r){let i=this.getShiftGroup(e,r);if(i)if(t==="hours"){let n=+i.get("hours")?.value||1;n=n%12+1,n===0&&(n=12),i.get("hours")?.setValue(n)}else{let n=+i.get("minutes")?.value||0;n=(n+1)%60,i.get("minutes")?.setValue(n)}}decrementTime(t,e,r){let i=this.getShiftGroup(e,r);if(i)if(t==="hours"){let n=+i.get("hours")?.value||1;n=(n-1+12)%12,n===0&&(n=12),i.get("hours")?.setValue(this.pad(n))}else{let n=+i.get("minutes")?.value||0;n=(n-1+60)%60,i.get("minutes")?.setValue(this.pad(n))}}getShiftGroup(t,e){return this.staffListFormArray.at(t).get("shiftDetails").at(e)}pad(t){return t!=null?t.toString().padStart(2,"0"):"00"}increase(t,e,r){let i=this.getQuantityControl(t,e,r);i.setValue(Math.min((i.value||0)+1,10)),this.updateGenderInShift(e,r)}decrease(t,e,r){let i=this.getQuantityControl(t,e,r);i.setValue(Math.max((i.value||1)-1,0)),this.updateGenderInShift(e,r)}updateGenderInShift(t,e){let r=this.getShiftGroup(t,e);r&&this.updateGenderQty(r)}getQuantityControl(t,e,r){return this.staffListFormArray.at(e).get("shiftDetails").at(r).get(t==="maleQuantity"?"maleQuantity":"femaleQuantity")}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{let e=t.coords.latitude,r=t.coords.longitude;this.getAddressFromCoords(e,r)},t=>{console.error("Geolocation failed:",t)}):console.error("Geolocation not supported by this browser.")}getAddressFromCoords(t,e){this.staffBookingForm.patchValue({latitude:t,longitude:e});let r=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${t}&lon=${e}`;this.http.get(r).subscribe(i=>{let n=i.display_name;n&&this.staffBookingForm.patchValue({userAddress:n})},i=>{console.error("Error fetching address:",i)})}createStaffDetailFormGroup(){return this.fb.group({typeOfStaff:["",b.required],typeOfSubStaff:["",b.required]})}fetchSubCategories(t,e){let r=`${j}${F.CATEGORIES}/${t}${F.SUB_CATEGORIES}`;this.http.get(r).subscribe({next:i=>{this.staffSubCategories[e]=i},error:i=>{console.error("Failed to fetch subcategories",i),this.staffSubCategories[e]=[]}})}createShiftDetailFormGroup(){let e=new Date().getHours(),r="00",i=e>=12?"PM":"AM";e===0?e=12:e>12&&(e-=12);let n=this.fb.group({preferredTimeSlot:["",b.required],timeSlot:[""],tenure:[""],dutyStartDate:[new Date().toISOString().substring(0,10)],dutyEndDate:[""],maleQuantity:["0",[b.min(0),b.max(10)]],femaleQuantity:["0",[b.min(0),b.max(10)]],hours:[e,[b.required,b.min(1),b.max(12)]],minutes:[r,[b.required,b.min(0),b.max(59)]],ampm:[i,b.required]},{validators:[this.shiftDurationValidator]});return n.get("hours")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("minutes")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("ampm")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("maleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(n)),n.get("femaleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(n)),n.get("tenure")?.valueChanges.subscribe(a=>{let c=n.get("dutyEndDate");a==="1"?(c?.clearValidators(),c?.setValue("")):c?.setValidators([b.required]),c?.updateValueAndValidity()}),n.get("dutyStartDate")?.valueChanges.subscribe(a=>{if(!a){let m=new Date().toISOString().substring(0,10);n.get("dutyStartDate")?.setValue(m,{emitEvent:!1});return}let c=n.get("dutyEndDate");if(c){let m=c.value;m&&new Date(m)<new Date(a)&&c.setValue(a,{emitEvent:!1})}}),n}updateTimeSlot(t){let e=t.get("hours")?.value??0,r=t.get("minutes")?.value??0,i=t.get("ampm")?.value??"AM",n=m=>m.toString().padStart(2,"0"),a=`${n(+e)}:${n(+r)} ${i}`,c=t.get("timeSlot");c?.setValue(a,{emitEvent:!1}),c?.markAsTouched(),c?.markAsDirty()}updateGenderQty(t){let e=Number(t.get("maleQuantity")?.value||0),r=Number(t.get("femaleQuantity")?.value||0);t.get("maleQuantity")?.setValue(e),t.get("gender")?.setValue(r)}createStaffFormGroup(){return this.fb.group({staffDetails:this.fb.array([this.createStaffDetailFormGroup()]),shiftDetails:this.fb.array([this.createShiftDetailFormGroup()])})}addShift(t){this.staffListFormArray.at(t).get("shiftDetails").push(this.createShiftDetailFormGroup())}removeShiftDetail(t,e){this.staffListFormArray.at(t).get("shiftDetails").removeAt(e)}addNewStaff(){this.staffListFormArray.push(this.createStaffFormGroup());let t=this.staffListFormArray.length-1;this.subscribeToCategoryChange(t)}get staffListFormArray(){return this.staffBookingForm.get("staffForms")}getNestedShiftDetailsControls(t){return this.staffListFormArray.at(t).get("shiftDetails").controls}getNestedStaffDetailsControls(t){return this.staffListFormArray.at(t).get("staffDetails").controls}removeStaff(t){this.staffListFormArray.removeAt(t)}onSubmit(){if(this.isSubmitting)return;this.isSubmitting=!0;let t=this.hasPastTimeError(),e=this.hasZeroQuantityError();if(!this.staffBookingForm.valid||t||e){this.markAllAsTouched(this.staffBookingForm),this.isSubmitting=!1;return}let r=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),n=JSON.parse(localStorage.getItem("userProfile")||"{}").aadhaarStatus===!0;if(!r){console.log("User not logged in. Redirecting to login page."),this.showAuthPopup=!0,this.isSubmitting=!1;return}this.spinnerService.show();let a=j+F.BOOK_STAFF,c=R(L({},this.staffBookingForm.value),{staffForms:this.staffListFormArray.controls.map(M=>{let h=M.get("staffDetails").at(0),{typeOfStaff:k,typeOfSubStaff:E}=h.value,w=M.get("shiftDetails").controls.map(S=>{let{preferredTimeSlot:T,timeSlot:B,tenure:Be,maleQuantity:Re,femaleQuantity:Ge,dutyStartDate:Ve,dutyEndDate:Ze}=S.value;return{preferredTimeSlot:T,timeSlot:B,tenure:Be,maleQuantity:Re,femaleQuantity:Ge,dutyStartDate:Ve,dutyEndDate:Ze}});return{typeOfStaff:k,typeOfSubStaff:E,shifts:w}})}),m=new ge({"Content-Type":"application/json"});m=m.set("Authorization",`Bearer ${r}`),this.http.post(a,c,{headers:m}).subscribe({next:M=>{if(this.spinnerService.hide(),this.isSubmitting=!1,M?.status===!0){let h=M?.staff?.[0]?.staffDetails||[];this.router.navigate(["/view-staff"],{state:{staffDetails:h,bookingIds:M.bookingIds}})}else alert(M?.message||"Something went wrong.")},error:M=>{this.spinnerService.hide(),this.isSubmitting=!1,console.error("Staff search API call failed:",M),alert("An error occurred while processing your request.")}})}onAuthSuccess(){this.showAuthPopup=!1,this.onSubmit()}onAuthClose(){this.showAuthPopup=!1}onAadharVerified(){this.showAadharPopup=!1;let t=JSON.parse(localStorage.getItem("userProfile")||"{}");t.aadhaarStatus=!1,localStorage.setItem("userProfile",JSON.stringify(t)),this.onSubmit()}hasPastTimeError(){let t=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(i=>{let n=i.get("dutyStartDate")?.value,a=+i.get("hours")?.value,c=+i.get("minutes")?.value,m=i.get("ampm")?.value;if(!n||a==null||c==null||!m)return;let M=new Date(n),h=new Date,k=S=>S.toString().padStart(2,"0"),E=`${k(a)}:${k(c)} ${m}`;if(i.get("timeSlot")?.setValue(E,{emitEvent:!1}),M.getFullYear()===h.getFullYear()&&M.getMonth()===h.getMonth()&&M.getDate()===h.getDate()){let S=a;m==="PM"&&S!==12&&(S+=12),m==="AM"&&S===12&&(S=0);let T=new Date;if(T.setHours(S,c,0,0),T<h)i.get("timeSlot")?.setErrors({pastTime:!0}),t=!0;else{let B=i.get("timeSlot");B?.hasError("pastTime")&&B.setErrors(null)}}})}),t}hasZeroQuantityError(){let t=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(i=>{let n=+i.get("maleQuantity")?.value||0,a=+i.get("femaleQuantity")?.value||0;if(n===0&&a===0)i.setErrors(R(L({},i.errors||{}),{zeroQuantity:!0})),t=!0;else if(i.errors?.zeroQuantity){let c=L({},i.errors);delete c.zeroQuantity,i.setErrors(Object.keys(c).length?c:null)}})}),t}markAllAsTouched(t){Object.values(t.controls).forEach(e=>{e.markAsTouched(),(e instanceof fe||e instanceof Oe)&&this.markAllAsTouched(e)})}shiftDurationValidator(t){let e=parseInt(t.get("shiftHour")?.value,10),r=parseInt(t.get("shiftMinute")?.value,10);if(isNaN(e)||isNaN(r))return null;let i=e*60+r,n=(i+8*60)%(24*60);return i>=0&&n>=0?null:{invalidShiftDuration:!0}}onManualChange(t,e,r,i){let n=i.target,a=Number(n.value);isNaN(a)&&(a=0),a<0&&(a=0),a>10&&(a=10),this.getNestedShiftDetailsControls(e)[r].get(t)?.setValue(a)}onManualTimeChange(t,e,r,i){let n=i.target,a=Number(n.value);isNaN(a)&&(a=0),t==="hours"&&(a<0&&(a=0),a>12&&(a=12)),t==="minutes"&&(a<0&&(a=0),a>59&&(a=59)),this.getNestedShiftDetailsControls(e)[r].get(t)?.setValue(a)}static \u0275fac=function(e){return new(e||o)(X(W))};static \u0275cmp=P({type:o,selectors:[["app-book-staff"]],decls:32,vars:7,consts:[[1,"container-fluid",2,"margin-top","-65px"],[1,"row"],[1,"col-md-4","h-100","map-styles"],[3,"locationSelected"],[1,"col-md-8","search-staff-form"],[1,"form-title"],[1,"form-scroll-container"],[1,"form-content"],[3,"ngSubmit","formGroup"],[1,"form"],[1,"row","my-3"],[1,"col-md-12"],[1,"form-group"],[1,"form-label"],[1,"bi","bi-geo-alt","address"],["type","text","formControlName","userAddress",1,"form-control","ps-4"],[1,"invalid-feedback"],["type","text","placeholder","Enter address","formControlName","address",1,"form-control","ps-4"],["formArrayName","staffForms",1,"staff-list"],["class","pe-2",3,"formGroupName",4,"ngFor","ngForOf"],[3,"showAuthModal","authMode"],[1,"pe-2",3,"formGroupName"],[1,"indexed-divider-container"],[1,"col-md-12","d-flex","justify-content-end"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px"],["formArrayName","staffDetails"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"line"],[1,"index-number"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px",3,"click"],[1,"bi","bi-trash","fs-5"],[3,"formGroupName"],[1,"col-md-12","mb-2"],[1,"form-label",3,"for"],[1,"bi","bi-person","address"],["formControlName","typeOfStaff",1,"form-select","ps-4",3,"id"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"col-md-12","my-3"],[1,"bi","bi-people","address"],["formControlName","typeOfSubStaff",1,"form-select","ps-4",3,"id","disabled"],["formArrayName","shiftDetails"],["class","shift-detail",3,"formGroupName",4,"ngFor","ngForOf"],[1,"shift-detail",3,"formGroupName"],[1,"row","d-flex"],[1,"sub-row"],[1,"col-12","col-sm-6","col-md-4","col-lg-4"],[1,"d-flex","align-items-center"],[1,"d-flex","align-items-center","counter-box"],["type","button",1,"btn-counter","btn-minus",3,"click"],[1,"bi","bi-dash"],["type","number","formControlName","hours","min","0","max","12",1,"value-font","counter-input",3,"input","value"],["type","button",1,"btn-counter","btn-plus",3,"click"],[1,"bi","bi-plus"],[1,"d-flex","align-items-center","counter-box","mx-2"],["type","number","formControlName","minutes","min","0","max","59",1,"value-font","counter-input","hrsMin",3,"input","value"],["formControlName","ampm",1,"d-flex","align-items-center","counter-box","mx-2"],["value","AM"],["value","PM"],[1,"col-12","col-sm-6","col-md-4","col-lg-2"],["formControlName","preferredTimeSlot",1,"d-flex","align-items-center","counter-box","mx-2"],[1,"gender-quantity-row"],[1,"gender-box"],[1,"form-label","d-block"],[1,"bi","bi-person","text-primary","me-2"],[1,"counter-label"],[1,"text-danger"],[1,"quantity-box"],["type","number","min","0","max","10",1,"value-font","counter-input",3,"input","formControlName"],[1,"bi","bi-calendar4","text-primary"],["formControlName","tenure",1,"value-font","border-0","counter-select"],[1,"col-md-6"],["type","date","formControlName","dutyStartDate",1,"form-control",3,"min"],["class","col-md-6",4,"ngIf"],[1,"d-flex","align-items-start","justify-content-end","gap-2","mt-3"],["title","Add Time Slot",1,"bi","bi-plus-lg","add"],["title","Remove Time Slot",1,"bi","bi-trash","text-danger","remove"],["type","date","formControlName","dutyEndDate",1,"form-control",3,"min"],["class","invalid-feedback",4,"ngIf"],["title","Add Time Slot",1,"bi","bi-plus-lg","add",3,"click"],["title","Remove Time Slot",1,"bi","bi-trash","text-danger","remove",3,"click"],[1,"d-flex","justify-content-center","addNewBtn","my-2"],["type","button",1,"btn",3,"click"],[1,"submission-fixed","d-flex","justify-content-end"],[3,"buttonType","disableButton"],[3,"loginSuccess","close","showAuthModal","authMode"]],template:function(e,r){if(e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-map",3),v("locationSelected",function(n){return r.getAddressFromCoords(n.lat,n.lng)}),s()(),l(4,"div",4)(5,"h2",5),u(6,"Please fill the form"),s(),l(7,"div",6)(8,"div",7)(9,"form",8),v("ngSubmit",function(){return r.onSubmit()}),l(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),u(15,"Select your area"),s(),_(16,"i",14)(17,"input",15),C(18,He,2,0,"div",16),s()()(),l(19,"div",10)(20,"div",11)(21,"div",12)(22,"label",13),u(23,"Address"),s(),_(24,"i",14)(25,"input",17),s()()(),l(26,"div",18),x(27,gt,7,5,"div",19),s()(),C(28,ut,7,2,"ng-container"),s()()()()()(),l(29,"div"),_(30,"app-footer"),s(),C(31,pt,1,2,"app-authorization",20)),e&2){let i,n,a;g(9),p("formGroup",r.staffBookingForm),g(8),D("is-invalid",((i=r.staffBookingForm.get("userAddress"))==null?null:i.invalid)&&((i=r.staffBookingForm.get("userAddress"))==null?null:i.touched)),g(),z((n=r.staffBookingForm.get("userAddress"))!=null&&n.invalid&&((n=r.staffBookingForm.get("userAddress"))!=null&&n.touched)?18:-1),g(9),p("ngForOf",r.staffListFormArray.controls),g(),z(!((a=r.staffListFormArray.controls[0].get("staffDetails"))==null||(a=a.get("0"))==null||(a=a.get("typeOfStaff"))==null)&&a.value?28:-1),g(3),z(r.showAuthPopup?31:-1)}},dependencies:[ce,se,le,Ee,ye,ke,we,me,ve,xe,he,_e,Ie,Se,Me,ze,be,Ce,H,Le,Pe,Ae,de],styles:['@charset "UTF-8";.staff-list[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:scroll}.staff-list[_ngcontent-%COMP%]:hover{overflow-y:auto}.staff-list[_ngcontent-%COMP%]:focus-within{overflow-y:auto}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:3px;height:8px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#09b8c2;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#fff}.indexed-divider-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin:20px 0;color:#6c757d;font-weight:700;font-size:.9rem}.line[_ngcontent-%COMP%]{flex-grow:1;height:1px;background-color:#dee2e6}.index-number[_ngcontent-%COMP%]{color:#09b8c2;padding:5px 12px;background-color:#e0fcff;border-radius:50%;min-width:25px;text-align:center;box-shadow:0 1px 3px #0000000d}.form-group[_ngcontent-%COMP%]{position:relative}.address[_ngcontent-%COMP%]{position:absolute;left:5px;top:36px;color:#09b8c2}.female[_ngcontent-%COMP%]{top:8px!important}.hrsMin[_ngcontent-%COMP%]{width:40px!important}.amPm[_ngcontent-%COMP%]{width:70px!important}.counter-box[_ngcontent-%COMP%]{background:#f9fbfd;border:2px solid #dff4f6;border-radius:12px;padding:0 12px;display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px;width:120px;height:40px}.counter-box[_ngcontent-%COMP%]   .btn-counter[_ngcontent-%COMP%]{background:transparent;border:none;font-size:24px;font-weight:700;color:#09b8c2;cursor:pointer;width:30px;height:30px;line-height:1;display:flex;align-items:center;justify-content:center}.counter-box[_ngcontent-%COMP%]   .btn-counter[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.counter-input[_ngcontent-%COMP%]{width:55px;text-align:center;border:none;background:transparent;font-size:22px;font-weight:600;color:#212529;padding:0;margin:0}.counter-input[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.counter-input.hrsMin[_ngcontent-%COMP%]{width:50px}.counter-select[_ngcontent-%COMP%]{background:transparent;font-size:16px;font-weight:500;color:#212529;padding-left:8px;box-shadow:none!important}.counter-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.counter-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{color:#212529}.search-staff-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .search-staff-form[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{height:40px!important;min-height:40px!important;line-height:40px;padding:0 10px;font-size:.9rem;border-radius:6px;border-color:#dff4f6;background:#f9fbfd}.value-font[_ngcontent-%COMP%]{color:#1e293b;font-size:14px;font-weight:400}.search-staff-form[_ngcontent-%COMP%]   .counter-input[_ngcontent-%COMP%]{height:40px!important;min-height:40px!important;text-align:center;padding:0}.search-staff-form[_ngcontent-%COMP%]   .btn-counter[_ngcontent-%COMP%]{height:40px!important;width:40px;display:flex;align-items:center;justify-content:center}.search-staff-form[_ngcontent-%COMP%]   .counter-select[_ngcontent-%COMP%]{height:40px!important;min-height:40px!important;padding:0 8px}.form-scroll-container[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto;overflow-x:hidden;padding-right:10px}.form-scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.form-scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#0003;border-radius:3px}.form-scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#0006}.row[_ngcontent-%COMP%], .form-content[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%], .form-content[_ngcontent-%COMP%]   .sub-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:flex-start}.sub-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px}@media (max-width: 768px){.sub-row[_ngcontent-%COMP%]   .col-12.col-sm-6.col-md-4.col-lg-4[_ngcontent-%COMP%], .sub-row[_ngcontent-%COMP%]   .col-12.col-sm-6.col-md-4.col-lg-2[_ngcontent-%COMP%]{flex:1 1 100%;max-width:100%}.sub-row[_ngcontent-%COMP%]   .counter-box[_ngcontent-%COMP%]{flex:1 1 auto;min-width:60px;width:auto;height:36px;margin-bottom:8px}.sub-row[_ngcontent-%COMP%]   .counter-input[_ngcontent-%COMP%]{font-size:14px;width:40px!important}.sub-row[_ngcontent-%COMP%]   select.counter-box[_ngcontent-%COMP%]{min-width:70px;height:36px;font-size:14px}}@media (max-width: 400px){.sub-row[_ngcontent-%COMP%]{flex-direction:column}.sub-row[_ngcontent-%COMP%]   .counter-box[_ngcontent-%COMP%]{width:100%}}.map-styles[_ngcontent-%COMP%]{height:auto;overflow:hidden;border-radius:12px}.map-styles[_ngcontent-%COMP%]   app-map[_ngcontent-%COMP%]{display:block;width:100%;height:100%}.gender-quantity-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;gap:12px}.gender-quantity-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1 1 0;min-width:0}@media (max-width: 500px){.gender-quantity-row[_ngcontent-%COMP%]{gap:24px}.gender-quantity-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;min-width:0}.counter-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:60px;font-size:14px}.counter-label[_ngcontent-%COMP%]{font-size:14px}}@media (max-width: 375px){.container-fluid[_ngcontent-%COMP%]{margin-top:-30px!important;padding:0 8px}.search-staff-form[_ngcontent-%COMP%]{padding:12px}.form-title[_ngcontent-%COMP%]{font-size:1rem;text-align:center}.form-scroll-container[_ngcontent-%COMP%]{max-height:400px;padding-right:6px}.counter-box[_ngcontent-%COMP%]{width:100%;height:36px;font-size:.8rem}.counter-input[_ngcontent-%COMP%]{font-size:16px;width:40px!important}.search-staff-form[_ngcontent-%COMP%]   .btn-counter[_ngcontent-%COMP%]{width:32px!important;height:32px!important;font-size:18px}.map-styles[_ngcontent-%COMP%]{height:220px;margin-bottom:12px}}@media (min-width: 376px) and (max-width: 576px){.container-fluid[_ngcontent-%COMP%]{margin-top:-40px!important;padding:0 10px}.form-title[_ngcontent-%COMP%]{font-size:1.1rem;text-align:center}.counter-box[_ngcontent-%COMP%]{width:100%;margin-bottom:8px}.map-styles[_ngcontent-%COMP%]{height:250px;margin-bottom:15px}}@media (min-width: 577px) and (max-width: 768px){.form-title[_ngcontent-%COMP%]{font-size:1.1rem;text-align:center}.counter-box[_ngcontent-%COMP%]{width:100%}}@media (min-width: 769px) and (max-width: 1024px){.row[_ngcontent-%COMP%]{flex-direction:column}.map-styles[_ngcontent-%COMP%]{width:100%!important;min-height:250px;margin-bottom:16px}.search-staff-form[_ngcontent-%COMP%]{width:100%!important;padding:16px}.search-staff-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .search-staff-form[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{width:100%!important}.counter-box[_ngcontent-%COMP%]{width:auto;min-width:80px;height:36px;font-size:.9rem}.gender-quantity-row[_ngcontent-%COMP%]{flex-wrap:wrap;gap:16px}.gender-quantity-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1 1 45%}.form-scroll-container[_ngcontent-%COMP%]{max-height:500px;padding-right:8px}.form-title[_ngcontent-%COMP%]{font-size:1.2rem;text-align:center}}@media (min-width: 1025px){.map-styles[_ngcontent-%COMP%]{height:auto;min-height:500px}.form-scroll-container[_ngcontent-%COMP%]{max-height:600px}}']})};export{Te as BookStaff};
