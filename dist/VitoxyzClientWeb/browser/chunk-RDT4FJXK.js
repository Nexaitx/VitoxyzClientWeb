import{a as ne}from"./chunk-QJAI4TEK.js";import{b as Q,c as y,e as Z,f as J,i as W,l as X,o as ee,x as te,z as ie}from"./chunk-NW2L5A5V.js";import{a as x,b as w}from"./chunk-7RHT64GJ.js";import{c as Y}from"./chunk-F7NH5DTK.js";import{g as j,h as G,i as K,m as H,n as q,t as h,u as U}from"./chunk-MOXSZ3XB.js";import{$ as T,Gb as m,Hb as r,Ib as n,Jb as f,Nb as k,Ob as I,Qb as P,Tb as b,Vb as S,Xa as V,Za as s,cb as _,da as R,dc as D,e as O,hc as l,ic as M,jb as B,jc as C,ka as u,kc as F,la as g,ob as c,p as N,tc as z,uc as A,vc as L,wc as $}from"./chunk-QPX54FPS.js";var E=class o{constructor(t){this.http=t}getBookingResponse(){let t=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),e=new h({Authorization:`Bearer ${t}`});return this.http.get(`${x}${w.BOOKING_RESPONSE}`,{headers:e})}removeStaffFromBooking(t){let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),i=new h({Authorization:`Bearer ${e}`});return this.http.delete(`${x}${w.REMOVE_STAFF.replace("{bookingId}",t)}`,{headers:i})}addIndividualStaff(t){let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(!e)return N(()=>new Error("No auth token found"));let i=new h({"Content-Type":"application/json",Authorization:`Bearer ${e}`});return this.http.post(`${x}${w.BOOK_SINGLE_STAFF}`,t,{headers:i})}static \u0275fac=function(e){return new(e||o)(R(U))};static \u0275prov=T({token:o,factory:o.\u0275fac,providedIn:"root"})};var le=(o,t,e)=>({"bi-star-fill text-warning":o,"bi-star-half text-warning":t,"bi-star text-warning":e});function se(o,t){if(o&1&&(k(0),f(1,"i",49),I()),o&2){let e=t.$implicit;s(),m("ngClass",z(1,le,e==="full",e==="half",e==="empty"))}}function de(o,t){if(o&1){let e=P();r(0,"div",31)(1,"div",32)(2,"div",33)(3,"div",34)(4,"div",35),f(5,"img",36),n()(),r(6,"div",37)(7,"div",38)(8,"h6",39)(9,"span"),l(10),n()(),r(11,"p",40),l(12),n(),r(13,"p",41),c(14,se,2,5,"ng-container",42),r(15,"span",43),l(16),n()(),r(17,"p",40),l(18),n(),r(19,"div",44)(20,"button",45),b("click",function(){let a=u(e).$implicit,d=S(3);return g(d.selectedStaff=a)}),f(21,"i",46),n(),r(22,"button",47),b("click",function(){let a=u(e).$implicit,d=S(3);return g(d.selectedStaff=a)}),f(23,"i",48),n()()()()()()()}if(o&2){let e=t.$implicit,i=S(3);s(5),m("src",e.imageUrl||((e.gender==null?null:e.gender.toLowerCase())==="female","/assets/profile.jpeg"),V),s(5),M(e.name),s(2),F(" ",e.experience," Years Experience | ",e.duties," Duties "),s(2),m("ngForOf",i.getStars(e.rating)),s(2),C("",e.rating,"/5"),s(2),C("\u20B9",e.price),s(2),m("disabled",e.isBooked)}}function me(o,t){if(o&1&&(r(0,"div",28)(1,"div",29),l(2),A(3,"titlecase"),n(),c(4,de,24,8,"div",30),n()),o&2){let e=t.$implicit;s(2),F(" ",L(3,3,e.category)," (",(e.availableStaff==null?null:e.availableStaff.length)||0,") "),s(2),m("ngForOf",e.availableStaff)}}function fe(o,t){if(o&1&&(k(0),c(1,me,5,5,"div",27),I()),o&2){let e=S();s(),m("ngForOf",e.staffDetails)}}function ce(o,t){o&1&&(r(0,"div",50)(1,"h2"),l(2,"No staff found."),n()())}function pe(o,t){o&1&&(r(0,"div",51),l(1," Billing Address is required (min 5 chars). "),n())}function ue(o,t){o&1&&(r(0,"div",51),l(1," Valid Name is required (alphabets only). "),n())}function ge(o,t){o&1&&(r(0,"div",51),l(1," Enter valid GST Number (15 characters). "),n())}var ae=class o{constructor(t,e,i){this.fb=t;this.router=e;this.bookingResponseService=i}staffDetails=[];selectedStaff;billingForm;razorpayKeyId="rzp_test_RARA6BGk8D2Y2o";isPaymentLoading=!1;ngOnInit(){this.fetchBookingResponses(),this.billingForm=this.fb.group({billingAddress:["",[y.required,y.minLength(5)]],billingName:["",[y.required,y.pattern(/^[a-zA-Z ]+$/)]],gstNumber:["",[y.required]]})}fetchBookingResponses(){this.bookingResponseService.getBookingResponse().subscribe({next:t=>{let e=t?.staff??[],i=[];e.forEach(a=>{(a.staffDetails??[]).forEach(d=>{i.push({category:d.typeOfStaff,availableStaff:d.availableStaff??[]})})}),this.staffDetails=i,console.log("API staff:",t.staff),console.log("Formatted staff:",i)},error:t=>{console.error("Error fetching booking responses",t)}})}getStars(t){let e=[];for(let i=0;i<5;i++){let a=i+1;t>=a?e.push("full"):t>a-1&&t<a?e.push("half"):e.push("empty")}return e}removeStaff(t){if(!t.id){console.error("No ID found for staff:",t);return}this.bookingResponseService.removeStaffFromBooking(t.id).subscribe({next:()=>{this.staffDetails.forEach(e=>{e.availableStaff=e.availableStaff.filter(i=>i.id!==t.id)})},error:e=>{console.error("Error removing staff:",e)}})}addSpecificStaff(t){if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){alert("Please login or signup first to access book staff page"),this.router.navigate(["/login"]);return}let i={staffForms:[{typeOfStaff:t.typeOfStaff||t.category,typeOfSubStaff:t.typeOfSubStaff,shifts:[{timeSlot:t.timeSlot,shiftType:t.shiftType||"Day",maleQuantity:t.gender?.toLowerCase()==="male"?1:0,femaleQuantity:t.gender?.toLowerCase()==="female"?1:0,tenure:t.tenure,dutyStartDate:String(t.dutyStartDate||new Date().toISOString().split("T")[0])}]}]};this.bookingResponseService.addIndividualStaff(i).subscribe({next:()=>{alert(`${t.name} has been added to your booking!`),t.isBooked=!0},error:a=>{console.error("Error adding staff:",a),alert("Failed to add staff. Please try again.")}})}onProceedToPayment(t,e,i){return O(this,null,function*(){try{if(!this.razorpayKeyId){alert("Razorpay Key ID is missing. Please add it in the component.");return}let a=this.getPayableAmount();if(!(a>0)){alert("Invalid amount.");return}this.isPaymentLoading=!0,yield this.loadRazorpaySdk();let d={key:this.razorpayKeyId,amount:Math.round(a*100),currency:"INR",name:"Your Company Name",description:"Booking Payment",prefill:{name:t||"",email:"",contact:""},notes:{billing_address:e||"",gst_number:i||""},theme:{color:"#0d6efd"},modal:{ondismiss:()=>console.log("Razorpay Checkout closed.")},handler:v=>{this.onPaymentSuccess(v,a)}},p=new Razorpay(d);p.on("payment.failed",v=>this.onPaymentFailed(v)),p.open()}catch(a){console.error("Payment init error:",a),alert("Unable to start payment. Please try again.")}finally{this.isPaymentLoading=!1}})}onPaymentSuccess(t,e){console.log("Payment success:",t)}onPaymentFailed(t){console.error("Payment failed:",t);let e=t?.error?.description||"Payment failed. Please try again.";alert(e)}loadRazorpaySdk(){return new Promise((t,e)=>{if(typeof Razorpay<"u"){t();return}let i=document.getElementById("razorpay-checkout-js");if(i){i.addEventListener("load",()=>t()),i.addEventListener("error",()=>e(new Error("Failed to load Razorpay SDK.")));return}let a=document.createElement("script");a.id="razorpay-checkout-js",a.src="https://checkout.razorpay.com/v1/checkout.js",a.async=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Razorpay SDK.")),document.body.appendChild(a)})}getPayableAmount(){return 1212}static \u0275fac=function(e){return new(e||o)(_(te),_(Y),_(E))};static \u0275cmp=B({type:o,selectors:[["app-view-staff"]],decls:69,vars:7,consts:[["noStaff",""],[1,"container-fluid",2,"margin-top","-70px"],[4,"ngIf","ngIfElse"],[1,"bg-white","px-0"],[1,"p-3","d-flex","justify-content-between"],[1,"text-muted"],["data-bs-toggle","modal","data-bs-target","#exampleModal",1,"submission","btn","btn-primary","text-light","rounded-pill","btn-sm"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"formGroup"],[1,"form-group"],["formControlName","billingAddress","type","text","placeholder","Enter billing address",1,"form-control"],["class","text-danger small",4,"ngIf"],[1,"form-group","my-3"],["formControlName","billingName","type","text","placeholder","Enter your name",1,"form-control"],["formControlName","gstNumber","type","text","placeholder","Enter GST number",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-primary","submission","text-light","btn-sm","w-100","rounded-pill",3,"click","disabled"],["id","swapStaff","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["type","button",1,"btn","submission","text-light","btn-sm","w-100","rounded-pill"],["type","submit",1,"btn","btn-primary","submission","text-light","btn-sm","rounded-pill",3,"click"],["id","deleteStaff","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12","mb-2"],["class","col-md-3 mb-4",4,"ngFor","ngForOf"],[1,"col-md-3","mb-4"],[1,"card","h-100"],[1,"row","g-0"],[1,"col-4"],[1,"staff-img"],["alt","Staff Image",1,"img-fluid","rounded",3,"src"],[1,"col-7"],[1,"card-body","p-2"],[1,"card-title","mb-1"],[1,"mb-1","text-muted"],[1,"mb-1"],[4,"ngFor","ngForOf"],[1,"ms-1","text-warning"],[1,"d-flex","justify-content-start","gap-2","mt-2"],["data-bs-toggle","modal","data-bs-target","#swapStaff",1,"btn","btn-outline-primary","actionSwap",3,"click","disabled"],[1,"bi","bi-arrow-left-right"],["data-bs-toggle","modal","data-bs-target","#deleteStaff",1,"btn","btn-sm","btn-outline-danger","actionDelete",3,"click"],[1,"bi","bi-x-lg"],[1,"bi",3,"ngClass"],[1,"text-center","mt-4"],[1,"text-danger","small"]],template:function(e,i){if(e&1){let a=P();r(0,"div",1),c(1,fe,2,1,"ng-container",2)(2,ce,3,0,"ng-template",null,0,$),n(),r(4,"footer",3)(5,"div",4)(6,"p",5),l(7,"Total Staff: 01"),n(),r(8,"button",6),l(9,"Proceed to Booking (1212)"),n()()(),r(10,"div",7)(11,"div",8)(12,"div",9)(13,"div",10)(14,"h1",11),l(15,"Please Enter Billing Information"),n(),f(16,"button",12),n(),r(17,"div",13)(18,"form",14)(19,"div",15)(20,"label"),l(21,"Billing Address"),n(),f(22,"input",16),c(23,pe,2,0,"div",17),n(),r(24,"div",18)(25,"label"),l(26,"Your Name"),n(),f(27,"input",19),c(28,ue,2,0,"div",17),n(),r(29,"div",15)(30,"label"),l(31,"GST Number"),n(),f(32,"input",20),c(33,ge,2,0,"div",17),n()()(),r(34,"div",21)(35,"button",22),b("click",function(){return u(a),g(i.onProceedToPayment(i.billingForm.value.billingName,i.billingForm.value.billingAddress,i.billingForm.value.gstNumber))}),l(36," Proceed to Payment (1212) "),n()()()()(),r(37,"div",23)(38,"div",8)(39,"div",9)(40,"div",10)(41,"h1",11),l(42,"Please Enter Billing Information"),n(),f(43,"button",12),n(),r(44,"div",13)(45,"h5"),l(46,"Are you Sure, you want to swap the Staff?"),n()(),r(47,"div",21)(48,"button",24),l(49,"No"),n(),r(50,"button",25),b("click",function(){return u(a),g(i.addSpecificStaff(i.selectedStaff))}),l(51,"Yes"),n()()()()(),r(52,"div",26)(53,"div",8)(54,"div",9)(55,"div",10)(56,"h1",11),l(57,"Confirm"),n(),f(58,"button",12),n(),r(59,"div",13)(60,"h5"),l(61,"Are you sure you want to remove this staff ?"),n()(),r(62,"div",21)(63,"button",24),l(64,"Cancel"),n(),r(65,"button",25),b("click",function(){return u(a),g(i.removeStaff(i.selectedStaff))}),l(66,"Remove"),n()()()()(),r(67,"div"),f(68,"app-footer"),n()}if(e&2){let a,d,p,v=D(3);s(),m("ngIf",i.staffDetails.length>0)("ngIfElse",v),s(17),m("formGroup",i.billingForm),s(5),m("ngIf",((a=i.billingForm.get("billingAddress"))==null?null:a.touched)&&((a=i.billingForm.get("billingAddress"))==null?null:a.invalid)),s(5),m("ngIf",((d=i.billingForm.get("billingName"))==null?null:d.touched)&&((d=i.billingForm.get("billingName"))==null?null:d.invalid)),s(5),m("ngIf",((p=i.billingForm.get("gstNumber"))==null?null:p.touched)&&((p=i.billingForm.get("gstNumber"))==null?null:p.invalid)),s(2),m("disabled",i.billingForm.invalid)}},dependencies:[q,j,G,K,ie,W,Q,Z,J,X,ee,ne,H],styles:[".text-center[_ngcontent-%COMP%]{position:fixed;top:50%;left:45%}.bi-star-half.text-warning[_ngcontent-%COMP%], .bi-star-full.text-warning[_ngcontent-%COMP%]{color:#000!important}.actionSwap[_ngcontent-%COMP%]{width:36px!important;height:37px!important;border-radius:100%!important;padding:0!important;background:#e4f4f3!important;border:0!important}.actionSwap[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:18px!important}.actionDelete[_ngcontent-%COMP%]{border:0!important;background:#ffe6e6!important;padding:0!important;width:36px!important;height:37px!important;border-radius:100%!important}.actionDelete[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:18px!important}.card[_ngcontent-%COMP%]{border:1px solid #ccebec!important;background:#f4f5f7!important}.card[_ngcontent-%COMP%]   .staff-img[_ngcontent-%COMP%]{height:auto;background:#fff;border-radius:20px;position:relative;margin:30px 10px;padding:10px 0}footer[_ngcontent-%COMP%]{position:sticky;bottom:0;width:100%}.form-control[_ngcontent-%COMP%]{border-radius:25px!important}"]})};export{ae as ViewStaff};
