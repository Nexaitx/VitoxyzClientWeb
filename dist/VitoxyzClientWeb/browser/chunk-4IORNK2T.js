import{a as h,b as x}from"./chunk-2XPCGB4B.js";import{b as Y}from"./chunk-AM2LVYM3.js";import{g as $,h as j,i as K,l as H,m as G,s as _,t as U}from"./chunk-6DS5PDWY.js";import{$ as F,Eb as f,Fb as o,Gb as n,Hb as m,Lb as k,Mb as I,Ob as P,Rb as u,Tb as y,Wa as D,Ya as s,bb as E,bc as S,da as N,e as T,fc as l,gc as V,hc as C,ib as M,ic as O,ka as c,la as p,nb as b,p as R,rc as B,sc as z,tc as A,uc as L}from"./chunk-HGK6BT6U.js";var w=class r{constructor(t){this.http=t}getBookingResponse(){let t=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),e=new _({Authorization:`Bearer ${t}`});return this.http.get(`${h}${x.BOOKING_RESPONSE}`,{headers:e})}removeStaffFromBooking(t){let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),i=new _({Authorization:`Bearer ${e}`});return this.http.delete(`${h}${x.REMOVE_STAFF.replace("{bookingId}",t)}`,{headers:i})}addIndividualStaff(t){let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(!e)return R(()=>new Error("No auth token found"));let i=new _({"Content-Type":"application/json",Authorization:`Bearer ${e}`});return this.http.post(`${h}${x.BOOK_SINGLE_STAFF}`,t,{headers:i})}static \u0275fac=function(e){return new(e||r)(N(U))};static \u0275prov=F({token:r,factory:r.\u0275fac,providedIn:"root"})};var X=(r,t,e)=>({"bi-star-fill text-warning":r,"bi-star-half text-warning":t,"bi-star text-warning":e});function Z(r,t){if(r&1&&(k(0),m(1,"i",50),I()),r&2){let e=t.$implicit;s(),f("ngClass",B(1,X,e==="full",e==="half",e==="empty"))}}function ee(r,t){if(r&1){let e=P();o(0,"div",32)(1,"div",33)(2,"div",34)(3,"div",35)(4,"div",36),m(5,"img",37),n()(),o(6,"div",38)(7,"div",39)(8,"h6",40)(9,"span"),l(10),n()(),o(11,"p",41),l(12),n(),o(13,"p",42),b(14,Z,2,5,"ng-container",43),o(15,"span",44),l(16),n()(),o(17,"p",41),l(18),n(),o(19,"div",45)(20,"button",46),u("click",function(){let a=c(e).$implicit,d=y(3);return p(d.selectedStaff=a)}),m(21,"i",47),n(),o(22,"button",48),u("click",function(){let a=c(e).$implicit,d=y(3);return p(d.selectedStaff=a)}),m(23,"i",49),n()()()()()()()}if(r&2){let e=t.$implicit,i=y(3);s(5),f("src",e.imageUrl||((e.gender==null?null:e.gender.toLowerCase())==="female","/assets/profile.jpeg"),D),s(5),V(e.name),s(2),O(" ",e.experience," Years Experience | ",e.duties," Duties "),s(2),f("ngForOf",i.getStars(e.rating)),s(2),C("",e.rating,"/5"),s(2),C("\u20B9",e.price),s(2),f("disabled",e.isBooked)}}function te(r,t){if(r&1&&(o(0,"div",29)(1,"div",30),l(2),z(3,"titlecase"),n(),b(4,ee,24,8,"div",31),n()),r&2){let e=t.$implicit;s(2),O(" ",A(3,3,e.category)," (",(e.availableStaff==null?null:e.availableStaff.length)||0,") "),s(2),f("ngForOf",e.availableStaff)}}function ne(r,t){if(r&1&&(k(0),b(1,te,5,5,"div",28),I()),r&2){let e=y();s(),f("ngForOf",e.staffDetails)}}function ie(r,t){r&1&&(o(0,"div",51)(1,"h2"),l(2,"No staff found."),n()())}var Q=class r{constructor(t,e){this.router=t;this.bookingResponseService=e}staffDetails=[];selectedStaff;razorpayKeyId="rzp_test_RARA6BGk8D2Y2o";isPaymentLoading=!1;ngOnInit(){this.fetchBookingResponses()}fetchBookingResponses(){this.bookingResponseService.getBookingResponse().subscribe({next:t=>{let e=t?.staff??[],i=[];e.forEach(a=>{(a.staffDetails??[]).forEach(d=>{i.push({category:d.typeOfStaff,availableStaff:d.availableStaff??[]})})}),this.staffDetails=i,console.log("API staff:",t.staff),console.log("Formatted staff:",i)},error:t=>{console.error("Error fetching booking responses",t)}})}getStars(t){let e=[];for(let i=0;i<5;i++){let a=i+1;t>=a?e.push("full"):t>a-1&&t<a?e.push("half"):e.push("empty")}return e}removeStaff(t){if(!t.id){console.error("No ID found for staff:",t);return}this.bookingResponseService.removeStaffFromBooking(t.id).subscribe({next:()=>{this.staffDetails.forEach(e=>{e.availableStaff=e.availableStaff.filter(i=>i.id!==t.id)})},error:e=>{console.error("Error removing staff:",e)}})}addSpecificStaff(t){if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){alert("Please login or signup first to access book staff page"),this.router.navigate(["/login"]);return}let i={staffForms:[{typeOfStaff:t.typeOfStaff||t.category,typeOfSubStaff:t.typeOfSubStaff,shifts:[{timeSlot:t.timeSlot,shiftType:t.shiftType||"Day",maleQuantity:t.gender?.toLowerCase()==="male"?1:0,femaleQuantity:t.gender?.toLowerCase()==="female"?1:0,tenure:t.tenure,dutyStartDate:String(t.dutyStartDate||new Date().toISOString().split("T")[0])}]}]};this.bookingResponseService.addIndividualStaff(i).subscribe({next:()=>{alert(`${t.name} has been added to your booking!`),t.isBooked=!0},error:a=>{console.error("Error adding staff:",a),alert("Failed to add staff. Please try again.")}})}onProceedToPayment(t,e,i){return T(this,null,function*(){try{if(!this.razorpayKeyId){alert("Razorpay Key ID is missing. Please add it in the component.");return}let a=this.getPayableAmount();if(!(a>0)){alert("Invalid amount.");return}this.isPaymentLoading=!0,yield this.loadRazorpaySdk();let d={key:this.razorpayKeyId,amount:Math.round(a*100),currency:"INR",name:"Your Company Name",description:"Booking Payment",prefill:{name:t||"",email:"",contact:""},notes:{billing_address:e||"",gst_number:i||""},theme:{color:"#0d6efd"},modal:{ondismiss:()=>console.log("Razorpay Checkout closed.")},handler:g=>{this.onPaymentSuccess(g,a)}},v=new Razorpay(d);v.on("payment.failed",g=>this.onPaymentFailed(g)),v.open()}catch(a){console.error("Payment init error:",a),alert("Unable to start payment. Please try again.")}finally{this.isPaymentLoading=!1}})}onPaymentSuccess(t,e){console.log("Payment success:",t),alert(`Payment successful! Payment ID: ${t?.razorpay_payment_id||"N/A"}`)}onPaymentFailed(t){console.error("Payment failed:",t);let e=t?.error?.description||"Payment failed. Please try again.";alert(e)}loadRazorpaySdk(){return new Promise((t,e)=>{if(typeof Razorpay<"u"){t();return}let i=document.getElementById("razorpay-checkout-js");if(i){i.addEventListener("load",()=>t()),i.addEventListener("error",()=>e(new Error("Failed to load Razorpay SDK.")));return}let a=document.createElement("script");a.id="razorpay-checkout-js",a.src="https://checkout.razorpay.com/v1/checkout.js",a.async=!0,a.onload=()=>t(),a.onerror=()=>e(new Error("Failed to load Razorpay SDK.")),document.body.appendChild(a)})}getPayableAmount(){return 1212}static \u0275fac=function(e){return new(e||r)(E(Y),E(w))};static \u0275cmp=M({type:r,selectors:[["app-view-staff"]],decls:66,vars:2,consts:[["noStaff",""],["billingAddress",""],["billingName",""],["gstNumber",""],[1,"container-fluid","mt-4"],[4,"ngIf","ngIfElse"],[1,"bg-white","px-0"],[1,"p-3","d-flex","justify-content-between"],[1,"text-muted"],["data-bs-toggle","modal","data-bs-target","#exampleModal",1,"submission","btn","btn-primary","text-light","rounded-pill","btn-sm"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"form-group"],["type","text","placeholder","Enter you billing address",1,"form-control"],[1,"form-group","my-3"],["type","text","placeholder","Enter your name",1,"form-control"],["type","text","placeholder","Enter GST number",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-primary","submission","text-light","btn-sm","w-100","rounded-pill",3,"click"],["id","swapStaff","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["type","button",1,"btn","submission","text-light","btn-sm","w-100","rounded-pill"],["type","submit",1,"btn","btn-primary","submission","text-light","btn-sm","rounded-pill",3,"click"],["id","deleteStaff","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-12","mb-2"],["class","col-md-3 mb-4",4,"ngFor","ngForOf"],[1,"col-md-3","mb-4"],[1,"card","h-100"],[1,"row","g-0"],[1,"col-4"],[1,"staff-img"],["alt","Staff Image",1,"img-fluid","rounded",3,"src"],[1,"col-7"],[1,"card-body","p-2"],[1,"card-title","mb-1"],[1,"mb-1","text-muted"],[1,"mb-1"],[4,"ngFor","ngForOf"],[1,"ms-1","text-warning"],[1,"d-flex","justify-content-start","gap-2","mt-2"],["data-bs-toggle","modal","data-bs-target","#swapStaff",1,"btn","btn-outline-primary","actionSwap",3,"click","disabled"],[1,"bi","bi-arrow-left-right"],["data-bs-toggle","modal","data-bs-target","#deleteStaff",1,"btn","btn-sm","btn-outline-danger","actionDelete",3,"click"],[1,"bi","bi-x-lg"],[1,"bi",3,"ngClass"],[1,"text-center","mt-4"]],template:function(e,i){if(e&1){let a=P();o(0,"div",4),b(1,ne,2,1,"ng-container",5)(2,ie,3,0,"ng-template",null,0,L),n(),o(4,"footer",6)(5,"div",7)(6,"p",8),l(7,"Total Staff: 01"),n(),o(8,"button",9),l(9,"Proceed to Booking (1212)"),n()()(),o(10,"div",10)(11,"div",11)(12,"div",12)(13,"div",13)(14,"h1",14),l(15,"Please Enter Billing Information"),n(),m(16,"button",15),n(),o(17,"div",16)(18,"div",17)(19,"label"),l(20,"Billing Address"),n(),m(21,"input",18,1),n(),o(23,"div",19)(24,"label"),l(25,"Your Name"),n(),m(26,"input",20,2),n(),o(28,"div",17)(29,"label"),l(30,"GST Number"),n(),m(31,"input",21,3),n()(),o(33,"div",22)(34,"button",23),u("click",function(){c(a);let v=S(22),g=S(27),q=S(32);return p(i.onProceedToPayment(g.value,v.value,q.value))}),l(35," Proceed to Payment (1212) "),n()()()()(),o(36,"div",24)(37,"div",11)(38,"div",12)(39,"div",13)(40,"h1",14),l(41,"Please Enter Billing Information"),n(),m(42,"button",15),n(),o(43,"div",16)(44,"h5"),l(45,"Are you Sure, you want to swap the Staff?"),n()(),o(46,"div",22)(47,"button",25),l(48,"No"),n(),o(49,"button",26),u("click",function(){return c(a),p(i.addSpecificStaff(i.selectedStaff))}),l(50,"Yes"),n()()()()(),o(51,"div",27)(52,"div",11)(53,"div",12)(54,"div",13)(55,"h1",14),l(56,"Confirm"),n(),m(57,"button",15),n(),o(58,"div",16)(59,"h5"),l(60,"Are you sure you want to remove this staff ?"),n()(),o(61,"div",22)(62,"button",25),l(63,"Cancel"),n(),o(64,"button",26),u("click",function(){return c(a),p(i.removeStaff(i.selectedStaff))}),l(65,"Remove"),n()()()()()}if(e&2){let a=S(3);s(),f("ngIf",i.staffDetails.length>0)("ngIfElse",a)}},dependencies:[G,$,j,K,H],styles:[".text-center[_ngcontent-%COMP%]{position:fixed;top:50%;left:45%}.bi-star-half.text-warning[_ngcontent-%COMP%], .bi-star-full.text-warning[_ngcontent-%COMP%]{color:#000!important}.actionSwap[_ngcontent-%COMP%]{width:36px!important;height:37px!important;border-radius:100%!important;padding:0!important;background:#e4f4f3!important;border:0!important}.actionSwap[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:18px!important}.actionDelete[_ngcontent-%COMP%]{border:0!important;background:#ffe6e6!important;padding:0!important;width:36px!important;height:37px!important;border-radius:100%!important}.actionDelete[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:18px!important}.card[_ngcontent-%COMP%]{border:1px solid #ccebec!important;background:#f4f5f7!important}.card[_ngcontent-%COMP%]   .staff-img[_ngcontent-%COMP%]{height:auto;background:#fff;border-radius:20px;position:relative;margin:30px 10px;padding:10px 0}footer[_ngcontent-%COMP%]{position:sticky;bottom:0;width:100%}.form-control[_ngcontent-%COMP%]{border-radius:25px!important}"]})};export{Q as ViewStaff};
