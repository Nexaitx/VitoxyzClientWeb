import{a as Be,b as Re}from"./chunk-4PZI7MTW.js";import{a as $,b as F}from"./chunk-4GGGPJXP.js";import{A as Te,B as Fe,C as Pe,D as Ve,c as W,d as k,g as U,h as ve,i as be,k as Me,l as Ce,m as ke,o as ze,p as we,q as xe,r as Ie,s as Se,t as Ee,u as De,v as Oe,w as Le,y as Ae}from"./chunk-K4IQAZ7W.js";import{b as ye}from"./chunk-YXY7IAER.js";import{g as ue,h as pe,i as me,k as he,m as H,q as _e,r as fe}from"./chunk-57WIWK2G.js";import{$ as ne,Db as p,Eb as s,Fb as o,Gb as h,Hb as oe,Ib as se,Kb as N,Lb as Z,Nb as w,Rb as b,Sb as le,Tb as c,Xa as d,Xb as de,Yb as Y,Zb as J,a as A,ab as re,b as B,da as R,dc as O,fc as u,gc as ce,hb as D,hc as E,ia as _,ib as ae,ja as f,jc as X,kc as ee,lc as te,mb as z,nc as T,pb as G,qc as ge,sc as Q,tc as j,yb as M,zb as C}from"./chunk-IHMD6L5C.js";var Ge=(()=>{class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=ae({type:a});static \u0275inj=ne({})}return a})();var Ue=["mapElement"],q=class a{mapElement;locationSelected=new G;userLat=28.6139;userLng=77.209;map;ngOnInit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.userLat=t.coords.latitude,this.userLng=t.coords.longitude,this.initMap()},t=>{console.error("Geolocation error:",t),this.initMap()}):(console.warn("Geolocation not supported"),this.initMap())}ngAfterViewInit(){navigator.geolocation||this.initMap()}initMap(){if(typeof google>"u"||!google.maps){console.error("Google Maps API not loaded");return}this.map=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:this.userLat,lng:this.userLng},zoom:12}),new google.maps.Marker({map:this.map,position:{lat:this.userLat,lng:this.userLng},title:"You are here"}),this.map.addListener("click",t=>{let e=t.latLng.lat(),n=t.latLng.lng();this.locationSelected.emit({lat:e,lng:n})})}onMapClick(t){let e=t.latLng.lat(),n=t.latLng.lng();this.locationSelected.emit({lat:e,lng:n})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=D({type:a,selectors:[["app-map"]],viewQuery:function(e,n){if(e&1&&de(Ue,5),e&2){let i;Y(i=J())&&(n.mapElement=i.first)}},outputs:{locationSelected:"locationSelected"},decls:2,vars:0,consts:[["mapElement",""],[1,"map-container",3,"mapClick"]],template:function(e,n){if(e&1){let i=w();oe(0,"div",1,0),le("mapClick",function(l){return _(i),f(n.onMapClick(l))}),se()}},dependencies:[Ge],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:auto;min-height:400px;margin-top:10px;position:relative!important;overflow:hidden!important}[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     #mapElement{width:100%;height:90%}"]})};var Ke=a=>({"is-invalid":a});function Ye(a,t){if(a&1){let e=w();s(0,"button",5),b("click",function(){_(e);let i=c(2);return f(i.closePopup())}),o()}}function Je(a,t){if(a&1){let e=w();s(0,"div")(1,"input",6),te("ngModelChange",function(i){_(e);let r=c(2);return ee(r.aadharNumber,i)||(r.aadharNumber=i),f(i)}),o(),s(2,"button",7),b("click",function(){_(e);let i=c(2);return f(i.sendOtp())}),u(3,"Send OTP"),o()()}if(a&2){let e=c(2);d(),X("ngModel",e.aadharNumber)}}function Xe(a,t){a&1&&(s(0,"div",11),u(1,"Invalid OTP. Please try again."),o())}function et(a,t){if(a&1){let e=w();s(0,"div")(1,"input",8),te("ngModelChange",function(i){_(e);let r=c(2);return ee(r.otp,i)||(r.otp=i),f(i)}),b("input",function(){_(e);let i=c(2);return f(i.otpError=!1)}),o(),s(2,"button",9),b("click",function(){_(e);let i=c(2);return f(i.verifyOtp())}),u(3,"Verify OTP"),o(),z(4,Xe,2,0,"div",10),o()}if(a&2){let e=c(2);d(),p("ngClass",ge(3,Ke,e.otpError)),X("ngModel",e.otp),d(3),p("ngIf",e.otpError)}}function tt(a,t){if(a&1&&(s(0,"div",1),z(1,Ye,1,0,"button",2),s(2,"h5",3),u(3,"Aadhar Verification"),o(),z(4,Je,4,1,"div",4)(5,et,5,5,"div",4),o()),a&2){let e=c();d(),p("ngIf",e.step==="input"),d(3),p("ngIf",e.step==="input"),d(),p("ngIf",e.step==="otp")}}var K=class a{verified=new G;aadharNumber="";otp="";step="input";otpError=!1;isVisible=!0;generatedOtp="123456";sendOtp(){if(this.aadharNumber.length!==12||!/^\d{12}$/.test(this.aadharNumber)){alert("Please enter a valid 12-digit Aadhar number.");return}console.log("Sending OTP to:",this.aadharNumber),setTimeout(()=>{console.log("OTP sent successfully!"),this.step="otp"},500)}verifyOtp(){this.otp===this.generatedOtp?(console.log("OTP verified successfully!"),this.verified.emit(),this.closePopup()):this.otpError=!0}closePopup(){this.isVisible=!1}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=D({type:a,selectors:[["app-aadhar-verification"]],outputs:{verified:"verified"},decls:1,vars:1,consts:[["class","aadhar-toast-box",4,"ngIf"],[1,"aadhar-toast-box"],["class","btn-close top-right",3,"click",4,"ngIf"],[1,"text-center","mb-3"],[4,"ngIf"],[1,"btn-close","top-right",3,"click"],["type","text","placeholder","Enter your 12-digit Aadhar Number","maxlength","12",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","w-100",3,"click"],["type","text","placeholder","Enter 6-digit OTP","maxlength","6",1,"form-control","mb-2",3,"ngModelChange","input","ngClass","ngModel"],[1,"btn","btn-success","w-100",3,"click"],["class","text-danger text-center mt-1",4,"ngIf"],[1,"text-danger","text-center","mt-1"]],template:function(e,n){e&1&&z(0,tt,6,3,"div",0),e&2&&p("ngIf",n.isVisible)},dependencies:[H,ue,me,Pe,W,U,Ae,Me],styles:[".aadhar-toast-box[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:320px;background:#fff;border-radius:10px;box-shadow:0 5px 15px #00000040;z-index:1050;padding:20px;display:flex;flex-direction:column}.top-right[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px}"]})};function it(a,t){a&1&&(s(0,"div",16),u(1," Area is required. "),o())}function nt(a,t){if(a&1&&(s(0,"div",20),h(1,"div",25),s(2,"span",26),u(3),o(),h(4,"div",25),o()),a&2){let e=c().index;d(3),ce(e)}}function rt(a,t){if(a&1){let e=w();s(0,"button",27),b("click",function(){_(e);let i=c().index,r=c();return f(r.removeStaff(i))}),h(1,"i",28),o()}}function at(a,t){if(a&1&&(s(0,"option",36),u(1),o()),a&2){let e=t.$implicit;p("value",e.name),d(),E(" ",e.name," ")}}function ot(a,t){a&1&&(s(0,"div",16),u(1," Type of Staff is required. "),o())}function st(a,t){if(a&1&&(s(0,"option",36),u(1),o()),a&2){let e=t.$implicit;p("value",e.value),d(),E(" ",e.label," ")}}function lt(a,t){if(a&1&&(s(0,"div",16),u(1),Q(2,"titlecase"),o()),a&2){let e,n=c(2).$implicit;d(),E(" Type of ",j(2,1,(e=n.get("typeOfStaff"))==null?null:e.value)," is required. ")}}function dt(a,t){if(a&1&&(N(0),s(1,"div",37)(2,"div",12)(3,"label",31),u(4),Q(5,"titlecase"),o(),h(6,"i",38),s(7,"select",39)(8,"option",34),u(9),Q(10,"titlecase"),o(),z(11,st,2,2,"option",35),o(),M(12,lt,3,3,"div",16),o()(),Z()),a&2){let e,n,i,r,l,g=c().$implicit,y=c().index,v=c();d(3),p("for",T("typeOfSubStaff-",y)),d(),E("Select ",j(5,11,(e=g.get("typeOfStaff"))==null?null:e.value)," Type"),d(3),O("is-invalid",((n=g.get("typeOfSubStaff"))==null?null:n.invalid)&&((n=g.get("typeOfSubStaff"))==null?null:n.touched)),p("id",T("typeOfSubStaff-",y))("disabled",!((i=g.get("typeOfStaff"))!=null&&i.value)),d(2),E("Select ",j(10,13,(r=g.get("typeOfStaff"))==null?null:r.value)," "),d(2),p("ngForOf",v.staffSubCategories[y]),d(),C((l=g.get("typeOfSubStaff"))!=null&&l.invalid&&((l=g.get("typeOfSubStaff"))!=null&&l.touched)?12:-1)}}function ct(a,t){if(a&1&&(s(0,"div",29)(1,"div",1)(2,"div",30)(3,"div",12)(4,"label",31),u(5,"Select Staff Type"),o(),h(6,"i",32),s(7,"select",33)(8,"option",34),u(9,"Select Type"),o(),z(10,at,2,2,"option",35),o(),M(11,ot,2,0,"div",16),o()(),M(12,dt,13,15,"ng-container"),o()()),a&2){let e,n,i,r=t.$implicit,l=t.index,g=c().index,y=c();p("formGroupName",l),d(4),p("for",T("typeOfStaff-",g)),d(3),O("is-invalid",((e=r.get("typeOfStaff"))==null?null:e.invalid)&&((e=r.get("typeOfStaff"))==null?null:e.touched)),p("id",T("typeOfStaff-",g)),d(3),p("ngForOf",y.staffCategories),d(),C((n=r.get("typeOfStaff"))!=null&&n.invalid&&((n=r.get("typeOfStaff"))!=null&&n.touched)?11:-1),d(),C((i=r.get("typeOfStaff"))!=null&&i.value&&((i=r.get("typeOfStaff"))==null?null:i.value)!==""?12:-1)}}function gt(a,t){a&1&&(s(0,"div",57),u(1," Past time is not allowed. "),o())}function ut(a,t){if(a&1&&(s(0,"option",36),u(1),o()),a&2){let e=t.$implicit;p("value",e),d(),E(" ",e," ")}}function pt(a,t){a&1&&(s(0,"div",16),u(1," Shift Type is required. "),o())}function mt(a,t){a&1&&(s(0,"div",57),u(1," Quantity is required. "),o())}function ht(a,t){if(a&1&&(s(0,"option",36),u(1),o()),a&2){let e=t.$implicit;p("value",e.value),d(),E(" ",e.label," ")}}function _t(a,t){a&1&&(s(0,"div",16),u(1," Tenure is required. "),o())}function ft(a,t){if(a&1){let e=w();s(0,"i",74),b("click",function(){_(e);let i=c(3).index,r=c();return f(r.addShift(i))}),o()}}function yt(a,t){if(a&1){let e=w();s(0,"i",75),b("click",function(){_(e);let i=c().index,r=c(2).index,l=c();return f(l.removeShiftDetail(r,i))}),o()}}function vt(a,t){if(a&1){let e=w();s(0,"div",42)(1,"div",43)(2,"div",44)(3,"label",13),u(4,"Duty Start Time"),o(),s(5,"div",45)(6,"div",46)(7,"button",47),b("click",function(){let i=_(e).index,r=c(2).index,l=c();return f(l.decrementTime("hours",r,i))}),h(8,"i",48),o(),h(9,"input",49),s(10,"button",50),b("click",function(){let i=_(e).index,r=c(2).index,l=c();return f(l.incrementTime("hours",r,i))}),h(11,"i",51),o()(),s(12,"div",52)(13,"button",47),b("click",function(){let i=_(e).index,r=c(2).index,l=c();return f(l.decrementTime("minutes",r,i))}),h(14,"i",48),o(),h(15,"input",53),s(16,"button",50),b("click",function(){let i=_(e).index,r=c(2).index,l=c();return f(l.incrementTime("minutes",r,i))}),h(17,"i",51),o()(),s(18,"select",54)(19,"option",55),u(20,"AM"),o(),s(21,"option",56),u(22,"PM"),o()()(),M(23,gt,2,0,"div",57),o(),s(24,"div",58)(25,"label",13),u(26,"Shift Time"),o(),s(27,"select",59)(28,"option",34),u(29,"Select Time"),o(),z(30,ut,2,2,"option",35),o(),M(31,pt,2,0,"div",16),o(),s(32,"div",58)(33,"div",12)(34,"label",60),u(35,"Prefered Gender"),o(),h(36,"i",61)(37,"input",62),o(),s(38,"div",12),h(39,"i",63)(40,"input",64),o(),M(41,mt,2,0,"div",57),o(),s(42,"div",58)(43,"label",13),u(44,"Quantity"),o(),s(45,"div",65)(46,"button",47),b("click",function(){let i=_(e).index,r=c(2).index,l=c();return f(l.decrease("maleQuantity",r,i))}),h(47,"i",48),o(),h(48,"input",66),s(49,"button",50),b("click",function(){let i=_(e).index,r=c(2).index,l=c();return f(l.increase("maleQuantity",r,i))}),h(50,"i",51),o()(),s(51,"div",67)(52,"button",47),b("click",function(){let i=_(e).index,r=c(2).index,l=c();return f(l.decrease("femaleQuantity",r,i))}),h(53,"i",48),o(),h(54,"input",66),s(55,"button",50),b("click",function(){let i=_(e).index,r=c(2).index,l=c();return f(l.increase("femaleQuantity",r,i))}),h(56,"i",51),o()()(),s(57,"div",58)(58,"div",12)(59,"label",13),u(60,"Tenure"),o(),h(61,"i",68),s(62,"select",69),z(63,ht,2,2,"option",35),o(),M(64,_t,2,0,"div",16),o()(),s(65,"div",11)(66,"label",13),u(67,"Duty Start Date"),o(),h(68,"input",70),o(),s(69,"div",71),M(70,ft,1,0,"i",72),M(71,yt,1,0,"i",73),o()()()}if(a&2){let e,n,i,r,l,g,y,v,m=t.$implicit,x=t.index,L=c(2).index,I=c();p("formGroupName",x),d(5),O("is-invalid",((e=m.get("timeSlot"))==null||e.errors==null?null:e.errors.pastTime)&&((e=m.get("timeSlot"))==null?null:e.touched)),d(4),p("value",I.pad((n=m.get("hours"))==null?null:n.value)),d(6),p("value",I.pad((i=m.get("minutes"))==null?null:i.value)),d(8),C(!((r=m.get("timeSlot"))==null||r.errors==null)&&r.errors.pastTime&&((r=m.get("timeSlot"))!=null&&r.touched)?23:-1),d(4),O("is-invalid",((l=m.get("shiftType"))==null?null:l.invalid)&&((l=m.get("shiftType"))==null?null:l.touched)),d(3),p("ngForOf",I.shiftTypes),d(),C((g=m.get("shiftType"))!=null&&g.invalid&&((g=m.get("shiftType"))!=null&&g.touched)?31:-1),d(10),C(m.errors!=null&&m.errors.zeroQuantity&&(m.touched||m.dirty)?41:-1),d(7),p("formControlName","maleQuantity"),d(6),p("formControlName","femaleQuantity"),d(8),O("is-invalid",((y=m.get("tenure"))==null?null:y.invalid)&&((y=m.get("tenure"))==null?null:y.touched)),d(),p("ngForOf",I.tenure),d(),C((v=m.get("tenure"))!=null&&v.invalid&&((v=m.get("tenure"))!=null&&v.touched)?64:-1),d(4),p("min",I.today),d(2),C(x===0||x===I.getNestedShiftDetailsControls(L).length-1?70:-1),d(),C(x>0?71:-1)}}function bt(a,t){if(a&1&&(N(0),s(1,"div",40),z(2,vt,72,20,"div",41),o(),Z()),a&2){let e=c().index,n=c();d(2),p("ngForOf",n.getNestedShiftDetailsControls(e))}}function Mt(a,t){if(a&1&&(s(0,"div",19),M(1,nt,5,1,"div",20),s(2,"div",21),M(3,rt,2,0,"button",22),o(),s(4,"div",23),z(5,ct,13,10,"div",24),o(),M(6,bt,3,1,"ng-container"),o()),a&2){let e,n=t.index,i=c();p("formGroupName",n),d(),C(n>0?1:-1),d(2),C(n!==0?3:-1),d(2),p("ngForOf",i.getNestedStaffDetailsControls(n)),d(),C((e=i.getNestedStaffDetailsControls(n)[0].get("typeOfStaff"))!=null&&e.value?6:-1)}}function Ct(a,t){if(a&1){let e=w();N(0),s(1,"div",76)(2,"button",77),b("click",function(){_(e);let i=c();return f(i.addNewStaff())}),h(3,"i",51),u(4,"Add Another Staff "),o()(),s(5,"div",78),h(6,"app-submission",79),o(),Z()}if(a&2){let e=c();d(6),p("buttonType",e.button)}}function kt(a,t){if(a&1){let e=w();s(0,"app-aadhar-verification",80),b("verified",function(){_(e);let i=c();return f(i.onAadharVerified())}),o()}}var Ze=class a{constructor(t){this.spinnerService=t}fb=R(Fe);http=R(fe);router=R(ye);staffBookingForm;hours=Array.from({length:24},(t,e)=>e);minutes=[0,15,30,45];nurseTenure=["1 Day","15 Days","Monthly","Quarterly","Half Yearly","Yearly"];button="Search for staff";staffCategories=[];staffSubCategories={};shiftTypes=["2 Hours Max","8 Hours","12 Hours","24 Hours"];tenure=[{label:"1 Day",value:"1"},{label:"3 Days",value:"2"},{label:"1 Week",value:"3"},{label:"2 Weeks",value:"4"},{label:"1 Month",value:"5"}];today=new Date().toISOString().split("T")[0];isToken=localStorage.getItem("authToken");isLogin=!1;showAadharPopup=!1;staffSearchResponse=null;ngOnInit(){this.getUserLocation(),this.getStaffCategories(),this.staffBookingForm=this.fb.group({userAddress:["",k.required],latitude:[],longitude:[],staffForms:this.fb.array([this.createStaffFormGroup()])}),this.subscribeToCategoryChange(0)}getStaffCategories(){let t=$+F.CATEGORIES;this.http.get(t).subscribe({next:e=>{this.staffCategories=e||[]},error:e=>{console.error("Error fetching categories:",e)}})}subscribeToCategoryChange(t){let i=this.staffListFormArray.at(t).get("staffDetails").at(0);i.get("typeOfStaff")?.valueChanges.subscribe(r=>{let l=this.staffCategories.find(g=>g.name===r);if(l){let g=l.id;this.fetchSubCategories(g,t),i.get("typeOfSubStaff")?.setValue("")}})}incrementTime(t,e,n){let i=this.getShiftGroup(e,n);if(i)if(t==="hours"){let r=+i.get("hours")?.value||1;r=r%12+1,r===0&&(r=12),i.get("hours")?.setValue(r)}else{let r=+i.get("minutes")?.value||0;r=(r+1)%60,i.get("minutes")?.setValue(r)}}decrementTime(t,e,n){let i=this.getShiftGroup(e,n);if(i)if(t==="hours"){let r=+i.get("hours")?.value||1;r=(r-1+12)%12,r===0&&(r=12),i.get("hours")?.setValue(this.pad(r))}else{let r=+i.get("minutes")?.value||0;r=(r-1+60)%60,i.get("minutes")?.setValue(this.pad(r))}}getShiftGroup(t,e){return this.staffListFormArray.at(t).get("shiftDetails").at(e)}pad(t){return t!=null?t.toString().padStart(2,"0"):"00"}increase(t,e,n){let i=this.getQuantityControl(t,e,n);i.setValue(Math.min((i.value||0)+1,10)),this.updateGenderInShift(e,n)}decrease(t,e,n){let i=this.getQuantityControl(t,e,n);i.setValue(Math.max((i.value||1)-1,0)),this.updateGenderInShift(e,n)}updateGenderInShift(t,e){let n=this.getShiftGroup(t,e);n&&this.updateGenderQty(n)}getQuantityControl(t,e,n){return this.staffListFormArray.at(e).get("shiftDetails").at(n).get(t==="maleQuantity"?"maleQuantity":"femaleQuantity")}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{let e=t.coords.latitude,n=t.coords.longitude;this.getAddressFromCoords(e,n)},t=>{console.error("Geolocation failed:",t)}):console.error("Geolocation not supported by this browser.")}getAddressFromCoords(t,e){this.staffBookingForm.patchValue({latitude:t,longitude:e});let n=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${t}&lon=${e}`;this.http.get(n).subscribe(i=>{let r=i.display_name;r&&this.staffBookingForm.patchValue({userAddress:r})},i=>{console.error("Error fetching address:",i)})}createStaffDetailFormGroup(){return this.fb.group({typeOfStaff:["",k.required],typeOfSubStaff:["",k.required]})}fetchSubCategories(t,e){let n=`${$}${F.CATEGORIES}/${t}${F.SUB_CATEGORIES}`;this.http.get(n).subscribe({next:i=>{this.staffSubCategories[e]=i},error:i=>{console.error("Failed to fetch subcategories",i),this.staffSubCategories[e]=[]}})}get staffDetailsFormArray(){return this.staffBookingForm.get("staffDetails")}createShiftDetailFormGroup(){let e=new Date().getHours(),n="00",i=e>=12?"PM":"AM";e===0?e=12:e>12&&(e-=12);let r=this.fb.group({shiftType:["",k.required],timeSlot:[""],tenure:["1"],dutyStartDate:[new Date().toISOString().substring(0,10)],maleQuantity:["0",[k.min(0),k.max(10)]],femaleQuantity:["0",[k.min(0),k.max(10)]],hours:[e,[k.required,k.min(1),k.max(12)]],minutes:[n,[k.required,k.min(0),k.max(59)]],ampm:[i,k.required]},{validators:[this.shiftDurationValidator]});return r.get("hours")?.valueChanges.subscribe(()=>this.updateTimeSlot(r)),r.get("minutes")?.valueChanges.subscribe(()=>this.updateTimeSlot(r)),r.get("ampm")?.valueChanges.subscribe(()=>this.updateTimeSlot(r)),r.get("maleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(r)),r.get("femaleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(r)),r.get("dutyStartDate")?.valueChanges.subscribe(l=>{if(!l){let g=new Date().toISOString().substring(0,10);r.get("dutyStartDate")?.setValue(g,{emitEvent:!1})}}),r}updateTimeSlot(t){let e=t.get("hours")?.value??0,n=t.get("minutes")?.value??0,i=t.get("ampm")?.value??"AM",r=y=>y.toString().padStart(2,"0"),l=`${r(+e)}:${r(+n)} ${i}`,g=t.get("timeSlot");g?.setValue(l,{emitEvent:!1}),g?.markAsTouched(),g?.markAsDirty()}updateGenderQty(t){let e=Number(t.get("maleQuantity")?.value||0),n=Number(t.get("femaleQuantity")?.value||0);t.get("maleQuantity")?.setValue(e),t.get("gender")?.setValue(n)}get shiftDetailsFormArray(){return this.staffBookingForm.get("shiftDetails")}createStaffFormGroup(){return this.fb.group({staffDetails:this.fb.array([this.createStaffDetailFormGroup()]),shiftDetails:this.fb.array([this.createShiftDetailFormGroup()])})}addShift(t){this.staffListFormArray.at(t).get("shiftDetails").push(this.createShiftDetailFormGroup())}removeShiftDetail(t,e){this.staffListFormArray.at(t).get("shiftDetails").removeAt(e)}addNewStaff(){this.staffListFormArray.push(this.createStaffFormGroup());let t=this.staffListFormArray.length-1;this.subscribeToCategoryChange(t)}get staffListFormArray(){return this.staffBookingForm.get("staffForms")}getNestedShiftDetailsControls(t){return this.staffListFormArray.at(t).get("shiftDetails").controls}getNestedStaffDetailsControls(t){return this.staffListFormArray.at(t).get("staffDetails").controls}removeStaff(t){this.staffListFormArray.removeAt(t)}onSubmit(){let t=this.hasPastTimeError(),e=this.hasZeroQuantityError();if(!this.staffBookingForm.valid||t||e){this.markAllAsTouched(this.staffBookingForm),console.log("Form validation failed.");return}let n=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),i=JSON.parse(localStorage.getItem("userProfile")||"{}"),r=i.aadhaarStatus===!0;if(console.log("User Profile from localStorage:",i),console.log("Aadhaar Status:",i.aadhaarStatus),console.log("Token retrieved from localStorage:",n?"Token present":"Token NOT present"),!n){console.log("User not logged in. Redirecting to login page."),alert("Please login or signup first to access book staff page"),this.router.navigate(["/login"]);return}if(!r){console.log("Aadhaar not verified. Showing Aadhaar popup."),this.showAadharPopup=!0;return}console.log("User is logged in and Aadhaar is verified. Proceeding with API call."),console.log("Token being sent in Authorization header (first few chars):",n?n.substring(0,20)+"...":"No token"),console.log("Full token length:",n?n.length:"0"),this.spinnerService.show();let l=$+F.BOOK_STAFF,g=B(A({},this.staffBookingForm.value),{staffForms:this.staffListFormArray.controls.map(v=>{let m=v.get("staffDetails").at(0),{typeOfStaff:x,typeOfSubStaff:L}=m.value,I=v.get("shiftDetails").controls.map(S=>{let{shiftType:P,timeSlot:V,tenure:Qe,maleQuantity:je,femaleQuantity:He,dutyStartDate:We}=S.value;return{shiftType:P,timeSlot:V,tenure:Qe,maleQuantity:je,femaleQuantity:He,dutyStartDate:We}});return{typeOfStaff:x,typeOfSubStaff:L,shifts:I}})}),y=new _e({"Content-Type":"application/json"});y=y.set("Authorization",`Bearer ${n}`),console.log("Headers sent with request:",y),this.http.post(l,g,{headers:y}).subscribe({next:v=>{if(this.spinnerService.hide(),console.log("API Response:",v),v?.status===!0){let m=v?.staff?.[0]?.staffDetails||[];this.router.navigate(["/view-staff"],{state:{staffDetails:m,bookingIds:v.bookingIds}})}else console.warn("Booking failed:",v?.message||"Unknown error"),alert(v?.message||"Something went wrong.")},error:v=>{console.error("Staff search API call failed:",v),this.spinnerService.hide(),alert("An error occurred while processing your request.")}})}onAadharVerified(){this.showAadharPopup=!1;let t=JSON.parse(localStorage.getItem("userProfile")||"{}");t.aadhaarStatus=!0,localStorage.setItem("userProfile",JSON.stringify(t)),this.onSubmit()}hasPastTimeError(){let t=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(i=>{let r=i.get("dutyStartDate")?.value,l=+i.get("hours")?.value,g=+i.get("minutes")?.value,y=i.get("ampm")?.value;if(!r||l==null||g==null||!y)return;let v=new Date(r),m=new Date,x=S=>S.toString().padStart(2,"0"),L=`${x(l)}:${x(g)} ${y}`;if(i.get("timeSlot")?.setValue(L,{emitEvent:!1}),v.getFullYear()===m.getFullYear()&&v.getMonth()===m.getMonth()&&v.getDate()===m.getDate()){let S=l;y==="PM"&&S!==12&&(S+=12),y==="AM"&&S===12&&(S=0);let P=new Date;if(P.setHours(S,g,0,0),P<m)i.get("timeSlot")?.setErrors({pastTime:!0}),t=!0;else{let V=i.get("timeSlot");V?.hasError("pastTime")&&V.setErrors(null)}}})}),t}hasZeroQuantityError(){let t=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(i=>{let r=+i.get("maleQuantity")?.value||0,l=+i.get("femaleQuantity")?.value||0;if(r===0&&l===0)i.setErrors(B(A({},i.errors||{}),{zeroQuantity:!0})),t=!0;else if(i.errors?.zeroQuantity){let g=A({},i.errors);delete g.zeroQuantity,i.setErrors(Object.keys(g).length?g:null)}})}),t}markAllAsTouched(t){Object.values(t.controls).forEach(e=>{e.markAsTouched(),(e instanceof be||e instanceof Te)&&this.markAllAsTouched(e)})}shiftDurationValidator(t){let e=parseInt(t.get("shiftHour")?.value,10),n=parseInt(t.get("shiftMinute")?.value,10);if(isNaN(e)||isNaN(n))return null;let i=e*60+n,r=(i+8*60)%(24*60);return i>=0&&r>=0?null:{invalidShiftDuration:!0}}static \u0275fac=function(e){return new(e||a)(re(Re))};static \u0275cmp=D({type:a,selectors:[["app-book-staff"]],decls:23,vars:7,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-4","h-100"],[3,"locationSelected"],[1,"col-md-8","search-staff-form"],[1,"form-scroll-container"],[1,"form-content"],[1,"form-title"],[3,"ngSubmit","formGroup"],[1,"form"],[1,"row","my-3"],[1,"col-md-12"],[1,"form-group"],[1,"form-label"],[1,"bi","bi-geo-alt","address"],["type","text","formControlName","userAddress",1,"form-control","ps-4"],[1,"invalid-feedback"],["formArrayName","staffForms",1,"staff-list"],["class","pe-2",3,"formGroupName",4,"ngFor","ngForOf"],[1,"pe-2",3,"formGroupName"],[1,"indexed-divider-container"],[1,"col-md-12","d-flex","justify-content-end"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px"],["formArrayName","staffDetails"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"line"],[1,"index-number"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px",3,"click"],[1,"bi","bi-trash","fs-5"],[3,"formGroupName"],[1,"col-md-12","mb-2"],[1,"form-label",3,"for"],[1,"bi","bi-person","address"],["formControlName","typeOfStaff",1,"form-select","ps-4",3,"id"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"col-md-12","my-3"],[1,"bi","bi-people","address"],["formControlName","typeOfSubStaff",1,"form-select","ps-4",3,"id","disabled"],["formArrayName","shiftDetails"],["class","shift-detail",3,"formGroupName",4,"ngFor","ngForOf"],[1,"shift-detail",3,"formGroupName"],[1,"row","d-flex"],[1,"col-md-4"],[1,"d-flex","gap-3","align-items-center"],[1,"input-group","input-group-time","d-flex","align-items-center"],["type","button",1,"btn","btn-minus","px-0",3,"click"],[1,"bi","bi-dash"],["type","number","formControlName","hours","value","09","min","0","max","12","readonly","",1,"form-control","px-0",3,"value"],["type","button",1,"btn","btn-plus","px-0",3,"click"],[1,"bi","bi-plus"],[1,"input-group","input-group-time","align-items-center","d-flex"],["type","number","formControlName","minutes","value","00","min","0","max","59","readonly","",1,"form-control","px-0",3,"value"],["formControlName","ampm",1,"form-select","time-select"],["value","AM"],["value","PM"],[1,"text-danger"],[1,"col-md-2"],["formControlName","shiftType",1,"form-select","pe-1"],[1,"form-label","d-block"],[1,"bi","bi-person-standing","address"],["type","text","readonly","","value","Male",1,"form-control","ps-4"],[1,"bi","bi-person-standing-dress","address","female"],["type","text","readonly","","value","Female",1,"form-control","mt-2","ps-4"],[1,"d-flex","align-items-center","mb-2","counter-box"],["type","number","min","0","max","10","readonly","","readonly","",1,"form-control",3,"formControlName"],[1,"d-flex","align-items-center","counter-box"],[1,"bi","bi-calendar4","address"],["formControlName","tenure",1,"form-select","ps-4","pe-1"],["type","date","formControlName","dutyStartDate",1,"form-control",3,"min"],[1,"d-flex","align-items-start","justify-content-end","gap-2","mt-3"],["title","Add Time Slot",1,"bi","bi-plus-lg","add"],["title","Remove Time Slot",1,"bi","bi-trash","text-danger","remove"],["title","Add Time Slot",1,"bi","bi-plus-lg","add",3,"click"],["title","Remove Time Slot",1,"bi","bi-trash","text-danger","remove",3,"click"],[1,"d-flex","justify-content-center","addNewBtn","my-2"],["type","button",1,"btn",3,"click"],[1,"submission-fixed","d-flex","justify-content-end"],[3,"buttonType"],[3,"verified"]],template:function(e,n){if(e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-map",3),b("locationSelected",function(r){return n.getAddressFromCoords(r.lat,r.lng)}),o()(),s(4,"div",4)(5,"div",5)(6,"div",6)(7,"h2",7),u(8,"Please fill the form"),o(),s(9,"form",8),b("ngSubmit",function(){return n.onSubmit()}),s(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),u(15,"Select your area"),o(),h(16,"i",14)(17,"input",15),M(18,it,2,0,"div",16),o()()(),s(19,"div",17),z(20,Mt,7,5,"div",18),o()(),M(21,Ct,7,1,"ng-container"),o()()()()()(),M(22,kt,1,0,"app-aadhar-verification")),e&2){let i,r,l;d(9),p("formGroup",n.staffBookingForm),d(8),O("is-invalid",((i=n.staffBookingForm.get("userAddress"))==null?null:i.invalid)&&((i=n.staffBookingForm.get("userAddress"))==null?null:i.touched)),d(),C((r=n.staffBookingForm.get("userAddress"))!=null&&r.invalid&&((r=n.staffBookingForm.get("userAddress"))!=null&&r.touched)?18:-1),d(2),p("ngForOf",n.staffListFormArray.controls),d(),C(!((l=n.staffListFormArray.controls[0].get("staffDetails"))==null||(l=l.get("0"))==null||(l=l.get("typeOfStaff"))==null)&&l.value?21:-1),d(),C(n.showAadharPopup?22:-1)}},dependencies:[H,pe,Ve,Ce,Ee,De,W,ke,Se,U,ve,Le,Oe,ze,Ie,we,xe,q,Be,K,he],styles:[".form[_ngcontent-%COMP%]{height:52vh;overflow-x:hidden;overflow-y:scroll}.staff-list[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:scroll}.staff-list[_ngcontent-%COMP%]:hover{overflow-y:auto}.staff-list[_ngcontent-%COMP%]:focus-within{overflow-y:auto}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:3px;height:8px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#09b8c2;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#fff}.indexed-divider-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin:20px 0;color:#6c757d;font-weight:700;font-size:.9rem}.line[_ngcontent-%COMP%]{flex-grow:1;height:1px;background-color:#dee2e6}.index-number[_ngcontent-%COMP%]{color:#09b8c2;padding:5px 12px;background-color:#e0fcff;border-radius:50%;min-width:25px;text-align:center;box-shadow:0 1px 3px #0000000d}.form-group[_ngcontent-%COMP%]{position:relative}.address[_ngcontent-%COMP%]{position:absolute;left:5px;top:34px;color:#09b8c2}.female[_ngcontent-%COMP%]{top:8px!important}"]})};export{Ze as BookStaff};
