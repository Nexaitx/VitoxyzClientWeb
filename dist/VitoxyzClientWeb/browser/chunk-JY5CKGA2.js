import{a as Re,b as $,c as F,d as Be}from"./chunk-CUKBT6TN.js";import{b as ye}from"./chunk-3Q2QTAPQ.js";import{A as Te,B as Fe,C as Pe,D as Ve,c as H,d as C,g as U,h as ve,i as be,k as Me,l as Ce,m as ze,o as ke,p as we,q as xe,r as Ie,s as Se,t as De,u as Ee,v as Oe,w as Le,y as Ae}from"./chunk-7AGTBIMS.js";import{Bb as de,Bc as W,Cb as Y,Db as J,Fc as _e,Ga as d,Gc as fe,Jb as O,Ka as re,Lb as u,Mb as ce,Nb as D,Pb as X,Qb as ee,Ra as E,Rb as te,Sa as ae,Tb as T,Va as z,Wb as ge,Xa as G,Yb as Q,Z as ne,Zb as j,a as A,b as R,ba as B,eb as b,fa as h,fb as M,ga as _,jb as p,kb as s,lb as o,mb as f,nb as oe,ob as se,qb as Z,rb as N,tb as k,vb as y,vc as ue,wb as le,wc as pe,xb as c,xc as me,zc as he}from"./chunk-QCHIWLHT.js";var Ge=(()=>{class a{static \u0275fac=function(r){return new(r||a)};static \u0275mod=ae({type:a});static \u0275inj=ne({})}return a})();var je=["mapElement"],q=class a{mapElement;locationSelected=new G;userLat=28.6139;userLng=77.209;map;ngOnInit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{this.userLat=i.coords.latitude,this.userLng=i.coords.longitude,this.initMap()},i=>{console.error("Geolocation error:",i),this.initMap()}):(console.warn("Geolocation not supported"),this.initMap())}ngAfterViewInit(){navigator.geolocation||this.initMap()}initMap(){if(typeof google>"u"||!google.maps){console.error("Google Maps API not loaded");return}this.map=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:this.userLat,lng:this.userLng},zoom:12}),new google.maps.Marker({map:this.map,position:{lat:this.userLat,lng:this.userLng},title:"You are here"}),this.map.addListener("click",i=>{let e=i.latLng.lat(),r=i.latLng.lng();this.locationSelected.emit({lat:e,lng:r})})}onMapClick(i){let e=i.latLng.lat(),r=i.latLng.lng();this.locationSelected.emit({lat:e,lng:r})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=E({type:a,selectors:[["app-map"]],viewQuery:function(e,r){if(e&1&&de(je,5),e&2){let t;Y(t=J())&&(r.mapElement=t.first)}},outputs:{locationSelected:"locationSelected"},decls:2,vars:0,consts:[["mapElement",""],[1,"map-container",3,"mapClick"]],template:function(e,r){if(e&1){let t=k();oe(0,"div",1,0),le("mapClick",function(l){return h(t),_(r.onMapClick(l))}),se()}},dependencies:[Ge],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:40vw;min-height:400px;margin-top:10px;position:relative!important;overflow:hidden!important}[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     #mapElement{width:100%;height:90%}"]})};var Ue=a=>({"is-invalid":a});function $e(a,i){if(a&1){let e=k();s(0,"button",5),y("click",function(){h(e);let t=c(2);return _(t.closePopup())}),o()}}function qe(a,i){if(a&1){let e=k();s(0,"div")(1,"input",6),te("ngModelChange",function(t){h(e);let n=c(2);return ee(n.aadharNumber,t)||(n.aadharNumber=t),_(t)}),o(),s(2,"button",7),y("click",function(){h(e);let t=c(2);return _(t.sendOtp())}),u(3,"Send OTP"),o()()}if(a&2){let e=c(2);d(),X("ngModel",e.aadharNumber)}}function Ke(a,i){a&1&&(s(0,"div",11),u(1,"Invalid OTP. Please try again."),o())}function Ye(a,i){if(a&1){let e=k();s(0,"div")(1,"input",8),te("ngModelChange",function(t){h(e);let n=c(2);return ee(n.otp,t)||(n.otp=t),_(t)}),y("input",function(){h(e);let t=c(2);return _(t.otpError=!1)}),o(),s(2,"button",9),y("click",function(){h(e);let t=c(2);return _(t.verifyOtp())}),u(3,"Verify OTP"),o(),z(4,Ke,2,0,"div",10),o()}if(a&2){let e=c(2);d(),p("ngClass",ge(3,Ue,e.otpError)),X("ngModel",e.otp),d(3),p("ngIf",e.otpError)}}function Je(a,i){if(a&1&&(s(0,"div",1),z(1,$e,1,0,"button",2),s(2,"h5",3),u(3,"Aadhar Verification"),o(),z(4,qe,4,1,"div",4)(5,Ye,5,5,"div",4),o()),a&2){let e=c();d(),p("ngIf",e.step==="input"),d(3),p("ngIf",e.step==="input"),d(),p("ngIf",e.step==="otp")}}var K=class a{verified=new G;aadharNumber="";otp="";step="input";otpError=!1;isVisible=!0;generatedOtp="123456";sendOtp(){if(this.aadharNumber.length!==12||!/^\d{12}$/.test(this.aadharNumber)){alert("Please enter a valid 12-digit Aadhar number.");return}console.log("Sending OTP to:",this.aadharNumber),setTimeout(()=>{console.log("OTP sent successfully!"),this.step="otp"},500)}verifyOtp(){this.otp===this.generatedOtp?(console.log("OTP verified successfully!"),this.verified.emit(),this.closePopup()):this.otpError=!0}closePopup(){this.isVisible=!1}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=E({type:a,selectors:[["app-aadhar-verification"]],outputs:{verified:"verified"},decls:1,vars:1,consts:[["class","aadhar-toast-box",4,"ngIf"],[1,"aadhar-toast-box"],["class","btn-close top-right",3,"click",4,"ngIf"],[1,"text-center","mb-3"],[4,"ngIf"],[1,"btn-close","top-right",3,"click"],["type","text","placeholder","Enter your 12-digit Aadhar Number","maxlength","12",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","w-100",3,"click"],["type","text","placeholder","Enter 6-digit OTP","maxlength","6",1,"form-control","mb-2",3,"ngModelChange","input","ngClass","ngModel"],[1,"btn","btn-success","w-100",3,"click"],["class","text-danger text-center mt-1",4,"ngIf"],[1,"text-danger","text-center","mt-1"]],template:function(e,r){e&1&&z(0,Je,6,3,"div",0),e&2&&p("ngIf",r.isVisible)},dependencies:[W,ue,me,Pe,H,U,Ae,Me],styles:[".aadhar-toast-box[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:320px;background:#fff;border-radius:10px;box-shadow:0 5px 15px #00000040;z-index:1050;padding:20px;display:flex;flex-direction:column}.top-right[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px}"]})};function Xe(a,i){a&1&&(s(0,"div",13),u(1," Area is required. "),o())}function et(a,i){if(a&1&&(s(0,"div",17),f(1,"div",22),s(2,"span",23),u(3),o(),f(4,"div",22),o()),a&2){let e=c().index;d(3),ce(e)}}function tt(a,i){if(a&1){let e=k();s(0,"button",24),y("click",function(){h(e);let t=c().index,n=c();return _(n.removeStaff(t))}),f(1,"i",25),o()}}function it(a,i){if(a&1&&(s(0,"option",32),u(1),o()),a&2){let e=i.$implicit;p("value",e.name),d(),D(" ",e.name," ")}}function nt(a,i){a&1&&(s(0,"div",13),u(1," Type of Staff is required. "),o())}function rt(a,i){if(a&1&&(s(0,"option",32),u(1),o()),a&2){let e=i.$implicit;p("value",e.value),d(),D(" ",e.label," ")}}function at(a,i){if(a&1&&(s(0,"div",13),u(1),Q(2,"titlecase"),o()),a&2){let e,r=c(2).$implicit;d(),D(" Type of ",j(2,1,(e=r.get("typeOfStaff"))==null?null:e.value)," is required. ")}}function ot(a,i){if(a&1&&(Z(0),s(1,"div",33)(2,"label",28),u(3),Q(4,"titlecase"),o(),s(5,"select",34)(6,"option",30),u(7),Q(8,"titlecase"),o(),z(9,rt,2,2,"option",31),o(),b(10,at,3,3,"div",13),o(),N()),a&2){let e,r,t,n,l,g=c().$implicit,v=c().index,w=c();d(2),p("for",T("typeOfSubStaff-",v)),d(),D("Select ",j(4,11,(e=g.get("typeOfStaff"))==null?null:e.value)," Type"),d(2),O("is-invalid",((r=g.get("typeOfSubStaff"))==null?null:r.invalid)&&((r=g.get("typeOfSubStaff"))==null?null:r.touched)),p("id",T("typeOfSubStaff-",v))("disabled",!((t=g.get("typeOfStaff"))!=null&&t.value)),d(2),D("Select ",j(8,13,(n=g.get("typeOfStaff"))==null?null:n.value)," "),d(2),p("ngForOf",w.staffSubCategories[v]),d(),M((l=g.get("typeOfSubStaff"))!=null&&l.invalid&&((l=g.get("typeOfSubStaff"))!=null&&l.touched)?10:-1)}}function st(a,i){if(a&1&&(s(0,"div",26)(1,"div",1)(2,"div",27)(3,"label",28),u(4,"Select Staff Type"),o(),s(5,"select",29)(6,"option",30),u(7,"Select Type"),o(),z(8,it,2,2,"option",31),o(),b(9,nt,2,0,"div",13),o(),b(10,ot,11,15,"ng-container"),o()()),a&2){let e,r,t,n=i.$implicit,l=i.index,g=c().index,v=c();p("formGroupName",l),d(3),p("for",T("typeOfStaff-",g)),d(2),O("is-invalid",((e=n.get("typeOfStaff"))==null?null:e.invalid)&&((e=n.get("typeOfStaff"))==null?null:e.touched)),p("id",T("typeOfStaff-",g)),d(3),p("ngForOf",v.staffCategories),d(),M((r=n.get("typeOfStaff"))!=null&&r.invalid&&((r=n.get("typeOfStaff"))!=null&&r.touched)?9:-1),d(),M((t=n.get("typeOfStaff"))!=null&&t.value&&((t=n.get("typeOfStaff"))==null?null:t.value)!==""?10:-1)}}function lt(a,i){a&1&&(s(0,"div",52),u(1," Past time is not allowed. "),o())}function dt(a,i){if(a&1&&(s(0,"option",32),u(1),o()),a&2){let e=i.$implicit;p("value",e),d(),D(" ",e," ")}}function ct(a,i){a&1&&(s(0,"div",13),u(1," Shift Type is required. "),o())}function gt(a,i){a&1&&(s(0,"div",52),u(1," Quantity is required. "),o())}function ut(a,i){if(a&1&&(s(0,"option",32),u(1),o()),a&2){let e=i.$implicit;p("value",e.value),d(),D(" ",e.label," ")}}function pt(a,i){a&1&&(s(0,"div",13),u(1," Tenure is required. "),o())}function mt(a,i){if(a&1){let e=k();s(0,"i",66),y("click",function(){h(e);let t=c(3).index,n=c();return _(n.addShift(t))}),o()}}function ht(a,i){if(a&1){let e=k();s(0,"i",67),y("click",function(){h(e);let t=c().index,n=c(2).index,l=c();return _(l.removeShiftDetail(n,t))}),o()}}function _t(a,i){if(a&1){let e=k();s(0,"div",37)(1,"div",38)(2,"div",39)(3,"label",11),u(4,"Duty Start Time"),o(),s(5,"div",40)(6,"div",41)(7,"button",42),y("click",function(){let t=h(e).index,n=c(2).index,l=c();return _(l.decrementTime("hours",n,t))}),f(8,"i",43),o(),f(9,"input",44),s(10,"button",45),y("click",function(){let t=h(e).index,n=c(2).index,l=c();return _(l.incrementTime("hours",n,t))}),f(11,"i",46),o()(),s(12,"div",47)(13,"button",42),y("click",function(){let t=h(e).index,n=c(2).index,l=c();return _(l.decrementTime("minutes",n,t))}),f(14,"i",43),o(),f(15,"input",48),s(16,"button",45),y("click",function(){let t=h(e).index,n=c(2).index,l=c();return _(l.incrementTime("minutes",n,t))}),f(17,"i",46),o()(),s(18,"select",49)(19,"option",50),u(20,"AM"),o(),s(21,"option",51),u(22,"PM"),o()()(),b(23,lt,2,0,"div",52),o(),s(24,"div",53)(25,"label",11),u(26,"Shift Time"),o(),s(27,"select",54)(28,"option",30),u(29,"Select Time"),o(),z(30,dt,2,2,"option",31),o(),b(31,ct,2,0,"div",13),o(),s(32,"div",53)(33,"label",55),u(34,"Prefered Gender"),o(),f(35,"input",56)(36,"input",57),b(37,gt,2,0,"div",52),o(),s(38,"div",53)(39,"label",11),u(40,"Quantity"),o(),s(41,"div",58)(42,"button",42),y("click",function(){let t=h(e).index,n=c(2).index,l=c();return _(l.decrease("maleQuantity",n,t))}),f(43,"i",43),o(),f(44,"input",59),s(45,"button",45),y("click",function(){let t=h(e).index,n=c(2).index,l=c();return _(l.increase("maleQuantity",n,t))}),f(46,"i",46),o()(),s(47,"div",60)(48,"button",42),y("click",function(){let t=h(e).index,n=c(2).index,l=c();return _(l.decrease("femaleQuantity",n,t))}),f(49,"i",43),o(),f(50,"input",59),s(51,"button",45),y("click",function(){let t=h(e).index,n=c(2).index,l=c();return _(l.increase("femaleQuantity",n,t))}),f(52,"i",46),o()()(),s(53,"div",53)(54,"label",11),u(55,"Tenure"),o(),s(56,"select",61),z(57,ut,2,2,"option",31),o(),b(58,pt,2,0,"div",13),o(),s(59,"div",10)(60,"label",11),u(61,"Duty Start Date"),o(),f(62,"input",62),o(),s(63,"div",63),b(64,mt,1,0,"i",64),b(65,ht,1,0,"i",65),o()()()}if(a&2){let e,r,t,n,l,g,v,w,m=i.$implicit,S=i.index,L=c(2).index,x=c();p("formGroupName",S),d(5),O("is-invalid",((e=m.get("timeSlot"))==null||e.errors==null?null:e.errors.pastTime)&&((e=m.get("timeSlot"))==null?null:e.touched)),d(4),p("value",x.pad((r=m.get("hours"))==null?null:r.value)),d(6),p("value",x.pad((t=m.get("minutes"))==null?null:t.value)),d(8),M(!((n=m.get("timeSlot"))==null||n.errors==null)&&n.errors.pastTime&&((n=m.get("timeSlot"))!=null&&n.touched)?23:-1),d(4),O("is-invalid",((l=m.get("shiftType"))==null?null:l.invalid)&&((l=m.get("shiftType"))==null?null:l.touched)),d(3),p("ngForOf",x.shiftTypes),d(),M((g=m.get("shiftType"))!=null&&g.invalid&&((g=m.get("shiftType"))!=null&&g.touched)?31:-1),d(6),M(m.errors!=null&&m.errors.zeroQuantity&&(m.touched||m.dirty)?37:-1),d(7),p("formControlName","maleQuantity"),d(6),p("formControlName","femaleQuantity"),d(6),O("is-invalid",((v=m.get("tenure"))==null?null:v.invalid)&&((v=m.get("tenure"))==null?null:v.touched)),d(),p("ngForOf",x.tenure),d(),M((w=m.get("tenure"))!=null&&w.invalid&&((w=m.get("tenure"))!=null&&w.touched)?58:-1),d(4),p("min",x.today),d(2),M(S===0?64:-1),d(),M(x.getNestedShiftDetailsControls(L).length>1&&S>0?65:-1)}}function ft(a,i){if(a&1&&(Z(0),s(1,"div",35),z(2,_t,66,20,"div",36),o(),N()),a&2){let e=c().index,r=c();d(2),p("ngForOf",r.getNestedShiftDetailsControls(e))}}function yt(a,i){if(a&1&&(s(0,"div",16),b(1,et,5,1,"div",17),s(2,"div",18),b(3,tt,2,0,"button",19),o(),s(4,"div",20),z(5,st,11,10,"div",21),o(),b(6,ft,3,1,"ng-container"),o()),a&2){let e,r=i.index,t=c();p("formGroupName",r),d(),M(r>0?1:-1),d(2),M(r!==0?3:-1),d(2),p("ngForOf",t.getNestedStaffDetailsControls(r)),d(),M((e=t.getNestedStaffDetailsControls(r)[0].get("typeOfStaff"))!=null&&e.value?6:-1)}}function vt(a,i){if(a&1){let e=k();Z(0),s(1,"div",68)(2,"button",69),y("click",function(){h(e);let t=c();return _(t.addNewStaff())}),f(3,"i",46),u(4,"Add Another Staff "),o()(),s(5,"div",70),f(6,"app-submission",71),o(),N()}if(a&2){let e=c();d(6),p("buttonType",e.button)}}function bt(a,i){if(a&1){let e=k();s(0,"app-aadhar-verification",72),y("verified",function(){h(e);let t=c();return _(t.onAadharVerified())}),o()}}var Ne=class a{constructor(i){this.spinnerService=i}fb=B(Fe);http=B(fe);router=B(ye);staffBookingForm;hours=Array.from({length:24},(i,e)=>e);minutes=[0,15,30,45];nurseTenure=["1 Day","15 Days","Monthly","Quarterly","Half Yearly","Yearly"];button="Search for staff";staffCategories=[];staffSubCategories={};shiftTypes=["2 Hours Max","8 Hours","12 Hours","24 Hours"];tenure=[{label:"1 Day",value:"1"},{label:"3 Days",value:"2"},{label:"1 Week",value:"3"},{label:"2 Weeks",value:"4"},{label:"1 Month",value:"5"}];today=new Date().toISOString().split("T")[0];isToken=localStorage.getItem("authToken");isLogin=!1;showAadharPopup=!1;staffSearchResponse=null;ngOnInit(){this.getUserLocation(),this.getStaffCategories(),this.staffBookingForm=this.fb.group({userAddress:["",C.required],latitude:[],longitude:[],staffForms:this.fb.array([this.createStaffFormGroup()])}),this.subscribeToCategoryChange(0)}getStaffCategories(){let i=$+F.CATEGORIES;this.http.get(i).subscribe({next:e=>{this.staffCategories=e||[]},error:e=>{console.error("Error fetching categories:",e)}})}subscribeToCategoryChange(i){let t=this.staffListFormArray.at(i).get("staffDetails").at(0);t.get("typeOfStaff")?.valueChanges.subscribe(n=>{let l=this.staffCategories.find(g=>g.name===n);if(l){let g=l.id;this.fetchSubCategories(g,i),t.get("typeOfSubStaff")?.setValue("")}})}incrementTime(i,e,r){let t=this.getShiftGroup(e,r);if(t)if(i==="hours"){let n=+t.get("hours")?.value||1;n=n%12+1,n===0&&(n=12),t.get("hours")?.setValue(n)}else{let n=+t.get("minutes")?.value||0;n=(n+1)%60,t.get("minutes")?.setValue(n)}}decrementTime(i,e,r){let t=this.getShiftGroup(e,r);if(t)if(i==="hours"){let n=+t.get("hours")?.value||1;n=(n-1+12)%12,n===0&&(n=12),t.get("hours")?.setValue(this.pad(n))}else{let n=+t.get("minutes")?.value||0;n=(n-1+60)%60,t.get("minutes")?.setValue(this.pad(n))}}getShiftGroup(i,e){return this.staffListFormArray.at(i).get("shiftDetails").at(e)}pad(i){return i!=null?i.toString().padStart(2,"0"):"00"}increase(i,e,r){let t=this.getQuantityControl(i,e,r);t.setValue(Math.min((t.value||0)+1,10)),this.updateGenderInShift(e,r)}decrease(i,e,r){let t=this.getQuantityControl(i,e,r);t.setValue(Math.max((t.value||1)-1,0)),this.updateGenderInShift(e,r)}updateGenderInShift(i,e){let r=this.getShiftGroup(i,e);r&&this.updateGenderQty(r)}getQuantityControl(i,e,r){return this.staffListFormArray.at(e).get("shiftDetails").at(r).get(i==="maleQuantity"?"maleQuantity":"femaleQuantity")}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{let e=i.coords.latitude,r=i.coords.longitude;this.getAddressFromCoords(e,r)},i=>{console.error("Geolocation failed:",i)}):console.error("Geolocation not supported by this browser.")}getAddressFromCoords(i,e){this.staffBookingForm.patchValue({latitude:i,longitude:e});let r=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${i}&lon=${e}`;this.http.get(r).subscribe(t=>{let n=t.display_name;n&&this.staffBookingForm.patchValue({userAddress:n})},t=>{console.error("Error fetching address:",t)})}createStaffDetailFormGroup(){return this.fb.group({typeOfStaff:["",C.required],typeOfSubStaff:["",C.required]})}fetchSubCategories(i,e){let r=`${$}${F.CATEGORIES}/${i}${F.SUB_CATEGORIES}`;this.http.get(r).subscribe({next:t=>{this.staffSubCategories[e]=t},error:t=>{console.error("Failed to fetch subcategories",t),this.staffSubCategories[e]=[]}})}get staffDetailsFormArray(){return this.staffBookingForm.get("staffDetails")}createShiftDetailFormGroup(){let e=new Date().getHours(),r="00",t=e>=12?"PM":"AM";e===0?e=12:e>12&&(e-=12);let n=this.fb.group({shiftType:["",C.required],timeSlot:[""],tenure:["1"],dutyStartDate:[new Date().toISOString().substring(0,10)],maleQuantity:["0",[C.min(0),C.max(10)]],femaleQuantity:["0",[C.min(0),C.max(10)]],hours:[e,[C.required,C.min(1),C.max(12)]],minutes:[r,[C.required,C.min(0),C.max(59)]],ampm:[t,C.required]},{validators:[this.shiftDurationValidator]});return n.get("hours")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("minutes")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("ampm")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("maleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(n)),n.get("femaleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(n)),n.get("dutyStartDate")?.valueChanges.subscribe(l=>{if(!l){let g=new Date().toISOString().substring(0,10);n.get("dutyStartDate")?.setValue(g,{emitEvent:!1})}}),n}updateTimeSlot(i){let e=i.get("hours")?.value??0,r=i.get("minutes")?.value??0,t=i.get("ampm")?.value??"AM",n=v=>v.toString().padStart(2,"0"),l=`${n(+e)}:${n(+r)} ${t}`,g=i.get("timeSlot");g?.setValue(l,{emitEvent:!1}),g?.markAsTouched(),g?.markAsDirty()}updateGenderQty(i){let e=Number(i.get("maleQuantity")?.value||0),r=Number(i.get("femaleQuantity")?.value||0);i.get("maleQuantity")?.setValue(e),i.get("gender")?.setValue(r)}get shiftDetailsFormArray(){return this.staffBookingForm.get("shiftDetails")}createStaffFormGroup(){return this.fb.group({staffDetails:this.fb.array([this.createStaffDetailFormGroup()]),shiftDetails:this.fb.array([this.createShiftDetailFormGroup()])})}addShift(i){this.staffListFormArray.at(i).get("shiftDetails").push(this.createShiftDetailFormGroup())}removeShiftDetail(i,e){this.staffListFormArray.at(i).get("shiftDetails").removeAt(e)}addNewStaff(){this.staffListFormArray.push(this.createStaffFormGroup());let i=this.staffListFormArray.length-1;this.subscribeToCategoryChange(i)}get staffListFormArray(){return this.staffBookingForm.get("staffForms")}getNestedShiftDetailsControls(i){return this.staffListFormArray.at(i).get("shiftDetails").controls}getNestedStaffDetailsControls(i){return this.staffListFormArray.at(i).get("staffDetails").controls}removeStaff(i){this.staffListFormArray.removeAt(i)}onSubmit(){let i=this.hasPastTimeError(),e=this.hasZeroQuantityError();if(this.staffBookingForm.valid&&!i&&!e){this.spinnerService.show();let r=$+F.BOOK_STAFF,t=R(A({},this.staffBookingForm.value),{staffForms:this.staffListFormArray.controls.map(l=>{let g=l.get("staffDetails").at(0),{typeOfStaff:v,typeOfSubStaff:w}=g.value,m=l.get("shiftDetails").controls.map(S=>{let{shiftType:L,timeSlot:x,tenure:I,maleQuantity:P,femaleQuantity:V,dutyStartDate:Qe}=S.value;return{shiftType:L,timeSlot:x,tenure:I,maleQuantity:P,femaleQuantity:V,dutyStartDate:Qe}});return{typeOfStaff:v,typeOfSubStaff:w,shifts:m}})}),n=new _e({"Content-Type":"application/json"});this.isToken&&(n=n.set("Authorization",`Bearer ${this.isToken}`)),this.http.post(r,t,{headers:n}).subscribe({next:l=>{this.spinnerService.hide();let g=l?.staff[0]?.staffDetails||[];g.length>0?this.isLogin?this.router.navigate(["/view-staff"],{state:{staffDetails:g}}):(this.staffSearchResponse=g,this.showAadharPopup=!0):alert("No staff found.")},error:l=>{console.error("Staff search failed:",l),this.spinnerService.hide()}})}else this.markAllAsTouched(this.staffBookingForm)}hasPastTimeError(){let i=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(t=>{let n=t.get("dutyStartDate")?.value,l=+t.get("hours")?.value,g=+t.get("minutes")?.value,v=t.get("ampm")?.value;if(!n||l==null||g==null||!v)return;let w=new Date(n),m=new Date,S=I=>I.toString().padStart(2,"0"),L=`${S(l)}:${S(g)} ${v}`;if(t.get("timeSlot")?.setValue(L,{emitEvent:!1}),w.getFullYear()===m.getFullYear()&&w.getMonth()===m.getMonth()&&w.getDate()===m.getDate()){let I=l;v==="PM"&&I!==12&&(I+=12),v==="AM"&&I===12&&(I=0);let P=new Date;if(P.setHours(I,g,0,0),P<m)t.get("timeSlot")?.setErrors({pastTime:!0}),i=!0;else{let V=t.get("timeSlot");V?.hasError("pastTime")&&V.setErrors(null)}}})}),i}hasZeroQuantityError(){let i=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(t=>{let n=+t.get("maleQuantity")?.value||0,l=+t.get("femaleQuantity")?.value||0;if(n===0&&l===0)t.setErrors(R(A({},t.errors||{}),{zeroQuantity:!0})),i=!0;else if(t.errors?.zeroQuantity){let g=A({},t.errors);delete g.zeroQuantity,t.setErrors(Object.keys(g).length?g:null)}})}),i}markAllAsTouched(i){Object.values(i.controls).forEach(e=>{e.markAsTouched(),(e instanceof be||e instanceof Te)&&this.markAllAsTouched(e)})}onAadharVerified(){this.isLogin=!0,this.showAadharPopup=!1,this.staffSearchResponse&&(this.router.navigate(["/view-staff"],{state:{staffDetails:this.staffSearchResponse}}),this.staffSearchResponse=null)}shiftDurationValidator(i){let e=parseInt(i.get("shiftHour")?.value,10),r=parseInt(i.get("shiftMinute")?.value,10);if(isNaN(e)||isNaN(r))return null;let t=e*60+r,n=(t+8*60)%(24*60);return t>=0&&n>=0?null:{invalidShiftDuration:!0}}static \u0275fac=function(e){return new(e||a)(re(Be))};static \u0275cmp=E({type:a,selectors:[["app-book-staff"]],decls:20,vars:7,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-4","h-100"],[3,"locationSelected"],[1,"col-md-8","search-staff-form"],[1,"form-scroll-container"],[1,"form-content"],[1,"form-title"],[3,"ngSubmit","formGroup"],[1,"row","my-3"],[1,"col-md-12"],[1,"form-label"],["type","text","formControlName","userAddress",1,"form-control"],[1,"invalid-feedback"],["formArrayName","staffForms",1,"staff-list"],["class","pe-2",3,"formGroupName",4,"ngFor","ngForOf"],[1,"pe-2",3,"formGroupName"],[1,"indexed-divider-container"],[1,"col-md-12","d-flex","justify-content-end"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px"],["formArrayName","staffDetails"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"line"],[1,"index-number"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px",3,"click"],[1,"bi","bi-trash","fs-5"],[3,"formGroupName"],[1,"col-md-12","mb-2"],[1,"form-label",3,"for"],["formControlName","typeOfStaff",1,"form-select",3,"id"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"col-md-12","my-3"],["formControlName","typeOfSubStaff",1,"form-select",3,"id","disabled"],["formArrayName","shiftDetails"],["class","shift-detail",3,"formGroupName",4,"ngFor","ngForOf"],[1,"shift-detail",3,"formGroupName"],[1,"row","d-flex"],[1,"col-md-4"],[1,"d-flex","gap-3","align-items-center"],[1,"input-group","input-group-time","d-flex","align-items-center"],["type","button",1,"btn","btn-minus","px-0",3,"click"],[1,"bi","bi-dash"],["type","number","formControlName","hours","value","09","min","0","max","12","readonly","",1,"form-control","px-0",3,"value"],["type","button",1,"btn","btn-plus","px-0",3,"click"],[1,"bi","bi-plus"],[1,"input-group","input-group-time","align-items-center","d-flex"],["type","number","formControlName","minutes","value","00","min","0","max","59","readonly","",1,"form-control","px-0",3,"value"],["formControlName","ampm",1,"form-select","time-select"],["value","AM"],["value","PM"],[1,"text-danger"],[1,"col-md-2"],["formControlName","shiftType",1,"form-select"],[1,"form-label","d-block"],["type","text","readonly","","value","Male",1,"form-control"],["type","text","readonly","","value","Female",1,"form-control","mt-2"],[1,"d-flex","align-items-center","mb-2","counter-box"],["type","number","min","0","max","10","readonly","","readonly","",1,"form-control",3,"formControlName"],[1,"d-flex","align-items-center","counter-box"],["formControlName","tenure",1,"form-select"],["type","date","formControlName","dutyStartDate",1,"form-control",3,"min"],[1,"d-flex","align-items-start","justify-content-end","gap-2","mt-3"],["title","Add Time Slot",1,"bi","bi-plus-lg","fs-5","add"],["title","Remove Time Slot",1,"bi","bi-x-lg","fs-5","text-danger","remove"],["title","Add Time Slot",1,"bi","bi-plus-lg","fs-5","add",3,"click"],["title","Remove Time Slot",1,"bi","bi-x-lg","fs-5","text-danger","remove",3,"click"],[1,"d-flex","justify-content-center","addNewBtn","p-2","my-2"],["type","button",1,"text-btn",3,"click"],[1,"submission-fixed","d-flex","justify-content-end"],[3,"buttonType"],[3,"verified"]],template:function(e,r){if(e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-map",3),y("locationSelected",function(n){return r.getAddressFromCoords(n.lat,n.lng)}),o()(),s(4,"div",4)(5,"div",5)(6,"div",6)(7,"h2",7),u(8,"Please fill the form"),o(),s(9,"form",8),y("ngSubmit",function(){return r.onSubmit()}),s(10,"div",9)(11,"div",10)(12,"label",11),u(13,"Select your area"),o(),f(14,"input",12),b(15,Xe,2,0,"div",13),o()(),s(16,"div",14),z(17,yt,7,5,"div",15),o(),b(18,vt,7,1,"ng-container"),o()()()()()(),b(19,bt,1,0,"app-aadhar-verification")),e&2){let t,n,l;d(9),p("formGroup",r.staffBookingForm),d(5),O("is-invalid",((t=r.staffBookingForm.get("userAddress"))==null?null:t.invalid)&&((t=r.staffBookingForm.get("userAddress"))==null?null:t.touched)),d(),M((n=r.staffBookingForm.get("userAddress"))!=null&&n.invalid&&((n=r.staffBookingForm.get("userAddress"))!=null&&n.touched)?15:-1),d(2),p("ngForOf",r.staffListFormArray.controls),d(),M(!((l=r.staffListFormArray.controls[0].get("staffDetails"))==null||(l=l.get("0"))==null||(l=l.get("typeOfStaff"))==null)&&l.value?18:-1),d(),M(r.showAadharPopup?19:-1)}},dependencies:[W,pe,Ve,Ce,De,Ee,H,ze,Se,U,ve,Le,Oe,ke,Ie,we,xe,q,Re,K,he],styles:[".form-scroll-container[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;height:100%;position:relative;padding:15px;box-sizing:border-box}.submission-fixed[_ngcontent-%COMP%]{bottom:0;width:100%;background-color:#fff;padding:10px 0;z-index:10;box-sizing:border-box}.time-selector-container[_ngcontent-%COMP%]{background-color:#fff;padding:30px;border-radius:15px;box-shadow:0 4px 15px #0000001a}.input-group-time[_ngcontent-%COMP%]{border-radius:10px;overflow:hidden;border:1px solid #ced4da}.input-group-time[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{text-align:center;border:none;padding:.5rem .75rem}.input-group-time[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center;border:none;background-color:transparent;color:#495057;font-size:1.2rem;transition:background-color .2s,color .2s}.input-group-time[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.input-group-time[_ngcontent-%COMP%]   .btn-minus[_ngcontent-%COMP%]{color:#df3745}.input-group-time[_ngcontent-%COMP%]   .btn-plus[_ngcontent-%COMP%]{color:#09b8c2}.time-select[_ngcontent-%COMP%]{width:120px;border-radius:10px;border:1px solid #ced4da;background-color:#f0f2f5}.time-select[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 .25rem #0d6efd40;border-color:#86b7fe}input[type=number][_ngcontent-%COMP%]::-webkit-outer-spin-button, input[type=number][_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{-moz-appearance:textfield}.staff-list[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:scroll;height:45vh}.staff-list[_ngcontent-%COMP%]:hover{overflow-y:auto}.staff-list[_ngcontent-%COMP%]:focus-within{overflow-y:auto}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:3px;height:8px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#09b8c2;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#fff}.indexed-divider-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin:20px 0;color:#6c757d;font-weight:700;font-size:.9rem}.line[_ngcontent-%COMP%]{flex-grow:1;height:1px;background-color:#dee2e6}.index-number[_ngcontent-%COMP%]{color:#09b8c2;padding:5px 12px;background-color:#e0fcff;border-radius:50%;min-width:25px;text-align:center;box-shadow:0 1px 3px #0000000d}.search-staff-form[_ngcontent-%COMP%]{height:90vh;overflow:hidden}"]})};export{Ne as BookStaff};
