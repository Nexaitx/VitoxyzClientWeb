import{a as le}from"./chunk-AGTFDDLE.js";import"./chunk-2FIYSNYS.js";import"./chunk-RXPDFXEY.js";import{a as oe}from"./chunk-5TBLFU7I.js";import"./chunk-GA6KQOR5.js";import{F as J,G as y,J as X,K as ee,O as te,R as ne,U as ie,ba as ae,da as re}from"./chunk-OHQSNZA5.js";import{a as k,b as P}from"./chunk-TNRG4YRG.js";import{c as Z}from"./chunk-UF26DDQM.js";import{g as U,h as q,i as H,n as Y,q as Q,w as C,y as W}from"./chunk-HSQUREWB.js";import{Ab as g,Gc as $,Hc as j,Ic as G,Lc as M,Pb as c,Qb as i,Rb as a,Sb as f,Wb as w,Xb as I,Yc as K,Zb as F,bb as z,ca as A,cc as v,e as R,eb as s,ec as S,ga as B,na as b,oa as _,oc as T,pb as h,q as V,sc as l,tc as x,uc as N,vb as L,vc as D}from"./chunk-36LOJXOE.js";var O=class o{constructor(t){this.http=t}getBookingResponse(){let t=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),e=new C({Authorization:`Bearer ${t}`});return this.http.get(`${k}${P.BOOKING_RESPONSE}`,{headers:e})}removeStaffFromBooking(t){let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),n=new C({Authorization:`Bearer ${e}`});return this.http.delete(`${k}${P.REMOVE_STAFF.replace("{bookingId}",t)}`,{headers:n})}addIndividualStaff(t){let e=localStorage.getItem("authToken")||sessionStorage.getItem("authToken");if(!e)return V(()=>new Error("No auth token found"));let n=new C({"Content-Type":"application/json",Authorization:`Bearer ${e}`});return this.http.post(`${k}${P.BOOK_SINGLE_STAFF}`,t,{headers:n})}static \u0275fac=function(e){return new(e||o)(B(W))};static \u0275prov=A({token:o,factory:o.\u0275fac,providedIn:"root"})};var ce=(o,t,e)=>({"bi-star-fill text-warning":o,"bi-star-half text-warning":t,"bi-star text-warning":e});function fe(o,t){o&1&&(i(0,"div",25)(1,"div",26),f(2,"div",27),i(3,"div",28),l(4,"wait for accepted staff"),a()()())}function pe(o,t){if(o&1&&(w(0),f(1,"i",53),I()),o&2){let e=t.$implicit;s(),c("ngClass",$(1,ce,e==="full",e==="half",e==="empty"))}}function ge(o,t){if(o&1){let e=F();i(0,"div",36)(1,"div",37)(2,"div",38)(3,"div",39)(4,"div",40),f(5,"img",41),a()(),i(6,"div",42)(7,"div",43)(8,"h6",44)(9,"span"),l(10),a()(),i(11,"p",45),l(12),a(),i(13,"p",46),g(14,pe,2,5,"ng-container",47),i(15,"span",48),l(16),a()(),i(17,"p",45),l(18),a(),i(19,"p",46),l(20," \u{1F4DE} "),i(21,"strong"),l(22),a()(),i(23,"p",45),l(24," Start: "),i(25,"strong"),l(26),a()(),i(27,"p",45),l(28," End: "),i(29,"strong"),l(30),a()(),i(31,"div",49)(32,"button",50),v("click",function(){let r=b(e).$implicit,d=S(4);return _(d.selectedStaff=r)}),f(33,"i",51),a(),i(34,"button",52),v("click",function(){let r=b(e).$implicit,d=S(4);return _(d.selectedStaff=r)}),f(35,"i",10),a()()()()()()()}if(o&2){let e=t.$implicit,n=S(4);s(5),c("src",e.imageUrl||((e.gender==null?null:e.gender.toLowerCase())==="female","/assets/profile.avif"),z),s(5),x(e.name),s(2),D(" ",e.experience," Years Experience | ",e.duties," Duties "),s(2),c("ngForOf",n.getStars(e.rating)),s(2),N("",e.rating,"/5"),s(2),N("\u20B9",e.price),s(4),x(e.staffPhone),s(4),x(e.startDate),s(4),x(e.endDate),s(2),c("disabled",e.isBooked)}}function ue(o,t){if(o&1&&(i(0,"div",33)(1,"div",34),l(2),j(3,"titlecase"),a(),g(4,ge,36,11,"div",35),a()),o&2){let e=t.$implicit;s(2),D(" ",G(3,3,e.category)," (",(e.availableStaff==null?null:e.availableStaff.length)||0,") "),s(2),c("ngForOf",e.availableStaff)}}function be(o,t){if(o&1&&(w(0),g(1,ue,5,5,"div",29),i(2,"footer",30)(3,"div",31)(4,"button",32),l(5,"Proceed to Booking (1212)"),a()()(),I()),o&2){let e=S(2);s(),c("ngForOf",e.staffDetails)}}function _e(o,t){if(o&1&&(w(0),g(1,be,6,1,"ng-container",3),I()),o&2){let e=S(),n=T(5);s(),c("ngIf",e.staffDetails.length>0)("ngIfElse",n)}}function ve(o,t){o&1&&(i(0,"div",54)(1,"h2"),l(2,"No staff found."),a()())}function Se(o,t){o&1&&(i(0,"div",55),l(1," Billing Address is required (min 5 chars). "),a())}function ye(o,t){o&1&&(i(0,"div",55),l(1," Valid Name is required (alphabets only). "),a())}function he(o,t){o&1&&(i(0,"div",55),l(1," Enter valid GST Number (15 characters). "),a())}var se=class o{constructor(t,e,n,r){this.fb=t;this.router=e;this.bookingResponseService=n;this.cd=r}staffDetails=[];selectedStaff;billingForm;loading=!0;razorpayKeyId="rzp_test_RARA6BGk8D2Y2o";isPaymentLoading=!1;ngOnInit(){this.billingForm=this.fb.group({billingAddress:["",[y.required,y.minLength(5)]],billingName:["",[y.required,y.pattern(/^[a-zA-Z ]+$/)]],gstNumber:["",[y.required]]}),this.fetchBookingResponses()}fetchBookingResponses(){let e=Date.now();this.loading=!0,this.cd.detectChanges(),this.bookingResponseService.getBookingResponse().subscribe({next:n=>{console.log("RAW API RESPONSE :",n);let r=n??[],d={};r.forEach(m=>{let E=m.category||"Others";d[E]||(d[E]={category:E,availableStaff:[]}),d[E].availableStaff.push({id:m.staffId,name:m.staffName,phone:m.staffPhone,staffPhone:m.staffPhone,startDate:m.startDate,endDate:m.endDate,category:m.category,subCategory:m.subCategory,rating:m.rating||0,duties:m.duties||0,price:m.price||0,gender:m.gender,experience:m.experience||0,tenure:m.tenure,imageUrl:m.imageUrl||null})}),this.staffDetails=Object.values(d),console.log("FINAL FORMATTED STAFF:",this.staffDetails);let p=Date.now()-e,u=Math.max(0,2e3-p);setTimeout(()=>this.loading=!1,u)},error:n=>{console.error("Error fetching booking responses",n);let r=Date.now()-e,d=Math.max(0,2e3-r);setTimeout(()=>this.loading=!1,d)}})}getStars(t){let e=[];for(let n=0;n<5;n++){let r=n+1;t>=r?e.push("full"):t>r-1&&t<r?e.push("half"):e.push("empty")}return e}removeStaff(t){if(!t.id){console.error("No ID found for staff:",t);return}this.bookingResponseService.removeStaffFromBooking(t.id).subscribe({next:()=>{this.staffDetails.forEach(e=>{e.availableStaff=e.availableStaff.filter(n=>n.id!==t.id)})},error:e=>{console.error("Error removing staff:",e)}})}addSpecificStaff(t){if(!(localStorage.getItem("authToken")||sessionStorage.getItem("authToken"))){alert("Please login or signup first to access book staff page"),this.router.navigate(["/login"]);return}let n={staffForms:[{typeOfStaff:t.typeOfStaff||t.category,typeOfSubStaff:t.typeOfSubStaff,shifts:[{timeSlot:t.timeSlot,shiftType:t.shiftType||"Day",maleQuantity:t.gender?.toLowerCase()==="male"?1:0,femaleQuantity:t.gender?.toLowerCase()==="female"?1:0,tenure:t.tenure,dutyStartDate:String(t.dutyStartDate||new Date().toISOString().split("T")[0])}]}]};this.bookingResponseService.addIndividualStaff(n).subscribe({next:()=>{alert(`${t.name} has been added to your booking!`),t.isBooked=!0},error:r=>{console.error("Error adding staff:",r),alert("Failed to add staff. Please try again.")}})}onProceedToPayment(t,e,n){return R(this,null,function*(){try{if(!this.razorpayKeyId){alert("Razorpay Key ID is missing. Please add it in the component.");return}let r=this.getPayableAmount();if(!(r>0)){alert("Invalid amount.");return}this.isPaymentLoading=!0,yield this.loadRazorpaySdk();let d={key:this.razorpayKeyId,amount:Math.round(r*100),currency:"INR",name:"Your Company Name",description:"Booking Payment",prefill:{name:t||"",email:"",contact:""},notes:{billing_address:e||"",gst_number:n||""},theme:{color:"#0d6efd"},modal:{ondismiss:()=>console.log("Razorpay Checkout closed.")},handler:u=>{this.onPaymentSuccess(u,r)}},p=new Razorpay(d);p.on("payment.failed",u=>this.onPaymentFailed(u)),p.open()}catch(r){console.error("Payment init error:",r),alert("Unable to start payment. Please try again.")}finally{this.isPaymentLoading=!1}})}onPaymentSuccess(t,e){console.log("Payment success:",t),this.router.navigate(["/medicines"])}onPaymentFailed(t){console.error("Payment failed:",t);let e=t?.error?.description||"Payment failed. Please try again.";alert(e)}loadRazorpaySdk(){return new Promise((t,e)=>{if(typeof Razorpay<"u"){t();return}let n=document.getElementById("razorpay-checkout-js");if(n){n.addEventListener("load",()=>t()),n.addEventListener("error",()=>e(new Error("Failed to load Razorpay SDK.")));return}let r=document.createElement("script");r.id="razorpay-checkout-js",r.src="https://checkout.razorpay.com/v1/checkout.js",r.async=!0,r.onload=()=>t(),r.onerror=()=>e(new Error("Failed to load Razorpay SDK.")),document.body.appendChild(r)})}getPayableAmount(){return 1212}centerContent(){let t=document.querySelector(".banner .banner-content");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}static \u0275fac=function(e){return new(e||o)(h(ae),h(Z),h(O),h(K))};static \u0275cmp=L({type:o,selectors:[["app-view-staff"]],decls:68,vars:7,consts:[["loadingTpl",""],["noStaff",""],[1,"container-fluid"],[4,"ngIf","ngIfElse"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"colseCls"],[1,"bi","bi-x-lg"],[1,"modal-body"],[3,"formGroup"],[1,"form-group"],["formControlName","billingAddress","type","text","placeholder","Enter billing address",1,"form-control"],["class","text-danger small",4,"ngIf"],[1,"form-group","my-3"],["formControlName","billingName","type","text","placeholder","Enter your name",1,"form-control"],["formControlName","gstNumber","type","text","placeholder","Enter GST number",1,"form-control"],[1,"modal-footer"],["type","button",1,"btn","btn-primary","submission","text-light","btn-sm","w-100","rounded-pill",3,"click","disabled"],["id","swapStaff","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["type","button",1,"btn","submission","text-light","btn-sm","w-100","rounded-pill"],["type","submit",1,"btn","btn-primary","submission","text-light","btn-sm","rounded-pill",3,"click"],["id","deleteStaff","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"d-flex","justify-content-center","align-items-center",2,"min-height","200px"],[1,"text-center"],["role","status","aria-hidden","true",1,"spinner-border"],[1,"mt-2"],["class","row",4,"ngFor","ngForOf"],[1,"bg-white","px-0"],[1,"p-3","d-flex","justify-content-between"],["data-bs-toggle","modal","data-bs-target","#exampleModal",1,"submission","btn","btn-primary","text-light","rounded-pill","btn-sm"],[1,"row"],[1,"col-12","mb-2"],["class","col-md-3 mb-4",4,"ngFor","ngForOf"],[1,"col-md-3","mb-4"],[1,"card","h-100"],[1,"row","g-0"],[1,"col-4"],[1,"staff-img"],["alt","Staff Image",1,"img-fluid","rounded",3,"src"],[1,"col-7"],[1,"card-body","p-2"],[1,"card-title","mb-1"],[1,"mb-1","text-muted"],[1,"mb-1"],[4,"ngFor","ngForOf"],[1,"ms-1","text-warning"],[1,"d-flex","justify-content-start","gap-2","mt-2"],["data-bs-toggle","modal","data-bs-target","#swapStaff",1,"btn","btn-outline-primary","actionSwap",3,"click","disabled"],[1,"bi","bi-arrow-left-right"],["data-bs-toggle","modal","data-bs-target","#deleteStaff",1,"btn","btn-sm","btn-outline-danger","actionDelete",3,"click"],[1,"bi",3,"ngClass"],[1,"status-container"],[1,"text-danger","small"]],template:function(e,n){if(e&1){let r=F();i(0,"div",2),g(1,fe,5,0,"ng-template",null,0,M)(3,_e,2,2,"ng-container",3)(4,ve,3,0,"ng-template",null,1,M),a(),i(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"h1",8),l(11,"Please Enter Billing Information"),a(),i(12,"button",9),f(13,"i",10),a()(),i(14,"div",11)(15,"form",12)(16,"div",13)(17,"label"),l(18,"Billing Address"),a(),f(19,"input",14),g(20,Se,2,0,"div",15),a(),i(21,"div",16)(22,"label"),l(23,"Your Name"),a(),f(24,"input",17),g(25,ye,2,0,"div",15),a(),i(26,"div",13)(27,"label"),l(28,"GST Number"),a(),f(29,"input",18),g(30,he,2,0,"div",15),a()()(),i(31,"div",19)(32,"button",20),v("click",function(){return b(r),_(n.onProceedToPayment(n.billingForm.value.billingName,n.billingForm.value.billingAddress,n.billingForm.value.gstNumber))}),l(33," Proceed to Payment (1212) "),a()()()()(),i(34,"div",21)(35,"div",5)(36,"div",6)(37,"div",7)(38,"h1",8),l(39,"Please Enter Billing Information"),a(),i(40,"button",9),f(41,"i",10),a()(),i(42,"div",11)(43,"h5"),l(44,"Are you Sure, you want to swap the Staff?"),a()(),i(45,"div",19)(46,"button",22),l(47,"No"),a(),i(48,"button",23),v("click",function(){return b(r),_(n.addSpecificStaff(n.selectedStaff))}),l(49,"Yes"),a()()()()(),i(50,"div",24)(51,"div",5)(52,"div",6)(53,"div",7)(54,"h1",8),l(55,"Confirm"),a(),i(56,"button",9),f(57,"i",10),a()(),i(58,"div",11)(59,"h5"),l(60,"Are you sure you want to remove this staff ?"),a()(),i(61,"div",19)(62,"button",22),l(63,"Cancel"),a(),i(64,"button",23),v("click",function(){return b(r),_(n.removeStaff(n.selectedStaff))}),l(65,"Remove"),a()()()()(),f(66,"app-footer")(67,"app-mobile-footer-nav")}if(e&2){let r,d,p,u=T(2);s(3),c("ngIf",!n.loading)("ngIfElse",u),s(12),c("formGroup",n.billingForm),s(5),c("ngIf",((r=n.billingForm.get("billingAddress"))==null?null:r.touched)&&((r=n.billingForm.get("billingAddress"))==null?null:r.invalid)),s(5),c("ngIf",((d=n.billingForm.get("billingName"))==null?null:d.touched)&&((d=n.billingForm.get("billingName"))==null?null:d.invalid)),s(5),c("ngIf",((p=n.billingForm.get("gstNumber"))==null?null:p.touched)&&((p=n.billingForm.get("gstNumber"))==null?null:p.invalid)),s(2),c("disabled",n.billingForm.invalid)}},dependencies:[Q,U,q,H,re,te,J,X,ee,ne,ie,oe,le,Y],styles:[".text-center[_ngcontent-%COMP%]{position:fixed;top:50%;left:45%}.bi-star-half.text-warning[_ngcontent-%COMP%], .bi-star-full.text-warning[_ngcontent-%COMP%]{color:#000!important}.actionSwap[_ngcontent-%COMP%]{width:36px!important;height:37px!important;border-radius:100%!important;padding:0!important;background:#e4f4f3!important;border:0!important}.actionSwap[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:18px!important}.actionDelete[_ngcontent-%COMP%]{border:0!important;background:#ffe6e6!important;padding:0!important;width:36px!important;height:37px!important;border-radius:100%!important}.actionDelete[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{font-size:18px!important}.card[_ngcontent-%COMP%]{border:1px solid #ccebec!important;background:#f4f5f7!important}.card[_ngcontent-%COMP%]   .staff-img[_ngcontent-%COMP%]{height:auto;background:#fff;border-radius:20px;position:relative;margin:30px 10px;padding:10px 0}footer[_ngcontent-%COMP%]{position:sticky;bottom:0;width:100%}.colseCls[_ngcontent-%COMP%]{margin:auto 1px auto auto;border:0px;border-color:#db9280;border-radius:3px;color:#fff}.form-control[_ngcontent-%COMP%]{border-radius:25px!important}.status-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:60vh;text-align:center;position:relative}.status-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:600;color:#555}"]})};export{se as ViewStaff};
