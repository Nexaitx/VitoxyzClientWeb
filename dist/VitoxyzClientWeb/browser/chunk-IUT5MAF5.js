import{a as Re,b as $,c as F,d as Be}from"./chunk-BIR3EXIX.js";import{b as ye}from"./chunk-WLZ6HDSS.js";import{A as Te,B as Fe,C as Pe,D as Ve,c as H,d as C,g as U,h as ve,i as Me,k as be,l as Ce,m as ze,o as ke,p as we,q as xe,r as Ie,s as Se,t as Ee,u as De,v as Oe,w as Le,y as Ae}from"./chunk-JL5QULEH.js";import{$b as j,Bc as he,Db as de,Dc as W,Eb as Y,Fb as J,Hc as _e,Ia as d,Ic as fe,Lb as O,Ma as re,Nb as u,Ob as ce,Pb as E,Rb as X,Sb as ee,Ta as D,Tb as te,Ua as ae,Vb as T,Xa as z,Yb as ge,Za as G,_ as ne,_b as Q,a as A,b as R,ca as B,ga as _,gb as M,ha as f,hb as b,lb as p,mb as s,nb as o,ob as h,pb as oe,qb as se,sb as Z,tb as N,vb as k,xb as y,xc as ue,yb as le,yc as pe,zb as c,zc as me}from"./chunk-RCICEC7B.js";var Ge=(()=>{class a{static \u0275fac=function(r){return new(r||a)};static \u0275mod=ae({type:a});static \u0275inj=ne({})}return a})();var je=["mapElement"],q=class a{mapElement;locationSelected=new G;userLat=28.6139;userLng=77.209;map;ngOnInit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{this.userLat=i.coords.latitude,this.userLng=i.coords.longitude,this.initMap()},i=>{console.error("Geolocation error:",i),this.initMap()}):(console.warn("Geolocation not supported"),this.initMap())}ngAfterViewInit(){navigator.geolocation||this.initMap()}initMap(){if(typeof google>"u"||!google.maps){console.error("Google Maps API not loaded");return}this.map=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:this.userLat,lng:this.userLng},zoom:12}),new google.maps.Marker({map:this.map,position:{lat:this.userLat,lng:this.userLng},title:"You are here"}),this.map.addListener("click",i=>{let e=i.latLng.lat(),r=i.latLng.lng();this.locationSelected.emit({lat:e,lng:r})})}onMapClick(i){let e=i.latLng.lat(),r=i.latLng.lng();this.locationSelected.emit({lat:e,lng:r})}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=D({type:a,selectors:[["app-map"]],viewQuery:function(e,r){if(e&1&&de(je,5),e&2){let t;Y(t=J())&&(r.mapElement=t.first)}},outputs:{locationSelected:"locationSelected"},decls:2,vars:0,consts:[["mapElement",""],[1,"map-container",3,"mapClick"]],template:function(e,r){if(e&1){let t=k();oe(0,"div",1,0),le("mapClick",function(l){return _(t),f(r.onMapClick(l))}),se()}},dependencies:[Ge],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:auto;min-height:400px;margin-top:10px;position:relative!important;overflow:hidden!important}[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     #mapElement{width:100%;height:90%}"]})};var Ue=a=>({"is-invalid":a});function $e(a,i){if(a&1){let e=k();s(0,"button",5),y("click",function(){_(e);let t=c(2);return f(t.closePopup())}),o()}}function qe(a,i){if(a&1){let e=k();s(0,"div")(1,"input",6),te("ngModelChange",function(t){_(e);let n=c(2);return ee(n.aadharNumber,t)||(n.aadharNumber=t),f(t)}),o(),s(2,"button",7),y("click",function(){_(e);let t=c(2);return f(t.sendOtp())}),u(3,"Send OTP"),o()()}if(a&2){let e=c(2);d(),X("ngModel",e.aadharNumber)}}function Ke(a,i){a&1&&(s(0,"div",11),u(1,"Invalid OTP. Please try again."),o())}function Ye(a,i){if(a&1){let e=k();s(0,"div")(1,"input",8),te("ngModelChange",function(t){_(e);let n=c(2);return ee(n.otp,t)||(n.otp=t),f(t)}),y("input",function(){_(e);let t=c(2);return f(t.otpError=!1)}),o(),s(2,"button",9),y("click",function(){_(e);let t=c(2);return f(t.verifyOtp())}),u(3,"Verify OTP"),o(),z(4,Ke,2,0,"div",10),o()}if(a&2){let e=c(2);d(),p("ngClass",ge(3,Ue,e.otpError)),X("ngModel",e.otp),d(3),p("ngIf",e.otpError)}}function Je(a,i){if(a&1&&(s(0,"div",1),z(1,$e,1,0,"button",2),s(2,"h5",3),u(3,"Aadhar Verification"),o(),z(4,qe,4,1,"div",4)(5,Ye,5,5,"div",4),o()),a&2){let e=c();d(),p("ngIf",e.step==="input"),d(3),p("ngIf",e.step==="input"),d(),p("ngIf",e.step==="otp")}}var K=class a{verified=new G;aadharNumber="";otp="";step="input";otpError=!1;isVisible=!0;generatedOtp="123456";sendOtp(){if(this.aadharNumber.length!==12||!/^\d{12}$/.test(this.aadharNumber)){alert("Please enter a valid 12-digit Aadhar number.");return}console.log("Sending OTP to:",this.aadharNumber),setTimeout(()=>{console.log("OTP sent successfully!"),this.step="otp"},500)}verifyOtp(){this.otp===this.generatedOtp?(console.log("OTP verified successfully!"),this.verified.emit(),this.closePopup()):this.otpError=!0}closePopup(){this.isVisible=!1}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=D({type:a,selectors:[["app-aadhar-verification"]],outputs:{verified:"verified"},decls:1,vars:1,consts:[["class","aadhar-toast-box",4,"ngIf"],[1,"aadhar-toast-box"],["class","btn-close top-right",3,"click",4,"ngIf"],[1,"text-center","mb-3"],[4,"ngIf"],[1,"btn-close","top-right",3,"click"],["type","text","placeholder","Enter your 12-digit Aadhar Number","maxlength","12",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","w-100",3,"click"],["type","text","placeholder","Enter 6-digit OTP","maxlength","6",1,"form-control","mb-2",3,"ngModelChange","input","ngClass","ngModel"],[1,"btn","btn-success","w-100",3,"click"],["class","text-danger text-center mt-1",4,"ngIf"],[1,"text-danger","text-center","mt-1"]],template:function(e,r){e&1&&z(0,Je,6,3,"div",0),e&2&&p("ngIf",r.isVisible)},dependencies:[W,ue,me,Pe,H,U,Ae,be],styles:[".aadhar-toast-box[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:320px;background:#fff;border-radius:10px;box-shadow:0 5px 15px #00000040;z-index:1050;padding:20px;display:flex;flex-direction:column}.top-right[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px}"]})};function Xe(a,i){a&1&&(s(0,"div",16),u(1," Area is required. "),o())}function et(a,i){if(a&1&&(s(0,"div",20),h(1,"div",25),s(2,"span",26),u(3),o(),h(4,"div",25),o()),a&2){let e=c().index;d(3),ce(e)}}function tt(a,i){if(a&1){let e=k();s(0,"button",27),y("click",function(){_(e);let t=c().index,n=c();return f(n.removeStaff(t))}),h(1,"i",28),o()}}function it(a,i){if(a&1&&(s(0,"option",36),u(1),o()),a&2){let e=i.$implicit;p("value",e.name),d(),E(" ",e.name," ")}}function nt(a,i){a&1&&(s(0,"div",16),u(1," Type of Staff is required. "),o())}function rt(a,i){if(a&1&&(s(0,"option",36),u(1),o()),a&2){let e=i.$implicit;p("value",e.value),d(),E(" ",e.label," ")}}function at(a,i){if(a&1&&(s(0,"div",16),u(1),Q(2,"titlecase"),o()),a&2){let e,r=c(2).$implicit;d(),E(" Type of ",j(2,1,(e=r.get("typeOfStaff"))==null?null:e.value)," is required. ")}}function ot(a,i){if(a&1&&(Z(0),s(1,"div",37)(2,"div",12)(3,"label",31),u(4),Q(5,"titlecase"),o(),h(6,"i",38),s(7,"select",39)(8,"option",34),u(9),Q(10,"titlecase"),o(),z(11,rt,2,2,"option",35),o(),M(12,at,3,3,"div",16),o()(),N()),a&2){let e,r,t,n,l,g=c().$implicit,v=c().index,w=c();d(3),p("for",T("typeOfSubStaff-",v)),d(),E("Select ",j(5,11,(e=g.get("typeOfStaff"))==null?null:e.value)," Type"),d(3),O("is-invalid",((r=g.get("typeOfSubStaff"))==null?null:r.invalid)&&((r=g.get("typeOfSubStaff"))==null?null:r.touched)),p("id",T("typeOfSubStaff-",v))("disabled",!((t=g.get("typeOfStaff"))!=null&&t.value)),d(2),E("Select ",j(10,13,(n=g.get("typeOfStaff"))==null?null:n.value)," "),d(2),p("ngForOf",w.staffSubCategories[v]),d(),b((l=g.get("typeOfSubStaff"))!=null&&l.invalid&&((l=g.get("typeOfSubStaff"))!=null&&l.touched)?12:-1)}}function st(a,i){if(a&1&&(s(0,"div",29)(1,"div",1)(2,"div",30)(3,"div",12)(4,"label",31),u(5,"Select Staff Type"),o(),h(6,"i",32),s(7,"select",33)(8,"option",34),u(9,"Select Type"),o(),z(10,it,2,2,"option",35),o(),M(11,nt,2,0,"div",16),o()(),M(12,ot,13,15,"ng-container"),o()()),a&2){let e,r,t,n=i.$implicit,l=i.index,g=c().index,v=c();p("formGroupName",l),d(4),p("for",T("typeOfStaff-",g)),d(3),O("is-invalid",((e=n.get("typeOfStaff"))==null?null:e.invalid)&&((e=n.get("typeOfStaff"))==null?null:e.touched)),p("id",T("typeOfStaff-",g)),d(3),p("ngForOf",v.staffCategories),d(),b((r=n.get("typeOfStaff"))!=null&&r.invalid&&((r=n.get("typeOfStaff"))!=null&&r.touched)?11:-1),d(),b((t=n.get("typeOfStaff"))!=null&&t.value&&((t=n.get("typeOfStaff"))==null?null:t.value)!==""?12:-1)}}function lt(a,i){a&1&&(s(0,"div",57),u(1," Past time is not allowed. "),o())}function dt(a,i){if(a&1&&(s(0,"option",36),u(1),o()),a&2){let e=i.$implicit;p("value",e),d(),E(" ",e," ")}}function ct(a,i){a&1&&(s(0,"div",16),u(1," Shift Type is required. "),o())}function gt(a,i){a&1&&(s(0,"div",57),u(1," Quantity is required. "),o())}function ut(a,i){if(a&1&&(s(0,"option",36),u(1),o()),a&2){let e=i.$implicit;p("value",e.value),d(),E(" ",e.label," ")}}function pt(a,i){a&1&&(s(0,"div",16),u(1," Tenure is required. "),o())}function mt(a,i){if(a&1){let e=k();s(0,"i",74),y("click",function(){_(e);let t=c(3).index,n=c();return f(n.addShift(t))}),o()}}function ht(a,i){if(a&1){let e=k();s(0,"i",75),y("click",function(){_(e);let t=c().index,n=c(2).index,l=c();return f(l.removeShiftDetail(n,t))}),o()}}function _t(a,i){if(a&1){let e=k();s(0,"div",42)(1,"div",43)(2,"div",44)(3,"label",13),u(4,"Duty Start Time"),o(),s(5,"div",45)(6,"div",46)(7,"button",47),y("click",function(){let t=_(e).index,n=c(2).index,l=c();return f(l.decrementTime("hours",n,t))}),h(8,"i",48),o(),h(9,"input",49),s(10,"button",50),y("click",function(){let t=_(e).index,n=c(2).index,l=c();return f(l.incrementTime("hours",n,t))}),h(11,"i",51),o()(),s(12,"div",52)(13,"button",47),y("click",function(){let t=_(e).index,n=c(2).index,l=c();return f(l.decrementTime("minutes",n,t))}),h(14,"i",48),o(),h(15,"input",53),s(16,"button",50),y("click",function(){let t=_(e).index,n=c(2).index,l=c();return f(l.incrementTime("minutes",n,t))}),h(17,"i",51),o()(),s(18,"select",54)(19,"option",55),u(20,"AM"),o(),s(21,"option",56),u(22,"PM"),o()()(),M(23,lt,2,0,"div",57),o(),s(24,"div",58)(25,"label",13),u(26,"Shift Time"),o(),s(27,"select",59)(28,"option",34),u(29,"Select Time"),o(),z(30,dt,2,2,"option",35),o(),M(31,ct,2,0,"div",16),o(),s(32,"div",58)(33,"div",12)(34,"label",60),u(35,"Prefered Gender"),o(),h(36,"i",61)(37,"input",62),o(),s(38,"div",12),h(39,"i",63)(40,"input",64),o(),M(41,gt,2,0,"div",57),o(),s(42,"div",58)(43,"label",13),u(44,"Quantity"),o(),s(45,"div",65)(46,"button",47),y("click",function(){let t=_(e).index,n=c(2).index,l=c();return f(l.decrease("maleQuantity",n,t))}),h(47,"i",48),o(),h(48,"input",66),s(49,"button",50),y("click",function(){let t=_(e).index,n=c(2).index,l=c();return f(l.increase("maleQuantity",n,t))}),h(50,"i",51),o()(),s(51,"div",67)(52,"button",47),y("click",function(){let t=_(e).index,n=c(2).index,l=c();return f(l.decrease("femaleQuantity",n,t))}),h(53,"i",48),o(),h(54,"input",66),s(55,"button",50),y("click",function(){let t=_(e).index,n=c(2).index,l=c();return f(l.increase("femaleQuantity",n,t))}),h(56,"i",51),o()()(),s(57,"div",58)(58,"div",12)(59,"label",13),u(60,"Tenure"),o(),h(61,"i",68),s(62,"select",69),z(63,ut,2,2,"option",35),o(),M(64,pt,2,0,"div",16),o()(),s(65,"div",11)(66,"label",13),u(67,"Duty Start Date"),o(),h(68,"input",70),o(),s(69,"div",71),M(70,mt,1,0,"i",72),M(71,ht,1,0,"i",73),o()()()}if(a&2){let e,r,t,n,l,g,v,w,m=i.$implicit,x=i.index,L=c(2).index,I=c();p("formGroupName",x),d(5),O("is-invalid",((e=m.get("timeSlot"))==null||e.errors==null?null:e.errors.pastTime)&&((e=m.get("timeSlot"))==null?null:e.touched)),d(4),p("value",I.pad((r=m.get("hours"))==null?null:r.value)),d(6),p("value",I.pad((t=m.get("minutes"))==null?null:t.value)),d(8),b(!((n=m.get("timeSlot"))==null||n.errors==null)&&n.errors.pastTime&&((n=m.get("timeSlot"))!=null&&n.touched)?23:-1),d(4),O("is-invalid",((l=m.get("shiftType"))==null?null:l.invalid)&&((l=m.get("shiftType"))==null?null:l.touched)),d(3),p("ngForOf",I.shiftTypes),d(),b((g=m.get("shiftType"))!=null&&g.invalid&&((g=m.get("shiftType"))!=null&&g.touched)?31:-1),d(10),b(m.errors!=null&&m.errors.zeroQuantity&&(m.touched||m.dirty)?41:-1),d(7),p("formControlName","maleQuantity"),d(6),p("formControlName","femaleQuantity"),d(8),O("is-invalid",((v=m.get("tenure"))==null?null:v.invalid)&&((v=m.get("tenure"))==null?null:v.touched)),d(),p("ngForOf",I.tenure),d(),b((w=m.get("tenure"))!=null&&w.invalid&&((w=m.get("tenure"))!=null&&w.touched)?64:-1),d(4),p("min",I.today),d(2),b(x===0||x===I.getNestedShiftDetailsControls(L).length-1?70:-1),d(),b(x>0?71:-1)}}function ft(a,i){if(a&1&&(Z(0),s(1,"div",40),z(2,_t,72,20,"div",41),o(),N()),a&2){let e=c().index,r=c();d(2),p("ngForOf",r.getNestedShiftDetailsControls(e))}}function yt(a,i){if(a&1&&(s(0,"div",19),M(1,et,5,1,"div",20),s(2,"div",21),M(3,tt,2,0,"button",22),o(),s(4,"div",23),z(5,st,13,10,"div",24),o(),M(6,ft,3,1,"ng-container"),o()),a&2){let e,r=i.index,t=c();p("formGroupName",r),d(),b(r>0?1:-1),d(2),b(r!==0?3:-1),d(2),p("ngForOf",t.getNestedStaffDetailsControls(r)),d(),b((e=t.getNestedStaffDetailsControls(r)[0].get("typeOfStaff"))!=null&&e.value?6:-1)}}function vt(a,i){if(a&1){let e=k();Z(0),s(1,"div",76)(2,"button",77),y("click",function(){_(e);let t=c();return f(t.addNewStaff())}),h(3,"i",51),u(4,"Add Another Staff "),o()(),s(5,"div",78),h(6,"app-submission",79),o(),N()}if(a&2){let e=c();d(6),p("buttonType",e.button)}}function Mt(a,i){if(a&1){let e=k();s(0,"app-aadhar-verification",80),y("verified",function(){_(e);let t=c();return f(t.onAadharVerified())}),o()}}var Ne=class a{constructor(i){this.spinnerService=i}fb=B(Fe);http=B(fe);router=B(ye);staffBookingForm;hours=Array.from({length:24},(i,e)=>e);minutes=[0,15,30,45];nurseTenure=["1 Day","15 Days","Monthly","Quarterly","Half Yearly","Yearly"];button="Search for staff";staffCategories=[];staffSubCategories={};shiftTypes=["2 Hours Max","8 Hours","12 Hours","24 Hours"];tenure=[{label:"1 Day",value:"1"},{label:"3 Days",value:"2"},{label:"1 Week",value:"3"},{label:"2 Weeks",value:"4"},{label:"1 Month",value:"5"}];today=new Date().toISOString().split("T")[0];isToken=localStorage.getItem("authToken");isLogin=!1;showAadharPopup=!1;staffSearchResponse=null;ngOnInit(){this.getUserLocation(),this.getStaffCategories(),this.staffBookingForm=this.fb.group({userAddress:["",C.required],latitude:[],longitude:[],staffForms:this.fb.array([this.createStaffFormGroup()])}),this.subscribeToCategoryChange(0)}getStaffCategories(){let i=$+F.CATEGORIES;this.http.get(i).subscribe({next:e=>{this.staffCategories=e||[]},error:e=>{console.error("Error fetching categories:",e)}})}subscribeToCategoryChange(i){let t=this.staffListFormArray.at(i).get("staffDetails").at(0);t.get("typeOfStaff")?.valueChanges.subscribe(n=>{let l=this.staffCategories.find(g=>g.name===n);if(l){let g=l.id;this.fetchSubCategories(g,i),t.get("typeOfSubStaff")?.setValue("")}})}incrementTime(i,e,r){let t=this.getShiftGroup(e,r);if(t)if(i==="hours"){let n=+t.get("hours")?.value||1;n=n%12+1,n===0&&(n=12),t.get("hours")?.setValue(n)}else{let n=+t.get("minutes")?.value||0;n=(n+1)%60,t.get("minutes")?.setValue(n)}}decrementTime(i,e,r){let t=this.getShiftGroup(e,r);if(t)if(i==="hours"){let n=+t.get("hours")?.value||1;n=(n-1+12)%12,n===0&&(n=12),t.get("hours")?.setValue(this.pad(n))}else{let n=+t.get("minutes")?.value||0;n=(n-1+60)%60,t.get("minutes")?.setValue(this.pad(n))}}getShiftGroup(i,e){return this.staffListFormArray.at(i).get("shiftDetails").at(e)}pad(i){return i!=null?i.toString().padStart(2,"0"):"00"}increase(i,e,r){let t=this.getQuantityControl(i,e,r);t.setValue(Math.min((t.value||0)+1,10)),this.updateGenderInShift(e,r)}decrease(i,e,r){let t=this.getQuantityControl(i,e,r);t.setValue(Math.max((t.value||1)-1,0)),this.updateGenderInShift(e,r)}updateGenderInShift(i,e){let r=this.getShiftGroup(i,e);r&&this.updateGenderQty(r)}getQuantityControl(i,e,r){return this.staffListFormArray.at(e).get("shiftDetails").at(r).get(i==="maleQuantity"?"maleQuantity":"femaleQuantity")}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(i=>{let e=i.coords.latitude,r=i.coords.longitude;this.getAddressFromCoords(e,r)},i=>{console.error("Geolocation failed:",i)}):console.error("Geolocation not supported by this browser.")}getAddressFromCoords(i,e){this.staffBookingForm.patchValue({latitude:i,longitude:e});let r=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${i}&lon=${e}`;this.http.get(r).subscribe(t=>{let n=t.display_name;n&&this.staffBookingForm.patchValue({userAddress:n})},t=>{console.error("Error fetching address:",t)})}createStaffDetailFormGroup(){return this.fb.group({typeOfStaff:["",C.required],typeOfSubStaff:["",C.required]})}fetchSubCategories(i,e){let r=`${$}${F.CATEGORIES}/${i}${F.SUB_CATEGORIES}`;this.http.get(r).subscribe({next:t=>{this.staffSubCategories[e]=t},error:t=>{console.error("Failed to fetch subcategories",t),this.staffSubCategories[e]=[]}})}get staffDetailsFormArray(){return this.staffBookingForm.get("staffDetails")}createShiftDetailFormGroup(){let e=new Date().getHours(),r="00",t=e>=12?"PM":"AM";e===0?e=12:e>12&&(e-=12);let n=this.fb.group({shiftType:["",C.required],timeSlot:[""],tenure:["1"],dutyStartDate:[new Date().toISOString().substring(0,10)],maleQuantity:["0",[C.min(0),C.max(10)]],femaleQuantity:["0",[C.min(0),C.max(10)]],hours:[e,[C.required,C.min(1),C.max(12)]],minutes:[r,[C.required,C.min(0),C.max(59)]],ampm:[t,C.required]},{validators:[this.shiftDurationValidator]});return n.get("hours")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("minutes")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("ampm")?.valueChanges.subscribe(()=>this.updateTimeSlot(n)),n.get("maleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(n)),n.get("femaleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(n)),n.get("dutyStartDate")?.valueChanges.subscribe(l=>{if(!l){let g=new Date().toISOString().substring(0,10);n.get("dutyStartDate")?.setValue(g,{emitEvent:!1})}}),n}updateTimeSlot(i){let e=i.get("hours")?.value??0,r=i.get("minutes")?.value??0,t=i.get("ampm")?.value??"AM",n=v=>v.toString().padStart(2,"0"),l=`${n(+e)}:${n(+r)} ${t}`,g=i.get("timeSlot");g?.setValue(l,{emitEvent:!1}),g?.markAsTouched(),g?.markAsDirty()}updateGenderQty(i){let e=Number(i.get("maleQuantity")?.value||0),r=Number(i.get("femaleQuantity")?.value||0);i.get("maleQuantity")?.setValue(e),i.get("gender")?.setValue(r)}get shiftDetailsFormArray(){return this.staffBookingForm.get("shiftDetails")}createStaffFormGroup(){return this.fb.group({staffDetails:this.fb.array([this.createStaffDetailFormGroup()]),shiftDetails:this.fb.array([this.createShiftDetailFormGroup()])})}addShift(i){this.staffListFormArray.at(i).get("shiftDetails").push(this.createShiftDetailFormGroup())}removeShiftDetail(i,e){this.staffListFormArray.at(i).get("shiftDetails").removeAt(e)}addNewStaff(){this.staffListFormArray.push(this.createStaffFormGroup());let i=this.staffListFormArray.length-1;this.subscribeToCategoryChange(i)}get staffListFormArray(){return this.staffBookingForm.get("staffForms")}getNestedShiftDetailsControls(i){return this.staffListFormArray.at(i).get("shiftDetails").controls}getNestedStaffDetailsControls(i){return this.staffListFormArray.at(i).get("staffDetails").controls}removeStaff(i){this.staffListFormArray.removeAt(i)}onSubmit(){let i=this.hasPastTimeError(),e=this.hasZeroQuantityError();if(this.staffBookingForm.valid&&!i&&!e){this.spinnerService.show();let r=$+F.BOOK_STAFF,t=R(A({},this.staffBookingForm.value),{staffForms:this.staffListFormArray.controls.map(l=>{let g=l.get("staffDetails").at(0),{typeOfStaff:v,typeOfSubStaff:w}=g.value,m=l.get("shiftDetails").controls.map(x=>{let{shiftType:L,timeSlot:I,tenure:S,maleQuantity:P,femaleQuantity:V,dutyStartDate:Qe}=x.value;return{shiftType:L,timeSlot:I,tenure:S,maleQuantity:P,femaleQuantity:V,dutyStartDate:Qe}});return{typeOfStaff:v,typeOfSubStaff:w,shifts:m}})}),n=new _e({"Content-Type":"application/json"});this.isToken&&(n=n.set("Authorization",`Bearer ${this.isToken}`)),this.http.post(r,t,{headers:n}).subscribe({next:l=>{this.spinnerService.hide();let g=l?.staff[0]?.staffDetails||[];g.length>0?this.isLogin?this.router.navigate(["/view-staff"],{state:{staffDetails:g}}):(this.staffSearchResponse=g,this.showAadharPopup=!0):alert("No staff found.")},error:l=>{console.error("Staff search failed:",l),this.spinnerService.hide()}})}else this.markAllAsTouched(this.staffBookingForm)}hasPastTimeError(){let i=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(t=>{let n=t.get("dutyStartDate")?.value,l=+t.get("hours")?.value,g=+t.get("minutes")?.value,v=t.get("ampm")?.value;if(!n||l==null||g==null||!v)return;let w=new Date(n),m=new Date,x=S=>S.toString().padStart(2,"0"),L=`${x(l)}:${x(g)} ${v}`;if(t.get("timeSlot")?.setValue(L,{emitEvent:!1}),w.getFullYear()===m.getFullYear()&&w.getMonth()===m.getMonth()&&w.getDate()===m.getDate()){let S=l;v==="PM"&&S!==12&&(S+=12),v==="AM"&&S===12&&(S=0);let P=new Date;if(P.setHours(S,g,0,0),P<m)t.get("timeSlot")?.setErrors({pastTime:!0}),i=!0;else{let V=t.get("timeSlot");V?.hasError("pastTime")&&V.setErrors(null)}}})}),i}hasZeroQuantityError(){let i=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(t=>{let n=+t.get("maleQuantity")?.value||0,l=+t.get("femaleQuantity")?.value||0;if(n===0&&l===0)t.setErrors(R(A({},t.errors||{}),{zeroQuantity:!0})),i=!0;else if(t.errors?.zeroQuantity){let g=A({},t.errors);delete g.zeroQuantity,t.setErrors(Object.keys(g).length?g:null)}})}),i}markAllAsTouched(i){Object.values(i.controls).forEach(e=>{e.markAsTouched(),(e instanceof Me||e instanceof Te)&&this.markAllAsTouched(e)})}onAadharVerified(){this.isLogin=!0,this.showAadharPopup=!1,this.staffSearchResponse&&(this.router.navigate(["/view-staff"],{state:{staffDetails:this.staffSearchResponse}}),this.staffSearchResponse=null)}shiftDurationValidator(i){let e=parseInt(i.get("shiftHour")?.value,10),r=parseInt(i.get("shiftMinute")?.value,10);if(isNaN(e)||isNaN(r))return null;let t=e*60+r,n=(t+8*60)%(24*60);return t>=0&&n>=0?null:{invalidShiftDuration:!0}}static \u0275fac=function(e){return new(e||a)(re(Be))};static \u0275cmp=D({type:a,selectors:[["app-book-staff"]],decls:23,vars:7,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-4","h-100"],[3,"locationSelected"],[1,"col-md-8","search-staff-form"],[1,"form-scroll-container"],[1,"form-content"],[1,"form-title"],[3,"ngSubmit","formGroup"],[1,"form"],[1,"row","my-3"],[1,"col-md-12"],[1,"form-group"],[1,"form-label"],[1,"bi","bi-geo-alt","address"],["type","text","formControlName","userAddress",1,"form-control","ps-4"],[1,"invalid-feedback"],["formArrayName","staffForms",1,"staff-list"],["class","pe-2",3,"formGroupName",4,"ngFor","ngForOf"],[1,"pe-2",3,"formGroupName"],[1,"indexed-divider-container"],[1,"col-md-12","d-flex","justify-content-end"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px"],["formArrayName","staffDetails"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"line"],[1,"index-number"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px",3,"click"],[1,"bi","bi-trash","fs-5"],[3,"formGroupName"],[1,"col-md-12","mb-2"],[1,"form-label",3,"for"],[1,"bi","bi-person","address"],["formControlName","typeOfStaff",1,"form-select","ps-4",3,"id"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"col-md-12","my-3"],[1,"bi","bi-people","address"],["formControlName","typeOfSubStaff",1,"form-select","ps-4",3,"id","disabled"],["formArrayName","shiftDetails"],["class","shift-detail",3,"formGroupName",4,"ngFor","ngForOf"],[1,"shift-detail",3,"formGroupName"],[1,"row","d-flex"],[1,"col-md-4"],[1,"d-flex","gap-3","align-items-center"],[1,"input-group","input-group-time","d-flex","align-items-center"],["type","button",1,"btn","btn-minus","px-0",3,"click"],[1,"bi","bi-dash"],["type","number","formControlName","hours","value","09","min","0","max","12","readonly","",1,"form-control","px-0",3,"value"],["type","button",1,"btn","btn-plus","px-0",3,"click"],[1,"bi","bi-plus"],[1,"input-group","input-group-time","align-items-center","d-flex"],["type","number","formControlName","minutes","value","00","min","0","max","59","readonly","",1,"form-control","px-0",3,"value"],["formControlName","ampm",1,"form-select","time-select"],["value","AM"],["value","PM"],[1,"text-danger"],[1,"col-md-2"],["formControlName","shiftType",1,"form-select","pe-1"],[1,"form-label","d-block"],[1,"bi","bi-person-standing","address"],["type","text","readonly","","value","Male",1,"form-control","ps-4"],[1,"bi","bi-person-standing-dress","address","female"],["type","text","readonly","","value","Female",1,"form-control","mt-2","ps-4"],[1,"d-flex","align-items-center","mb-2","counter-box"],["type","number","min","0","max","10","readonly","","readonly","",1,"form-control",3,"formControlName"],[1,"d-flex","align-items-center","counter-box"],[1,"bi","bi-calendar4","address"],["formControlName","tenure",1,"form-select","ps-4","pe-1"],["type","date","formControlName","dutyStartDate",1,"form-control",3,"min"],[1,"d-flex","align-items-start","justify-content-end","gap-2","mt-3"],["title","Add Time Slot",1,"bi","bi-plus-lg","add"],["title","Remove Time Slot",1,"bi","bi-trash","text-danger","remove"],["title","Add Time Slot",1,"bi","bi-plus-lg","add",3,"click"],["title","Remove Time Slot",1,"bi","bi-trash","text-danger","remove",3,"click"],[1,"d-flex","justify-content-center","addNewBtn","my-2"],["type","button",1,"btn",3,"click"],[1,"submission-fixed","d-flex","justify-content-end"],[3,"buttonType"],[3,"verified"]],template:function(e,r){if(e&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-map",3),y("locationSelected",function(n){return r.getAddressFromCoords(n.lat,n.lng)}),o()(),s(4,"div",4)(5,"div",5)(6,"div",6)(7,"h2",7),u(8,"Please fill the form"),o(),s(9,"form",8),y("ngSubmit",function(){return r.onSubmit()}),s(10,"div",9)(11,"div",10)(12,"div",11)(13,"div",12)(14,"label",13),u(15,"Select your area"),o(),h(16,"i",14)(17,"input",15),M(18,Xe,2,0,"div",16),o()()(),s(19,"div",17),z(20,yt,7,5,"div",18),o()(),M(21,vt,7,1,"ng-container"),o()()()()()(),M(22,Mt,1,0,"app-aadhar-verification")),e&2){let t,n,l;d(9),p("formGroup",r.staffBookingForm),d(8),O("is-invalid",((t=r.staffBookingForm.get("userAddress"))==null?null:t.invalid)&&((t=r.staffBookingForm.get("userAddress"))==null?null:t.touched)),d(),b((n=r.staffBookingForm.get("userAddress"))!=null&&n.invalid&&((n=r.staffBookingForm.get("userAddress"))!=null&&n.touched)?18:-1),d(2),p("ngForOf",r.staffListFormArray.controls),d(),b(!((l=r.staffListFormArray.controls[0].get("staffDetails"))==null||(l=l.get("0"))==null||(l=l.get("typeOfStaff"))==null)&&l.value?21:-1),d(),b(r.showAadharPopup?22:-1)}},dependencies:[W,pe,Ve,Ce,Ee,De,H,ze,Se,U,ve,Le,Oe,ke,Ie,we,xe,q,Re,K,he],styles:[".form[_ngcontent-%COMP%]{height:52vh;overflow-x:hidden;overflow-y:scroll}.staff-list[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:scroll}.staff-list[_ngcontent-%COMP%]:hover{overflow-y:auto}.staff-list[_ngcontent-%COMP%]:focus-within{overflow-y:auto}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:3px;height:8px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#09b8c2;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#fff}.indexed-divider-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin:20px 0;color:#6c757d;font-weight:700;font-size:.9rem}.line[_ngcontent-%COMP%]{flex-grow:1;height:1px;background-color:#dee2e6}.index-number[_ngcontent-%COMP%]{color:#09b8c2;padding:5px 12px;background-color:#e0fcff;border-radius:50%;min-width:25px;text-align:center;box-shadow:0 1px 3px #0000000d}.form-group[_ngcontent-%COMP%]{position:relative}.address[_ngcontent-%COMP%]{position:absolute;left:5px;top:34px;color:#09b8c2}.female[_ngcontent-%COMP%]{top:8px!important}"]})};export{Ne as BookStaff};
