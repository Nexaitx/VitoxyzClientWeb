import{a as Fe,b as Be}from"./chunk-QCCJUOBW.js";import{a as Ae}from"./chunk-AGTFDDLE.js";import{d as Le,f as Pe}from"./chunk-2FIYSNYS.js";import"./chunk-RXPDFXEY.js";import{a as Te}from"./chunk-5TBLFU7I.js";import"./chunk-GA6KQOR5.js";import{F as pe,G as p,J as he,K as _e,L as fe,O as ye,P as ve,R as Me,S as be,T as Ce,U as xe,V as ze,W as ke,X as we,Y as Se,Z as Ie,aa as Oe,ba as Ee,da as De}from"./chunk-OHQSNZA5.js";import{a as Q,b as A}from"./chunk-TNRG4YRG.js";import{c as me}from"./chunk-UF26DDQM.js";import{h as se,i as le,n as de,q as ce,w as ge,y as ue}from"./chunk-HSQUREWB.js";import{Ab as S,Bc as T,Hc as Z,Ic as H,Kb as C,Lb as x,Pb as h,Qb as s,Rb as o,Sb as _,Tb as ie,Ub as ne,Wb as G,Xb as N,Zb as I,a as L,b as V,ca as W,cc as v,da as Y,dc as re,eb as u,ec as d,ha as R,ic as ae,jb as X,jc as U,kc as $,l as J,na as f,oa as y,pb as ee,qc as E,sc as m,tc as oe,uc as O,vb as P,wb as te}from"./chunk-36LOJXOE.js";var Ve=(()=>{class l{static \u0275fac=function(r){return new(r||l)};static \u0275mod=te({type:l});static \u0275inj=Y({})}return l})();var Ke=["mapElement"],j=class l{mapElement;locationSelected=new X;userLat=28.6139;userLng=77.209;map;ngOnInit(){navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{this.userLat=n.coords.latitude,this.userLng=n.coords.longitude,this.initMap()},n=>{console.error("Geolocation error:",n),this.initMap()}):(console.warn("Geolocation not supported"),this.initMap())}ngAfterViewInit(){navigator.geolocation||this.initMap()}initMap(){if(typeof google>"u"||!google.maps){console.error("Google Maps API not loaded");return}this.map=new google.maps.Map(this.mapElement.nativeElement,{center:{lat:this.userLat,lng:this.userLng},zoom:12}),new google.maps.Marker({map:this.map,position:{lat:this.userLat,lng:this.userLng},title:"You are here"}),this.map.addListener("click",n=>{let e=n.latLng.lat(),r=n.latLng.lng();this.locationSelected.emit({lat:e,lng:r})})}onMapClick(n){let e=n.latLng.lat(),r=n.latLng.lng();this.locationSelected.emit({lat:e,lng:r})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=P({type:l,selectors:[["app-map"]],viewQuery:function(e,r){if(e&1&&ae(Ke,5),e&2){let t;U(t=$())&&(r.mapElement=t.first)}},outputs:{locationSelected:"locationSelected"},decls:2,vars:0,consts:[["mapElement",""],[1,"map-container",3,"mapClick"]],template:function(e,r){if(e&1){let t=I();ie(0,"div",1,0),re("mapClick",function(a){return f(t),y(r.onMapClick(a))}),ne()}},dependencies:[Ve],styles:[".map-container[_ngcontent-%COMP%]{width:100%;height:auto;min-height:400px;margin-top:10px;position:relative!important;overflow:hidden!important}[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     #mapElement{width:100%;height:90%}"]})};var q=class l{_loading=new J(!1);loading$=this._loading.asObservable();show(){this._loading.next(!0)}hide(){this._loading.next(!1)}static \u0275fac=function(e){return new(e||l)};static \u0275prov=W({token:l,factory:l.\u0275fac,providedIn:"root"})};function Ye(l,n){l&1&&(s(0,"div",18),m(1,"Area is required."),o())}function Xe(l,n){if(l&1&&(s(0,"div",24),_(1,"div",29),s(2,"span",30),m(3),o(),_(4,"div",29),o()),l&2){let e=d().index;u(3),oe(e)}}function et(l,n){if(l&1){let e=I();s(0,"button",31),v("click",function(){f(e);let t=d().index,i=d();return y(i.removeStaff(t))}),_(1,"i",32),o()}}function tt(l,n){if(l&1&&(s(0,"option",40),m(1),o()),l&2){let e=n.$implicit;h("value",e.name),u(),O(" ",e.name," ")}}function it(l,n){l&1&&(s(0,"div",18),m(1," Type of Staff is required. "),o())}function nt(l,n){if(l&1&&(s(0,"option",40),m(1),o()),l&2){let e=n.$implicit;h("value",e.value),u(),O(" ",e.label," ")}}function rt(l,n){if(l&1&&(s(0,"div",18),m(1),Z(2,"titlecase"),o()),l&2){let e,r=d(2).$implicit;u(),O(" Type of ",H(2,1,(e=r.get("typeOfStaff"))==null?null:e.value)," is required. ")}}function at(l,n){if(l&1&&(G(0),s(1,"div",41)(2,"div",14)(3,"label",35),m(4),Z(5,"titlecase"),o(),_(6,"i",42),s(7,"select",43)(8,"option",38),m(9),Z(10,"titlecase"),o(),S(11,nt,2,2,"option",39),o(),C(12,rt,3,3,"div",18),o()(),N()),l&2){let e,r,t,i,a,c=d().$implicit,g=d().index,b=d();u(3),h("for",T("typeOfSubStaff-",g)),u(),O("Select ",H(5,11,(e=c.get("typeOfStaff"))==null?null:e.value)," Type"),u(3),E("is-invalid",((r=c.get("typeOfSubStaff"))==null?null:r.invalid)&&((r=c.get("typeOfSubStaff"))==null?null:r.touched)),h("id",T("typeOfSubStaff-",g))("disabled",!((t=c.get("typeOfStaff"))!=null&&t.value)),u(2),O(" Select ",H(10,13,(i=c.get("typeOfStaff"))==null?null:i.value)," "),u(2),h("ngForOf",b.staffSubCategories[g]),u(),x((a=c.get("typeOfSubStaff"))!=null&&a.invalid&&((a=c.get("typeOfSubStaff"))!=null&&a.touched)?12:-1)}}function ot(l,n){if(l&1&&(s(0,"div",33)(1,"div",3)(2,"div",34)(3,"div",14)(4,"label",35),m(5,"Select Staff Type"),o(),_(6,"i",36),s(7,"select",37)(8,"option",38),m(9,"Select Type"),o(),S(10,tt,2,2,"option",39),o(),C(11,it,2,0,"div",18),o()(),C(12,at,13,15,"ng-container"),o()()),l&2){let e,r,t,i=n.$implicit,a=n.index,c=d().index,g=d();h("formGroupName",a),u(4),h("for",T("typeOfStaff-",c)),u(3),E("is-invalid",((e=i.get("typeOfStaff"))==null?null:e.invalid)&&((e=i.get("typeOfStaff"))==null?null:e.touched)),h("id",T("typeOfStaff-",c)),u(3),h("ngForOf",g.staffCategories),u(),x((r=i.get("typeOfStaff"))!=null&&r.invalid&&((r=i.get("typeOfStaff"))!=null&&r.touched)?11:-1),u(),x((t=i.get("typeOfStaff"))!=null&&t.value&&((t=i.get("typeOfStaff"))==null?null:t.value)!==""?12:-1)}}function st(l,n){l&1&&(s(0,"div",71),m(1," Quantity is required. "),o())}function lt(l,n){if(l&1&&(s(0,"option",40),m(1),o()),l&2){let e=n.$implicit;h("value",e.value),u(),O(" ",e.label," ")}}function dt(l,n){l&1&&(s(0,"div",18),m(1," Tenure is required. "),o())}function ct(l,n){l&1&&(s(0,"div",18),m(1," Duty End Date is required. "),o())}function gt(l,n){if(l&1&&(s(0,"div",77)(1,"label",15),m(2,"Duty End Date"),o(),_(3,"input",83),S(4,ct,2,0,"div",84),o()),l&2){let e,r,t=d().$implicit,i=d(3);u(3),h("min",((e=t.get("dutyStartDate"))==null?null:e.value)||i.today),u(),h("ngIf",((r=t.get("dutyEndDate"))==null?null:r.invalid)&&((r=t.get("dutyEndDate"))==null?null:r.touched))}}function ut(l,n){if(l&1){let e=I();s(0,"i",85),v("click",function(){f(e);let t=d(3).index,i=d();return y(i.addShift(t))}),o()}}function mt(l,n){if(l&1){let e=I();s(0,"i",86),v("click",function(){f(e);let t=d().index,i=d(2).index,a=d();return y(a.removeShiftDetail(i,t))}),o()}}function pt(l,n){if(l&1){let e=I();s(0,"div",46)(1,"div",47)(2,"div",48)(3,"div",49)(4,"div",50)(5,"small",51),m(6,"Start Time"),o(),s(7,"div",49)(8,"div",52)(9,"button",53),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.decrementTimes("hours",i,t,"start"))}),_(10,"i",54),o(),s(11,"input",55),v("input",function(t){let i=f(e).index,a=d(2).index,c=d();return y(c.onManualTimeChange("startTimeHour",a,i,t))}),o(),s(12,"button",56),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.incrementTimes("hours",i,t,"start"))}),_(13,"i",57),o()(),s(14,"div",58)(15,"button",53),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.decrementTimes("minutes",i,t,"start"))}),_(16,"i",54),o(),s(17,"input",59),v("input",function(t){let i=f(e).index,a=d(2).index,c=d();return y(c.onManualTimeChange("startTimeMinute",a,i,t))}),o(),s(18,"button",56),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.incrementTimes("minutes",i,t,"start"))}),_(19,"i",57),o()(),s(20,"select",60),v("change",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.updateTimeSlot(a.getNestedShiftDetailsControls(i)[t]))}),s(21,"option",61),m(22,"AM"),o(),s(23,"option",62),m(24,"PM"),o()()()()(),s(25,"div",49)(26,"div",50)(27,"small",51),m(28,"End Time"),o(),s(29,"div",49)(30,"div",52)(31,"button",53),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.decrementTimes("hours",i,t,"end"))}),_(32,"i",54),o(),s(33,"input",63),v("input",function(t){let i=f(e).index,a=d(2).index,c=d();return y(c.onManualTimeChange("endTimeHour",a,i,t))}),o(),s(34,"button",56),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.incrementTimes("hours",i,t,"end"))}),_(35,"i",57),o()(),s(36,"div",58)(37,"button",53),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.decrementTimes("minutes",i,t,"end"))}),_(38,"i",54),o(),s(39,"input",64),v("input",function(t){let i=f(e).index,a=d(2).index,c=d();return y(c.onManualTimeChange("endTimeMinute",a,i,t))}),o(),s(40,"button",56),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.incrementTimes("minutes",i,t,"end"))}),_(41,"i",57),o()(),s(42,"select",65)(43,"option",61),m(44,"AM"),o(),s(45,"option",62),m(46,"PM"),o()()()()(),s(47,"div",66)(48,"div",67)(49,"label",68),m(50,"Preferred Gender"),o(),s(51,"div",58),_(52,"i",69),s(53,"span",70),m(54,"Male"),o()(),s(55,"div",58),_(56,"i",69),s(57,"span",70),m(58,"Female"),o()(),C(59,st,2,0,"div",71),o(),s(60,"div",72)(61,"label",15),m(62,"Quantity"),o(),s(63,"div",52)(64,"button",53),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.decrease("maleQuantity",i,t))}),_(65,"i",54),o(),s(66,"input",73),v("input",function(t){let i=f(e).index,a=d(2).index,c=d();return y(c.onManualChange("maleQuantity",a,i,t))}),o(),s(67,"button",56),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.increase("maleQuantity",i,t))}),_(68,"i",57),o()(),s(69,"div",52)(70,"button",53),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.decrease("femaleQuantity",i,t))}),_(71,"i",54),o(),s(72,"input",73),v("input",function(t){let i=f(e).index,a=d(2).index,c=d();return y(c.onManualChange("femaleQuantity",a,i,t))}),o(),s(73,"button",56),v("click",function(){let t=f(e).index,i=d(2).index,a=d();return y(a.increase("femaleQuantity",i,t))}),_(74,"i",57),o()()()(),s(75,"div",74)(76,"div",14)(77,"label",15),m(78,"Tenure"),o(),s(79,"div",58),_(80,"i",75),s(81,"select",76),S(82,lt,2,2,"option",39),o()(),C(83,dt,2,0,"div",18),o()()(),s(84,"div",3)(85,"div",77)(86,"label",15),m(87,"Duty Start Date"),o(),_(88,"input",78),o(),S(89,gt,5,2,"div",79),o(),s(90,"div",80),C(91,ut,1,0,"i",81),C(92,mt,1,0,"i",82),o()()()}if(l&2){let e,r,t,i,a,c,g,b,M=n.$implicit,k=n.index,D=d(2).index,z=d();h("formGroupName",k),u(7),E("is-invalid",((e=M.get("timeSlot"))==null||e.errors==null?null:e.errors.pastTime)&&((e=M.get("timeSlot"))==null?null:e.touched)),u(4),h("value",z.pad((r=M.get("startTimeHour"))==null?null:r.value)),u(6),h("value",z.pad((t=M.get("startTimeMinute"))==null?null:t.value)),u(16),h("value",z.pad((i=M.get("endTimeHour"))==null?null:i.value)),u(6),h("value",z.pad((a=M.get("endTimeMinute"))==null?null:a.value)),u(20),x(M.errors!=null&&M.errors.zeroQuantity&&(M.touched||M.dirty)?59:-1),u(7),h("formControlName","maleQuantity"),u(6),h("formControlName","femaleQuantity"),u(9),E("is-invalid",((c=M.get("tenure"))==null?null:c.invalid)&&((c=M.get("tenure"))==null?null:c.touched)),u(),h("ngForOf",z.tenure),u(),x((g=M.get("tenure"))!=null&&g.invalid&&((g=M.get("tenure"))!=null&&g.touched)?83:-1),u(5),h("min",z.today),u(),h("ngIf",((b=M.get("tenure"))==null?null:b.value)!=="1"),u(2),x(k===0||k===z.getNestedShiftDetailsControls(D).length-1?91:-1),u(),x(k>0?92:-1)}}function ht(l,n){if(l&1&&(G(0),s(1,"div",44),S(2,pt,93,18,"div",45),o(),N()),l&2){let e=d().index,r=d();u(2),h("ngForOf",r.getNestedShiftDetailsControls(e))}}function _t(l,n){if(l&1&&(s(0,"div",23),C(1,Xe,5,1,"div",24),s(2,"div",25),C(3,et,2,0,"button",26),o(),s(4,"div",27),S(5,ot,13,10,"div",28),o(),C(6,ht,3,1,"ng-container"),o()),l&2){let e,r=n.index,t=d();h("formGroupName",r),u(),x(r>0?1:-1),u(2),x(r!==0?3:-1),u(2),h("ngForOf",t.getNestedStaffDetailsControls(r)),u(),x((e=t.getNestedStaffDetailsControls(r)[0].get("typeOfStaff"))!=null&&e.value?6:-1)}}function ft(l,n){if(l&1){let e=I();G(0),s(1,"div",87)(2,"button",88),v("click",function(){f(e);let t=d();return y(t.addNewStaff())}),_(3,"i",57),m(4,"Add Another Staff "),o()(),s(5,"div",89),_(6,"app-submission",90),o(),N()}if(l&2){let e=d();u(6),h("buttonType",e.button)("disableButton",e.isSubmitting)}}function yt(l,n){if(l&1){let e=I();s(0,"app-authorization",91),v("loginSuccess",function(){f(e);let t=d();return y(t.onAuthSuccess())})("close",function(){f(e);let t=d();return y(t.onAuthClose())}),o()}if(l&2){let e=d();h("showAuthModal",e.showAuthPopup)("authMode","login")}}var Re=class l{constructor(n){this.spinnerService=n}fb=R(Ee);http=R(ue);router=R(me);staffBookingForm;hours=Array.from({length:24},(n,e)=>e);minutes=[0,15,30,45];nurseTenure=["1 Day","15 Days","Monthly","Quarterly","Half Yearly","Yearly"];button="Search for staff";staffCategories=[];staffSubCategories={};preferredTimeSlots=["2 Hours","8 Hours","12 Hours","24 Hours"];tenure=[{label:"1 Day",value:"1"},{label:"3 Days",value:"2"},{label:"1 Week",value:"3"},{label:"2 Weeks",value:"4"},{label:"1 Month",value:"5"}];today=new Date().toISOString().split("T")[0];showAadharPopup=!1;showAuthPopup=!1;time={hour:13,minute:30};meridian=!0;isSubmitting=!1;ngOnInit(){this.getUserLocation(),this.getStaffCategories(),this.staffBookingForm=this.fb.group({userAddress:["",p.required],address:["",p.required],latitude:[],longitude:[],staffForms:this.fb.array([this.createStaffFormGroup()])}),this.subscribeToCategoryChange(0)}getStaffCategories(){let n=Q+A.CATEGORIES;this.http.get(n).subscribe({next:e=>{this.staffCategories=e||[]},error:e=>{console.error("Error fetching categories:",e)}})}subscribeToCategoryChange(n){let t=this.staffListFormArray.at(n).get("staffDetails").at(0);t.get("typeOfStaff")?.valueChanges.subscribe(i=>{let a=this.staffCategories.find(c=>c.name===i);if(a){let c=a.id;this.fetchSubCategories(c,n),t.get("typeOfSubStaff")?.setValue("")}})}incrementTimes(n,e,r,t="start"){let i=this.getShiftGroup(e,r);if(!i)return;let a=t==="start"?"startTimeHour":"endTimeHour",c=t==="start"?"startTimeMinute":"endTimeMinute";if(n==="hours"){let g=+i.get(a)?.value||1;g=g%12+1,g===0&&(g=12),i.get(a)?.setValue(g)}else{let g=+i.get(c)?.value||0;g=(g+1)%60,i.get(c)?.setValue(g)}t==="start"&&this.updateTimeSlot(i)}decrementTimes(n,e,r,t="start"){let i=this.getShiftGroup(e,r);if(!i)return;let a=t==="start"?"startTimeHour":"endTimeHour",c=t==="start"?"startTimeMinute":"endTimeMinute";if(n==="hours"){let g=+i.get(a)?.value||1;g=(g-1+12)%12,g===0&&(g=12),i.get(a)?.setValue(this.pad(g))}else{let g=+i.get(c)?.value||0;g=(g-1+60)%60,i.get(c)?.setValue(this.pad(g))}t==="start"&&this.updateTimeSlot(i)}incrementTime(n,e,r){let t=this.getShiftGroup(e,r);if(t)if(n==="hours"){let i=+t.get("hours")?.value||1;i=i%12+1,i===0&&(i=12),t.get("hours")?.setValue(i)}else{let i=+t.get("minutes")?.value||0;i=(i+1)%60,t.get("minutes")?.setValue(i)}}decrementTime(n,e,r){let t=this.getShiftGroup(e,r);if(t)if(n==="hours"){let i=+t.get("hours")?.value||1;i=(i-1+12)%12,i===0&&(i=12),t.get("hours")?.setValue(this.pad(i))}else{let i=+t.get("minutes")?.value||0;i=(i-1+60)%60,t.get("minutes")?.setValue(this.pad(i))}}getShiftGroup(n,e){return this.staffListFormArray.at(n).get("shiftDetails").at(e)}pad(n){return n!=null?n.toString().padStart(2,"0"):"00"}increase(n,e,r){let t=this.getQuantityControl(n,e,r);t.setValue(Math.min((t.value||0)+1,10)),this.updateGenderInShift(e,r)}decrease(n,e,r){let t=this.getQuantityControl(n,e,r);t.setValue(Math.max((t.value||1)-1,0)),this.updateGenderInShift(e,r)}updateGenderInShift(n,e){let r=this.getShiftGroup(n,e);r&&this.updateGenderQty(r)}getQuantityControl(n,e,r){return this.staffListFormArray.at(e).get("shiftDetails").at(r).get(n==="maleQuantity"?"maleQuantity":"femaleQuantity")}getUserLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{let e=n.coords.latitude,r=n.coords.longitude;this.getAddressFromCoords(e,r)},n=>{console.error("Geolocation failed:",n)}):console.error("Geolocation not supported by this browser.")}getAddressFromCoords(n,e){this.staffBookingForm.patchValue({latitude:n,longitude:e});let r=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${n}&lon=${e}`;this.http.get(r).subscribe(t=>{let i=t.display_name;i&&this.staffBookingForm.patchValue({userAddress:i})},t=>{console.error("Error fetching address:",t)})}createStaffDetailFormGroup(){return this.fb.group({typeOfStaff:["",p.required],typeOfSubStaff:["",p.required]})}fetchSubCategories(n,e){let r=`${Q}${A.CATEGORIES}/${n}${A.SUB_CATEGORIES}`;this.http.get(r).subscribe({next:t=>{this.staffSubCategories[e]=t},error:t=>{console.error("Failed to fetch subcategories",t),this.staffSubCategories[e]=[]}})}createShiftDetailFormGroup(){let n=new Date,e=n.getHours(),r=n.getMinutes(),t=e>=12?"PM":"AM";e===0?e=12:e>12&&(e-=12);let i=this.fb.group({preferredTimeSlot:["",p.required],timeSlot:[""],tenure:[""],dutyStartDate:[new Date().toISOString().substring(0,10)],dutyEndDate:[""],maleQuantity:["0",[p.min(0),p.max(10)]],femaleQuantity:["0",[p.min(0),p.max(10)]],hours:[e,[p.required,p.min(1),p.max(12)]],minutes:[r,[p.required,p.min(0),p.max(59)]],ampm:[t,p.required],startTimeHour:[e,[p.required,p.min(1),p.max(12)]],startTimeMinute:[r,[p.required,p.min(0),p.max(59)]],startTimeAmPm:[t,p.required],endTimeHour:[e,[p.required,p.min(1),p.max(12)]],endTimeMinute:[r,[p.required,p.min(0),p.max(59)]],endTimeAmPm:[t,p.required]},{validators:[this.shiftDurationValidator]});return i.get("startTimeHour")?.valueChanges.subscribe(()=>this.updateTimeSlot(i)),i.get("startTimeMinute")?.valueChanges.subscribe(()=>this.updateTimeSlot(i)),i.get("startTimeAmPm")?.valueChanges.subscribe(()=>this.updateTimeSlot(i)),i.get("hours")?.valueChanges.subscribe(()=>this.updateTimeSlot(i)),i.get("minutes")?.valueChanges.subscribe(()=>this.updateTimeSlot(i)),i.get("ampm")?.valueChanges.subscribe(()=>this.updateTimeSlot(i)),i.get("maleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(i)),i.get("femaleQuantity")?.valueChanges.subscribe(()=>this.updateGenderQty(i)),i.get("tenure")?.valueChanges.subscribe(a=>{let c=i.get("dutyEndDate");a==="1"?(c?.clearValidators(),c?.setValue("")):c?.setValidators([p.required]),c?.updateValueAndValidity()}),i.get("dutyStartDate")?.valueChanges.subscribe(a=>{if(!a){let g=new Date().toISOString().substring(0,10);i.get("dutyStartDate")?.setValue(g,{emitEvent:!1});return}let c=i.get("dutyEndDate");if(c){let g=c.value;g&&new Date(g)<new Date(a)&&c.setValue(a,{emitEvent:!1})}}),i}updateTimeSlot(n){let e=n.get("startTimeHour")?.value??0,r=n.get("startTimeMinute")?.value??0,t=n.get("startTimeAmPm")?.value??"AM",i=g=>g.toString().padStart(2,"0"),a=`${i(+e)}:${i(+r)} ${t}`,c=n.get("timeSlot");c?.setValue(a,{emitEvent:!1}),c?.markAsTouched(),c?.markAsDirty()}updateGenderQty(n){let e=Number(n.get("maleQuantity")?.value||0),r=Number(n.get("femaleQuantity")?.value||0);n.get("maleQuantity")?.setValue(e,{emitEvent:!1}),n.get("femaleQuantity")?.setValue(r,{emitEvent:!1})}createStaffFormGroup(){return this.fb.group({staffDetails:this.fb.array([this.createStaffDetailFormGroup()]),shiftDetails:this.fb.array([this.createShiftDetailFormGroup()])})}addShift(n){this.staffListFormArray.at(n).get("shiftDetails").push(this.createShiftDetailFormGroup())}removeShiftDetail(n,e){this.staffListFormArray.at(n).get("shiftDetails").removeAt(e)}addNewStaff(){this.staffListFormArray.push(this.createStaffFormGroup());let n=this.staffListFormArray.length-1;this.subscribeToCategoryChange(n)}get staffListFormArray(){return this.staffBookingForm.get("staffForms")}getNestedShiftDetailsControls(n){return this.staffListFormArray.at(n).get("shiftDetails").controls}getNestedStaffDetailsControls(n){return this.staffListFormArray.at(n).get("staffDetails").controls}removeStaff(n){this.staffListFormArray.removeAt(n)}onSubmit(){if(this.isSubmitting)return;this.isSubmitting=!0;let n=this.hasPastTimeError(),e=this.hasZeroQuantityError();if(console.log("SUBMIT CALLED"),!this.staffBookingForm.valid||n||e){this.markAllAsTouched(this.staffBookingForm),this.isSubmitting=!1;return}let r=localStorage.getItem("authToken")||sessionStorage.getItem("authToken"),i=JSON.parse(localStorage.getItem("userProfile")||"{}").aadhaarStatus===!0;if(!r){console.log("User not logged in. Redirecting to login page."),this.showAuthPopup=!0,this.isSubmitting=!1;return}this.spinnerService.show();let a=Q+A.BOOK_STAFF,c=V(L({},this.staffBookingForm.value),{staffForms:this.staffListFormArray.controls.map(b=>{let M=b.get("staffDetails").at(0),{typeOfStaff:k,typeOfSubStaff:D}=M.value,z=b.get("shiftDetails").controls.map(w=>{let{tenure:F,maleQuantity:B,femaleQuantity:Ge,dutyStartDate:Ne,dutyEndDate:Ze,startTimeHour:He,startTimeMinute:Qe,startTimeAmPm:je,endTimeHour:qe,endTimeMinute:We,endTimeAmPm:Ue}=w.value;return{tenure:F,maleQuantity:B,femaleQuantity:Ge,dutyStartDate:Ne,dutyEndDate:Ze,startTimeHour:String(He),startTimeMinute:String(Qe),startTimeAmPm:String(je),endTimeHour:String(qe),endTimeMinute:String(We),endTimeAmPm:String(Ue)}});return{typeOfStaff:k,typeOfSubStaff:D,shifts:z}})}),g=new ge({"Content-Type":"application/json"});g=g.set("Authorization",`Bearer ${r}`),this.http.post(a,c,{headers:g}).subscribe({next:b=>{if(this.spinnerService.hide(),this.isSubmitting=!1,b?.status===!0){let M=b?.staff?.[0]?.staffDetails||[];this.router.navigate(["/view-staff"],{state:{staffDetails:M,bookingIds:b.bookingIds}})}else alert(b?.message||"Something went wrong.")},error:b=>{this.spinnerService.hide(),this.isSubmitting=!1,console.error("Staff search API call failed:",b),alert("An error occurred while processing your request.")}})}onAuthSuccess(){this.showAuthPopup=!1,this.onSubmit()}onAuthClose(){this.showAuthPopup=!1}onAadharVerified(){this.showAadharPopup=!1;let n=JSON.parse(localStorage.getItem("userProfile")||"{}");n.aadhaarStatus=!1,localStorage.setItem("userProfile",JSON.stringify(n)),this.onSubmit()}hasPastTimeError(){let n=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(t=>{let i=t.get("dutyStartDate")?.value,a=+t.get("hours")?.value,c=+t.get("minutes")?.value,g=t.get("ampm")?.value;if(!i||a==null||c==null||!g)return;let b=new Date(i),M=new Date,k=w=>w.toString().padStart(2,"0"),D=`${k(a)}:${k(c)} ${g}`;if(t.get("timeSlot")?.setValue(D,{emitEvent:!1}),b.getFullYear()===M.getFullYear()&&b.getMonth()===M.getMonth()&&b.getDate()===M.getDate()){let w=a;g==="PM"&&w!==12&&(w+=12),g==="AM"&&w===12&&(w=0);let F=new Date;if(F.setHours(w,c,0,0),F<M)t.get("timeSlot")?.setErrors({pastTime:!0}),n=!0;else{let B=t.get("timeSlot");B?.hasError("pastTime")&&B.setErrors(null)}}})}),n}hasZeroQuantityError(){let n=!1;return this.staffListFormArray.controls.forEach(e=>{e.get("shiftDetails").controls.forEach(t=>{let i=+t.get("maleQuantity")?.value||0,a=+t.get("femaleQuantity")?.value||0;if(i===0&&a===0)t.setErrors(V(L({},t.errors||{}),{zeroQuantity:!0})),n=!0;else if(t.errors?.zeroQuantity){let c=L({},t.errors);delete c.zeroQuantity,t.setErrors(Object.keys(c).length?c:null)}})}),n}markAllAsTouched(n){Object.values(n.controls).forEach(e=>{e.markAsTouched(),(e instanceof fe||e instanceof Oe)&&this.markAllAsTouched(e)})}shiftDurationValidator(n){let e=parseInt(n.get("shiftHour")?.value,10),r=parseInt(n.get("shiftMinute")?.value,10);if(isNaN(e)||isNaN(r))return null;let t=e*60+r,i=(t+480)%1440;return t>=0&&i>=0?null:{invalidShiftDuration:!0}}onManualChange(n,e,r,t){let i=t.target,a=Number(i.value);isNaN(a)&&(a=0),a<0&&(a=0),a>10&&(a=10),this.getNestedShiftDetailsControls(e)[r].get(n)?.setValue(a)}onManualTimeChange(n,e,r,t){let i=t.target,a=Number(i.value);isNaN(a)&&(a=0),n.toLowerCase().includes("hour")&&(a<0&&(a=0),a>12&&(a=12)),n.toLowerCase().includes("minute")&&(a<0&&(a=0),a>59&&(a=59)),this.getNestedShiftDetailsControls(e)[r].get(n)?.setValue(a),n.startsWith("startTime")&&this.updateTimeSlot(this.getNestedShiftDetailsControls(e)[r])}centerContent(){let n=document.querySelector(".banner .banner-content");n&&n.scrollIntoView({behavior:"smooth",block:"center"})}static \u0275fac=function(e){return new(e||l)(ee(q))};static \u0275cmp=P({type:l,selectors:[["app-book-staff"]],decls:35,vars:7,consts:[["image","assets/staff/book-staff-banner.avif","title","Hire Trusted Staff Easily","subtitle","Find verified professionals for your home, office, or business needs","buttonText","Book Now",3,"buttonClick"],["imageUrl","assets/images/sample.jpg","imageAlt","Sample Image","title","Find, Book & Shop \u2014 All in One Place","subtitle","Discover Amazing Features","description","Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.","buttonText","","buttonLink","/"],[1,"container-fluid",2,"margin-top","60px"],[1,"row"],[1,"col-md-4","h-100","map-styles"],[3,"locationSelected"],[1,"col-md-8","search-staff-form"],[1,"form-title"],[1,"form-scroll-container"],[1,"form-content"],[3,"ngSubmit","formGroup"],[1,"form"],[1,"row","my-3"],[1,"col-md-12"],[1,"form-group"],[1,"form-label"],[1,"fi","fi-rr-navigation","address"],["type","text","formControlName","userAddress",1,"form-control","ps-4"],[1,"invalid-feedback"],["type","text","placeholder","Enter address","formControlName","address",1,"form-control","ps-4"],["formArrayName","staffForms",1,"staff-list"],["class","pe-2",3,"formGroupName",4,"ngFor","ngForOf"],[3,"showAuthModal","authMode"],[1,"pe-2",3,"formGroupName"],[1,"indexed-divider-container"],[1,"col-md-12","d-flex","justify-content-end"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px"],["formArrayName","staffDetails"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"line"],[1,"index-number"],["type","button","title","Remove Staff",1,"btn","btn-outline-danger","btn-lg","rounded-circle","d-flex","align-items-center","justify-content-center",2,"width","20px","height","30px",3,"click"],[1,"bi","bi-trash","fs-5"],[3,"formGroupName"],[1,"col-md-12","mb-2"],[1,"form-label",3,"for"],[1,"bi","bi-person","address"],["formControlName","typeOfStaff",1,"form-select","ps-4",3,"id"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"col-md-12","my-3"],[1,"bi","bi-people","address"],["formControlName","typeOfSubStaff",1,"form-select","ps-4",3,"id","disabled"],["formArrayName","shiftDetails"],["class","shift-detail",3,"formGroupName",4,"ngFor","ngForOf"],[1,"shift-detail",3,"formGroupName"],[1,"row","d-flex"],[1,"sub-row"],[1,"d-flex","align-items-center"],[1,"d-flex","flex-column"],[1,"text-muted"],[1,"d-flex","align-items-center","counter-box"],["type","button",1,"btn-counterLeft","btn-minus",3,"click"],[1,"bi","bi-dash"],["type","number","formControlName","startTimeHour","min","1","max","12",1,"value-font","counter-input",3,"input","value"],["type","button",1,"btn-counterRight","btn-plus",3,"click"],[1,"bi","bi-plus"],[1,"d-flex","align-items-center","counter-box","mx-2"],["type","number","formControlName","startTimeMinute","min","0","max","59",1,"value-font","counter-input","hrsMin",3,"input","value"],["formControlName","startTimeAmPm",1,"d-flex","align-items-center","counter-box","mx-2",3,"change"],["value","AM"],["value","PM"],["type","number","formControlName","endTimeHour","min","1","max","12",1,"value-font","counter-input",3,"input","value"],["type","number","formControlName","endTimeMinute","min","0","max","59",1,"value-font","counter-input","hrsMin",3,"input","value"],["formControlName","endTimeAmPm",1,"d-flex","align-items-center","counter-box","mx-2"],[1,"gender-quantity-row"],[1,"gender-box"],[1,"form-label","d-block"],[1,"bi","bi-person","text-primary","me-2"],[1,"counter-label"],[1,"text-danger"],[1,"quantity-box"],["type","number","min","0","max","10",1,"value-font","counter-input",3,"input","formControlName"],[1,"col-12","col-sm-6","col-md-4","col-lg-2"],[1,"bi","bi-calendar4","text-primary"],["formControlName","tenure",1,"value-font","border-0","counter-select"],[1,"col-md-6"],["type","date","formControlName","dutyStartDate",1,"form-control",3,"min"],["class","col-md-6",4,"ngIf"],[1,"d-flex","align-items-start","justify-content-end","gap-2","mt-3"],["title","Add Time Slot",1,"bi","bi-plus-lg","add"],["title","Remove Time Slot",1,"bi","bi-trash","text-danger","remove"],["type","date","formControlName","dutyEndDate",1,"form-control",3,"min"],["class","invalid-feedback",4,"ngIf"],["title","Add Time Slot",1,"bi","bi-plus-lg","add",3,"click"],["title","Remove Time Slot",1,"bi","bi-trash","text-danger","remove",3,"click"],[1,"d-flex","justify-content-center","addNewBtn","my-2"],["type","button",1,"btn","text-light",3,"click"],[1,"submission-fixed","d-flex","justify-content-end"],[3,"buttonType","disableButton"],[3,"loginSuccess","close","showAuthModal","authMode"]],template:function(e,r){if(e&1&&(s(0,"app-text-banner",0),v("buttonClick",function(){return r.centerContent()}),o(),_(1,"app-text-image",1),s(2,"div",2)(3,"div",3)(4,"div",4)(5,"app-map",5),v("locationSelected",function(i){return r.getAddressFromCoords(i.lat,i.lng)}),o()(),s(6,"div",6)(7,"h2",7),m(8,"Please fill the form"),o(),s(9,"div",8)(10,"div",9)(11,"form",10),v("ngSubmit",function(){return r.onSubmit()}),s(12,"div",11)(13,"div",12)(14,"div",13)(15,"div",14)(16,"label",15),m(17,"Select your area"),o(),_(18,"i",16)(19,"input",17),C(20,Ye,2,0,"div",18),o()()(),s(21,"div",12)(22,"div",13)(23,"div",14)(24,"label",15),m(25,"Address"),o(),_(26,"i",16)(27,"input",19),o()()(),s(28,"div",20),S(29,_t,7,5,"div",21),o()(),C(30,ft,7,2,"ng-container"),o()()()()()(),s(31,"div"),_(32,"app-footer"),o(),_(33,"app-mobile-footer-nav"),C(34,yt,1,2,"app-authorization",22)),e&2){let t,i,a;u(11),h("formGroup",r.staffBookingForm),u(8),E("is-invalid",((t=r.staffBookingForm.get("userAddress"))==null?null:t.invalid)&&((t=r.staffBookingForm.get("userAddress"))==null?null:t.touched)),u(),x((i=r.staffBookingForm.get("userAddress"))!=null&&i.invalid&&((i=r.staffBookingForm.get("userAddress"))!=null&&i.touched)?20:-1),u(9),h("ngForOf",r.staffListFormArray.controls),u(),x(!((a=r.staffListFormArray.controls[0].get("staffDetails"))==null||(a=a.get("0"))==null||(a=a.get("typeOfStaff"))==null)&&a.value?30:-1),u(4),x(r.showAuthPopup?34:-1)}},dependencies:[ce,se,le,De,ye,ke,we,pe,ve,ze,he,_e,Ie,Se,Me,xe,be,Ce,j,Le,Pe,Te,Ae,Fe,Be,de],styles:['@charset "UTF-8";.staff-list[_ngcontent-%COMP%]{overflow-x:hidden;overflow-y:scroll}.staff-list[_ngcontent-%COMP%]:hover{overflow-y:auto}.staff-list[_ngcontent-%COMP%]:focus-within{overflow-y:auto}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar{width:3px;height:8px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#fff;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#09b8c2;border-radius:10px}.staff-list[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#fff}.indexed-divider-container[_ngcontent-%COMP%]{display:flex;align-items:center;margin:20px 0;color:#6c757d;font-weight:700;font-size:.9rem}.line[_ngcontent-%COMP%]{flex-grow:1;height:1px;background-color:#dee2e6}.index-number[_ngcontent-%COMP%]{color:#09b8c2;padding:5px 12px;background-color:#e0fcff;border-radius:50%;min-width:25px;text-align:center;box-shadow:0 1px 3px #0000000d}.form-group[_ngcontent-%COMP%]{position:relative}.address[_ngcontent-%COMP%]{position:absolute;left:5px;top:36px;color:#feb47b}.female[_ngcontent-%COMP%]{top:8px!important}.hrsMin[_ngcontent-%COMP%]{width:40px!important}.amPm[_ngcontent-%COMP%]{width:70px!important}.counter-box[_ngcontent-%COMP%]{background:#f9fbfd;border:2px solid #dff4f6;border-radius:12px;padding:0 12px;display:inline-flex;align-items:center;justify-content:center;margin-bottom:6px;width:120px;height:34px}.counter-box[_ngcontent-%COMP%]   .btn-counterRight[_ngcontent-%COMP%]{background:transparent;border:none;font-size:24px;font-weight:700;color:#fff;cursor:pointer;width:30px;height:30px;line-height:1;display:flex;align-items:center;justify-content:center}.counter-box[_ngcontent-%COMP%]   .btn-counterRight[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.counter-box[_ngcontent-%COMP%]   .btn-counterLeft[_ngcontent-%COMP%]{background:transparent;border:none;font-size:24px;font-weight:700;color:#fff;cursor:pointer;width:30px;height:30px;line-height:1;display:flex;align-items:center;justify-content:center}.counter-box[_ngcontent-%COMP%]   .btn-counterLeft[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.counter-input[_ngcontent-%COMP%]{width:55px;text-align:center;border:none;background:transparent;font-size:22px;font-weight:600;color:#212529;padding:0;margin:0}.counter-input[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.counter-input.hrsMin[_ngcontent-%COMP%]{width:50px}.counter-select[_ngcontent-%COMP%]{background:transparent;font-size:16px;font-weight:500;color:#212529;padding-left:8px;box-shadow:none!important}.counter-select[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.counter-select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{color:#212529}.search-staff-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .search-staff-form[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{height:40px!important;min-height:40px!important;line-height:40px;padding:0 10px;font-size:.9rem;border-radius:6px;border-color:#dff4f6;background:#f9fbfd}.value-font[_ngcontent-%COMP%]{color:#1e293b;font-size:14px;font-weight:400}.search-staff-form[_ngcontent-%COMP%]   .counter-input[_ngcontent-%COMP%]{height:40px!important;min-height:40px!important;text-align:center;padding:0}.search-staff-form[_ngcontent-%COMP%]   .btn-counterRight[_ngcontent-%COMP%]{height:34px!important;width:40px;display:flex;align-items:center;justify-content:center;border-radius:0 14px 14px 0;padding:10px}.search-staff-form[_ngcontent-%COMP%]   .btn-counterLeft[_ngcontent-%COMP%]{height:34px!important;width:40px;display:flex;align-items:center;justify-content:center;border-radius:14px 0 0 14px}.search-staff-form[_ngcontent-%COMP%]   .counter-select[_ngcontent-%COMP%]{height:40px!important;min-height:40px!important;padding:0 8px}.form-scroll-container[_ngcontent-%COMP%]{max-height:600px;overflow-y:auto;overflow-x:hidden;padding-right:10px}.form-scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.form-scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#0003;border-radius:3px}.form-scroll-container[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#0006}.row[_ngcontent-%COMP%], .form-content[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%], .form-content[_ngcontent-%COMP%]   .sub-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:flex-start}.sub-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:20px}@media (max-width: 768px){.sub-row[_ngcontent-%COMP%]   .col-12.col-sm-6.col-md-4.col-lg-4[_ngcontent-%COMP%], .sub-row[_ngcontent-%COMP%]   .col-12.col-sm-6.col-md-4.col-lg-2[_ngcontent-%COMP%]{flex:1 1 100%;max-width:100%}.sub-row[_ngcontent-%COMP%]   .counter-box[_ngcontent-%COMP%]{flex:1 1 auto;min-width:60px;width:auto;height:36px;margin-bottom:8px}.sub-row[_ngcontent-%COMP%]   .counter-input[_ngcontent-%COMP%]{font-size:14px;width:40px!important}.sub-row[_ngcontent-%COMP%]   select.counter-box[_ngcontent-%COMP%]{min-width:70px;height:36px;font-size:14px}}@media (max-width: 400px){.sub-row[_ngcontent-%COMP%]{flex-direction:column}.sub-row[_ngcontent-%COMP%]   .counter-box[_ngcontent-%COMP%]{width:100%}}.map-styles[_ngcontent-%COMP%]{height:auto;overflow:hidden;border-radius:12px}.map-styles[_ngcontent-%COMP%]   app-map[_ngcontent-%COMP%]{display:block;width:100%;height:100%}.gender-quantity-row[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;gap:12px}.gender-quantity-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1 1 0;min-width:0}@media (max-width: 500px){.gender-quantity-row[_ngcontent-%COMP%]{gap:24px}.gender-quantity-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1;min-width:0}.counter-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:60px;font-size:14px}.counter-label[_ngcontent-%COMP%]{font-size:14px}}@media (max-width: 375px){.container-fluid[_ngcontent-%COMP%]{margin-top:-30px!important;padding:0 8px}.search-staff-form[_ngcontent-%COMP%]{padding:12px}.form-title[_ngcontent-%COMP%]{font-size:1rem;text-align:center}.form-scroll-container[_ngcontent-%COMP%]{max-height:400px;padding-right:6px}.counter-box[_ngcontent-%COMP%]{width:100%;height:36px;font-size:.8rem}.counter-input[_ngcontent-%COMP%]{font-size:16px;width:40px!important}.search-staff-form[_ngcontent-%COMP%]   .btn-counter[_ngcontent-%COMP%]{width:32px!important;height:32px!important;font-size:18px}.map-styles[_ngcontent-%COMP%]{height:220px;margin-bottom:12px}}@media (min-width: 376px) and (max-width: 576px){.container-fluid[_ngcontent-%COMP%]{margin-top:-40px!important;padding:0 10px}.form-title[_ngcontent-%COMP%]{font-size:1.1rem;text-align:center}.counter-box[_ngcontent-%COMP%]{width:100%;margin-bottom:8px}.map-styles[_ngcontent-%COMP%]{height:250px;margin-bottom:15px}}@media (min-width: 577px) and (max-width: 768px){.form-title[_ngcontent-%COMP%]{font-size:1.1rem;text-align:center}.counter-box[_ngcontent-%COMP%]{width:100%}}@media (min-width: 769px) and (max-width: 1024px){.row[_ngcontent-%COMP%]{flex-direction:column}.map-styles[_ngcontent-%COMP%]{width:100%!important;min-height:250px;margin-bottom:16px}.search-staff-form[_ngcontent-%COMP%]{width:100%!important;padding:16px}.search-staff-form[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%], .search-staff-form[_ngcontent-%COMP%]   .form-select[_ngcontent-%COMP%]{width:100%!important}.counter-box[_ngcontent-%COMP%]{width:auto;min-width:80px;height:36px;font-size:.9rem}.gender-quantity-row[_ngcontent-%COMP%]{flex-wrap:wrap;gap:16px}.gender-quantity-row[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1 1 45%}.form-scroll-container[_ngcontent-%COMP%]{max-height:500px;padding-right:8px}.form-title[_ngcontent-%COMP%]{font-size:1.2rem;text-align:center}}@media (min-width: 1025px){.map-styles[_ngcontent-%COMP%]{height:auto;min-height:500px}.form-scroll-container[_ngcontent-%COMP%]{max-height:600px}}']})};export{Re as BookStaff};
